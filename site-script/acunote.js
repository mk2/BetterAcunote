
var Prototype={Version:'1.6.0.3',Browser:{IE:!!(window.attachEvent&&navigator.userAgent.indexOf('Opera')===-1),Opera:navigator.userAgent.indexOf('Opera')>-1,WebKit:navigator.userAgent.indexOf('AppleWebKit/')>-1,Gecko:navigator.userAgent.indexOf('Gecko')>-1&&navigator.userAgent.indexOf('KHTML')===-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)},BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:!!window.HTMLElement,SpecificElementExtensions:document.createElement('div')['__proto__']&&document.createElement('div')['__proto__']!==document.createElement('form')['__proto__']},ScriptFragment:'<script[^>]*>([\\S\\s]*?)<\/script>',JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(x){return x}};if(Prototype.Browser.MobileSafari)
Prototype.BrowserFeatures.SpecificElementExtensions=false;var Class={create:function(){var parent=null,properties=$A(arguments);if(Object.isFunction(properties[0]))
parent=properties.shift();function klass(){this.initialize.apply(this,arguments);}
Object.extend(klass,Class.Methods);klass.superclass=parent;klass.subclasses=[];if(parent){var subclass=function(){};subclass.prototype=parent.prototype;klass.prototype=new subclass;parent.subclasses.push(klass);}
for(var i=0;i<properties.length;i++)
klass.addMethods(properties[i]);if(!klass.prototype.initialize)
klass.prototype.initialize=Prototype.emptyFunction;klass.prototype.constructor=klass;return klass;}};Class.Methods={addMethods:function(source){var ancestor=this.superclass&&this.superclass.prototype;var properties=Object.keys(source);if(!Object.keys({toString:true}).length)
properties.push("toString","valueOf");for(var i=0,length=properties.length;i<length;i++){var property=properties[i],value=source[property];if(ancestor&&Object.isFunction(value)&&value.argumentNames().first()=="$super"){var method=value;value=(function(m){return function(){return ancestor[m].apply(this,arguments)};})(property).wrap(method);value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method);}
this.prototype[property]=value;}
return this;}};var Abstract={};Object.extend=function(destination,source){for(var property in source)
destination[property]=source[property];return destination;};Object.extend(Object,{inspect:function(object){try{if(Object.isUndefined(object))return'undefined';if(object===null)return'null';return object.inspect?object.inspect():String(object);}catch(e){if(e instanceof RangeError)return'...';throw e;}},toJSON:function(object){var type=typeof object;switch(type){case'undefined':case'function':case'unknown':return;case'boolean':return object.toString();}
if(object===null)return'null';if(object.toJSON)return object.toJSON();if(Object.isElement(object))return;var results=[];for(var property in object){var value=Object.toJSON(object[property]);if(!Object.isUndefined(value))
results.push(property.toJSON()+': '+value);}
return'{'+results.join(', ')+'}';},toQueryString:function(object){return $H(object).toQueryString();},toHTML:function(object){return object&&object.toHTML?object.toHTML():String.interpret(object);},keys:function(object){var keys=[];for(var property in object)
keys.push(property);return keys;},values:function(object){var values=[];for(var property in object)
values.push(object[property]);return values;},clone:function(object){return Object.extend({},object);},isElement:function(object){return!!(object&&object.nodeType==1);},isArray:function(object){return object!=null&&typeof object=="object"&&'splice'in object&&'join'in object;},isHash:function(object){return object instanceof Hash;},isFunction:function(object){return typeof object=="function";},isString:function(object){return typeof object=="string";},isNumber:function(object){return typeof object=="number";},isUndefined:function(object){return typeof object=="undefined";}});Object.extend(Function.prototype,{argumentNames:function(){var names=this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1].replace(/\s+/g,'').split(',');return names.length==1&&!names[0]?[]:names;},bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var __method=this,args=$A(arguments),object=args.shift();return function(){return __method.apply(object,args.concat($A(arguments)));}},bindAsEventListener:function(){var __method=this,args=$A(arguments),object=args.shift();return function(event){return __method.apply(object,[event||window.event].concat(args));}},curry:function(){if(!arguments.length)return this;var __method=this,args=$A(arguments);return function(){return __method.apply(this,args.concat($A(arguments)));}},delay:function(){var __method=this,args=$A(arguments),timeout=args.shift()*1000;return window.setTimeout(function(){return __method.apply(__method,args);},timeout);},defer:function(){var args=[0.01].concat($A(arguments));return this.delay.apply(this,args);},wrap:function(wrapper){var __method=this;return function(){return wrapper.apply(this,[__method.bind(this)].concat($A(arguments)));}},methodize:function(){if(this._methodized)return this._methodized;var __method=this;return this._methodized=function(){return __method.apply(null,[this].concat($A(arguments)));};}});Date.prototype.toJSON=function(){return'"'+this.getUTCFullYear()+'-'+
(this.getUTCMonth()+1).toPaddedString(2)+'-'+
this.getUTCDate().toPaddedString(2)+'T'+
this.getUTCHours().toPaddedString(2)+':'+
this.getUTCMinutes().toPaddedString(2)+':'+
this.getUTCSeconds().toPaddedString(2)+'Z"';};var Try={these:function(){var returnValue;for(var i=0,length=arguments.length;i<length;i++){var lambda=arguments[i];try{returnValue=lambda();break;}catch(e){}}
return returnValue;}};RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(str){return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g,'\\$1');};var PeriodicalExecuter=Class.create({initialize:function(callback,frequency){this.callback=callback;this.frequency=frequency;this.currentlyExecuting=false;this.registerCallback();},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000);},execute:function(){this.callback(this);},stop:function(){if(!this.timer)return;clearInterval(this.timer);this.timer=null;},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute();}finally{this.currentlyExecuting=false;}}}});Object.extend(String,{interpret:function(value){return value==null?'':String(value);},specialChar:{'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','\\':'\\\\'}});Object.extend(String.prototype,{gsub:function(pattern,replacement){var result='',source=this,match;replacement=arguments.callee.prepareReplacement(replacement);while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length);}else{result+=source,source='';}}
return result;},sub:function(pattern,replacement,count){replacement=this.gsub.prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0)return match[0];return replacement(match);});},scan:function(pattern,iterator){this.gsub(pattern,iterator);return String(this);},truncate:function(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?'...':truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this);},strip:function(){return this.replace(/^\s+/,'').replace(/\s+$/,'');},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,'');},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,'img'),'');},extractScripts:function(){var matchAll=new RegExp(Prototype.ScriptFragment,'img');var matchOne=new RegExp(Prototype.ScriptFragment,'im');return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||['',''])[1];});},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)});},escapeHTML:function(){var self=arguments.callee;self.text.data=this;return self.div.innerHTML;},unescapeHTML:function(){var div=new Element('div');div.innerHTML=this.stripTags();return div.childNodes[0]?(div.childNodes.length>1?$A(div.childNodes).inject('',function(memo,node){return memo+node.nodeValue}):div.childNodes[0].nodeValue):'';},toQueryParams:function(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match)return{};return match[1].split(separator||'&').inject({},function(hash,pair){if((pair=pair.split('='))[0]){var key=decodeURIComponent(pair.shift());var value=pair.length>1?pair.join('='):pair[0];if(value!=undefined)value=decodeURIComponent(value);if(key in hash){if(!Object.isArray(hash[key]))hash[key]=[hash[key]];hash[key].push(value);}
else hash[key]=value;}
return hash;});},toArray:function(){return this.split('');},succ:function(){return this.slice(0,this.length-1)+
String.fromCharCode(this.charCodeAt(this.length-1)+1);},times:function(count){return count<1?'':new Array(count+1).join(this);},camelize:function(){var parts=this.split('-'),len=parts.length;if(len==1)return parts[0];var camelized=this.charAt(0)=='-'?parts[0].charAt(0).toUpperCase()+parts[0].substring(1):parts[0];for(var i=1;i<len;i++)
camelized+=parts[i].charAt(0).toUpperCase()+parts[i].substring(1);return camelized;},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase();},underscore:function(){return this.gsub(/::/,'/').gsub(/([A-Z]+)([A-Z][a-z])/,'#{1}_#{2}').gsub(/([a-z\d])([A-Z])/,'#{1}_#{2}').gsub(/-/,'_').toLowerCase();},dasherize:function(){return this.gsub(/_/,'-');},inspect:function(useDoubleQuotes){var escapedString=this.gsub(/[\x00-\x1f\\]/,function(match){var character=String.specialChar[match[0]];return character?character:'\\u00'+match[0].charCodeAt().toPaddedString(2,16);});if(useDoubleQuotes)return'"'+escapedString.replace(/"/g,'\\"')+'"';return"'"+escapedString.replace(/'/g,'\\\'')+"'";},toJSON:function(){return this.inspect(true);},unfilterJSON:function(filter){return this.sub(filter||Prototype.JSONFilter,'#{1}');},isJSON:function(){var str=this;if(str.blank())return false;str=this.replace(/\\./g,'@').replace(/"[^"\\\n\r]*"/g,'');return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str);},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON())return eval('('+json+')');}catch(e){}
throw new SyntaxError('Badly formed JSON string: '+this.inspect());},include:function(pattern){return this.indexOf(pattern)>-1;},startsWith:function(pattern){return this.indexOf(pattern)===0;},endsWith:function(pattern){var d=this.length-pattern.length;return d>=0&&this.lastIndexOf(pattern)===d;},empty:function(){return this=='';},blank:function(){return/^\s*$/.test(this);},interpolate:function(object,pattern){return new Template(this,pattern).evaluate(object);}});if(Prototype.Browser.WebKit||Prototype.Browser.IE)Object.extend(String.prototype,{escapeHTML:function(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');},unescapeHTML:function(){return this.stripTags().replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>');}});String.prototype.gsub.prepareReplacement=function(replacement){if(Object.isFunction(replacement))return replacement;var template=new Template(replacement);return function(match){return template.evaluate(match)};};String.prototype.parseQuery=String.prototype.toQueryParams;Object.extend(String.prototype.escapeHTML,{div:document.createElement('div'),text:document.createTextNode('')});String.prototype.escapeHTML.div.appendChild(String.prototype.escapeHTML.text);var Template=Class.create({initialize:function(template,pattern){this.template=template.toString();this.pattern=pattern||Template.Pattern;},evaluate:function(object){if(Object.isFunction(object.toTemplateReplacements))
object=object.toTemplateReplacements();return this.template.gsub(this.pattern,function(match){if(object==null)return'';var before=match[1]||'';if(before=='\\')return match[2];var ctx=object,expr=match[3];var pattern=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;match=pattern.exec(expr);if(match==null)return before;while(match!=null){var comp=match[1].startsWith('[')?match[2].gsub('\\\\]',']'):match[1];ctx=ctx[comp];if(null==ctx||''==match[3])break;expr=expr.substring('['==match[3]?match[1].length:match[0].length);match=pattern.exec(expr);}
return before+String.interpret(ctx);});}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable={each:function(iterator,context){var index=0;try{this._each(function(value){iterator.call(context,value,index++);});}catch(e){if(e!=$break)throw e;}
return this;},eachSlice:function(number,iterator,context){var index=-number,slices=[],array=this.toArray();if(number<1)return array;while((index+=number)<array.length)
slices.push(array.slice(index,index+number));return slices.collect(iterator,context);},all:function(iterator,context){iterator=iterator||Prototype.K;var result=true;this.each(function(value,index){result=result&&!!iterator.call(context,value,index);if(!result)throw $break;});return result;},any:function(iterator,context){iterator=iterator||Prototype.K;var result=false;this.each(function(value,index){if(result=!!iterator.call(context,value,index))
throw $break;});return result;},collect:function(iterator,context){iterator=iterator||Prototype.K;var results=[];this.each(function(value,index){results.push(iterator.call(context,value,index));});return results;},detect:function(iterator,context){var result;this.each(function(value,index){if(iterator.call(context,value,index)){result=value;throw $break;}});return result;},findAll:function(iterator,context){var results=[];this.each(function(value,index){if(iterator.call(context,value,index))
results.push(value);});return results;},grep:function(filter,iterator,context){iterator=iterator||Prototype.K;var results=[];if(Object.isString(filter))
filter=new RegExp(filter);this.each(function(value,index){if(filter.match(value))
results.push(iterator.call(context,value,index));});return results;},include:function(object){if(Object.isFunction(this.indexOf))
if(this.indexOf(object)!=-1)return true;var found=false;this.each(function(value){if(value==object){found=true;throw $break;}});return found;},inGroupsOf:function(number,fillWith){fillWith=Object.isUndefined(fillWith)?null:fillWith;return this.eachSlice(number,function(slice){while(slice.length<number)slice.push(fillWith);return slice;});},inject:function(memo,iterator,context){this.each(function(value,index){memo=iterator.call(context,memo,value,index);});return memo;},invoke:function(method){var args=$A(arguments).slice(1);return this.map(function(value){return value[method].apply(value,args);});},max:function(iterator,context){iterator=iterator||Prototype.K;var result;this.each(function(value,index){value=iterator.call(context,value,index);if(result==null||value>=result)
result=value;});return result;},min:function(iterator,context){iterator=iterator||Prototype.K;var result;this.each(function(value,index){value=iterator.call(context,value,index);if(result==null||value<result)
result=value;});return result;},partition:function(iterator,context){iterator=iterator||Prototype.K;var trues=[],falses=[];this.each(function(value,index){(iterator.call(context,value,index)?trues:falses).push(value);});return[trues,falses];},pluck:function(property){var results=[];this.each(function(value){results.push(value[property]);});return results;},reject:function(iterator,context){var results=[];this.each(function(value,index){if(!iterator.call(context,value,index))
results.push(value);});return results;},sortBy:function(iterator,context){return this.map(function(value,index){return{value:value,criteria:iterator.call(context,value,index)};}).sort(function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0;}).pluck('value');},toArray:function(){return this.map();},zip:function(){var iterator=Prototype.K,args=$A(arguments);if(Object.isFunction(args.last()))
iterator=args.pop();var collections=[this].concat(args).map($A);return this.map(function(value,index){return iterator(collections.pluck(index));});},size:function(){return this.toArray().length;},inspect:function(){return'#<Enumerable:'+this.toArray().inspect()+'>';}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,filter:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray,every:Enumerable.all,some:Enumerable.any});function $A(iterable){if(!iterable)return[];if(iterable.toArray)return iterable.toArray();var length=iterable.length||0,results=new Array(length);while(length--)results[length]=iterable[length];return results;}
if(Prototype.Browser.WebKit){$A=function(iterable){if(!iterable)return[];if(!(typeof iterable==='function'&&typeof iterable.length==='number'&&typeof iterable.item==='function')&&iterable.toArray)
return iterable.toArray();var length=iterable.length||0,results=new Array(length);while(length--)results[length]=iterable[length];return results;};}
Array.from=$A;Object.extend(Array.prototype,Enumerable);if(!Array.prototype._reverse)Array.prototype._reverse=Array.prototype.reverse;Object.extend(Array.prototype,{_each:function(iterator){for(var i=0,length=this.length;i<length;i++)
iterator(this[i]);},clear:function(){this.length=0;return this;},first:function(){return this[0];},last:function(){return this[this.length-1];},compact:function(){return this.select(function(value){return value!=null;});},flatten:function(){return this.inject([],function(array,value){return array.concat(Object.isArray(value)?value.flatten():[value]);});},without:function(){var values=$A(arguments);return this.select(function(value){return!values.include(value);});},reverse:function(inline){return(inline!==false?this:this.toArray())._reverse();},reduce:function(){return this.length>1?this:this[0];},uniq:function(sorted){return this.inject([],function(array,value,index){if(0==index||(sorted?array.last()!=value:!array.include(value)))
array.push(value);return array;});},intersect:function(array){return this.uniq().findAll(function(item){return array.detect(function(value){return item===value});});},clone:function(){return[].concat(this);},size:function(){return this.length;},inspect:function(){return'['+this.map(Object.inspect).join(', ')+']';},toJSON:function(){var results=[];this.each(function(object){var value=Object.toJSON(object);if(!Object.isUndefined(value))results.push(value);});return'['+results.join(', ')+']';}});if(Object.isFunction(Array.prototype.forEach))
Array.prototype._each=Array.prototype.forEach;if(!Array.prototype.indexOf)Array.prototype.indexOf=function(item,i){i||(i=0);var length=this.length;if(i<0)i=length+i;for(;i<length;i++)
if(this[i]===item)return i;return-1;};if(!Array.prototype.lastIndexOf)Array.prototype.lastIndexOf=function(item,i){i=isNaN(i)?this.length:(i<0?this.length+i:i)+1;var n=this.slice(0,i).reverse().indexOf(item);return(n<0)?n:i-n-1;};Array.prototype.toArray=Array.prototype.clone;function $w(string){if(!Object.isString(string))return[];string=string.strip();return string?string.split(/\s+/):[];}
if(Prototype.Browser.Opera){Array.prototype.concat=function(){var array=[];for(var i=0,length=this.length;i<length;i++)array.push(this[i]);for(var i=0,length=arguments.length;i<length;i++){if(Object.isArray(arguments[i])){for(var j=0,arrayLength=arguments[i].length;j<arrayLength;j++)
array.push(arguments[i][j]);}else{array.push(arguments[i]);}}
return array;};}
Object.extend(Number.prototype,{toColorPart:function(){return this.toPaddedString(2,16);},succ:function(){return this+1;},times:function(iterator,context){$R(0,this,true).each(iterator,context);return this;},toPaddedString:function(length,radix){var string=this.toString(radix||10);return'0'.times(length-string.length)+string;},toJSON:function(){return isFinite(this)?this.toString():'null';}});$w('abs round ceil floor').each(function(method){Number.prototype[method]=Math[method].methodize();});function $H(object){return new Hash(object);};var Hash=Class.create(Enumerable,(function(){function toQueryPair(key,value){if(Object.isUndefined(value))return key;return key+'='+encodeURIComponent(String.interpret(value));}
return{initialize:function(object){this._object=Object.isHash(object)?object.toObject():Object.clone(object);},_each:function(iterator){for(var key in this._object){var value=this._object[key],pair=[key,value];pair.key=key;pair.value=value;iterator(pair);}},set:function(key,value){return this._object[key]=value;},get:function(key){if(this._object[key]!==Object.prototype[key])
return this._object[key];},unset:function(key){var value=this._object[key];delete this._object[key];return value;},toObject:function(){return Object.clone(this._object);},keys:function(){return this.pluck('key');},values:function(){return this.pluck('value');},index:function(value){var match=this.detect(function(pair){return pair.value===value;});return match&&match.key;},merge:function(object){return this.clone().update(object);},update:function(object){return new Hash(object).inject(this,function(result,pair){result.set(pair.key,pair.value);return result;});},toQueryString:function(){return this.inject([],function(results,pair){var key=encodeURIComponent(pair.key),values=pair.value;if(values&&typeof values=='object'){if(Object.isArray(values))
return results.concat(values.map(toQueryPair.curry(key)));}else results.push(toQueryPair(key,values));return results;}).join('&');},inspect:function(){return'#<Hash:{'+this.map(function(pair){return pair.map(Object.inspect).join(': ');}).join(', ')+'}>';},toJSON:function(){return Object.toJSON(this.toObject());},clone:function(){return new Hash(this);}}})());Hash.prototype.toTemplateReplacements=Hash.prototype.toObject;Hash.from=$H;var ObjectRange=Class.create(Enumerable,{initialize:function(start,end,exclusive){this.start=start;this.end=end;this.exclusive=exclusive;},_each:function(iterator){var value=this.start;while(this.include(value)){iterator(value);value=value.succ();}},include:function(value){if(value<this.start)
return false;if(this.exclusive)
return value<this.end;return value<=this.end;}});var $R=function(start,end,exclusive){return new ObjectRange(start,end,exclusive);};var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject('Msxml2.XMLHTTP')},function(){return new ActiveXObject('Microsoft.XMLHTTP')})||false;},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(iterator){this.responders._each(iterator);},register:function(responder){if(!this.include(responder))
this.responders.push(responder);},unregister:function(responder){this.responders=this.responders.without(responder);},dispatch:function(callback,request,transport,json){this.each(function(responder){if(Object.isFunction(responder[callback])){try{responder[callback].apply(responder,[request,transport,json]);}catch(e){}}});}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(options){this.options={method:'post',asynchronous:true,contentType:'application/x-www-form-urlencoded',encoding:'UTF-8',parameters:'',evalJSON:true,evalJS:true};Object.extend(this.options,options||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters))
this.options.parameters=this.options.parameters.toQueryParams();else if(Object.isHash(this.options.parameters))
this.options.parameters=this.options.parameters.toObject();}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,url,options){$super(options);this.transport=Ajax.getTransport();this.request(url);},request:function(url){this.url=url;this.method=this.options.method;var params=Object.clone(this.options.parameters);if(!['get','post'].include(this.method)){params['_method']=this.method;this.method='post';}
if((this.method=='post')&&(typeof(FORM_AUTH_TOKEN)!='undefined'))
params.authenticity_token=FORM_AUTH_TOKEN;if((!params.project_id)&&(typeof(pageProperties)!='undefined')&&(pageProperties.projectId))
params.project_id=pageProperties.projectId;this.parameters=params;if(params=Object.toQueryString(params)){if(this.method=='get')
this.url+=(this.url.include('?')?'&':'?')+params;else if(/Safari|KHTML/.test(navigator.userAgent))
params+='&_=';}
try{var response=new Ajax.Response(this);if(this.options.onCreate)this.options.onCreate(response);Ajax.Responders.dispatch('onCreate',this,response);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous)this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=='post'?(this.options.postBody||params):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType)
this.onStateChange();}
catch(e){this.dispatchException(e);}},onStateChange:function(){var readyState=this.transport.readyState;if(readyState>1&&!((readyState==4)&&this._complete))
this.respondToReadyState(this.transport.readyState);},setRequestHeaders:function(){var headers={'X-Requested-With':'XMLHttpRequest','X-Prototype-Version':Prototype.Version,'Accept':'text/javascript, text/html, application/xml, text/xml, */*'};if(this.method=='post'){headers['Content-type']=this.options.contentType+
(this.options.encoding?'; charset='+this.options.encoding:'');if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005)
headers['Connection']='close';}
if(typeof this.options.requestHeaders=='object'){var extras=this.options.requestHeaders;if(Object.isFunction(extras.push))
for(var i=0,length=extras.length;i<length;i+=2)
headers[extras[i]]=extras[i+1];else
$H(extras).each(function(pair){headers[pair.key]=pair.value});}
for(var name in headers)
this.transport.setRequestHeader(name,headers[name]);},success:function(){var status=this.getStatus();return!status||(status>=200&&status<300);},getStatus:function(){try{return this.transport.status||0;}catch(e){return 0}},respondToReadyState:function(readyState){var state=Ajax.Request.Events[readyState],response=new Ajax.Response(this);if(state=='Complete'){try{this._complete=true;(this.options['on'+response.status]||this.options['on'+(this.success()?'Success':'Failure')]||Prototype.emptyFunction)(response,response.headerJSON);}catch(e){this.dispatchException(e);}
var contentType=response.getHeader('Content-type');if(this.options.evalJS=='force'||(this.options.evalJS&&this.isSameOrigin()&&contentType&&contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))
this.evalResponse();}
try{(this.options['on'+state]||Prototype.emptyFunction)(response,response.headerJSON);Ajax.Responders.dispatch('on'+state,this,response,response.headerJSON);}catch(e){this.dispatchException(e);}
if(state=='Complete'){this.transport.onreadystatechange=Prototype.emptyFunction;}},isSameOrigin:function(){var m=this.url.match(/^\s*https?:\/\/[^\/]*/);return!m||(m[0]=='#{protocol}//#{domain}#{port}'.interpolate({protocol:location.protocol,domain:document.domain,port:location.port?':'+location.port:''}));},getHeader:function(name){try{return this.transport.getResponseHeader(name)||null;}catch(e){return null}},evalResponse:function(){try{return eval((this.transport.responseText||'').unfilterJSON());}catch(e){this.dispatchException(e);}},dispatchException:function(exception){(this.options.onException||Prototype.emptyFunction)(this,exception);Ajax.Responders.dispatch('onException',this,exception);}});Ajax.Request.Events=['Uninitialized','Loading','Loaded','Interactive','Complete'];Ajax.Response=Class.create({initialize:function(request){this.request=request;var transport=this.transport=request.transport,readyState=this.readyState=transport.readyState;if((readyState>2&&!Prototype.Browser.IE)||readyState==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(transport.responseText);this.headerJSON=this._getHeaderJSON();}
if(readyState==4){var xml=transport.responseXML;this.responseXML=Object.isUndefined(xml)?null:xml;this.responseJSON=this._getResponseJSON();}},status:0,statusText:'',getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||'';}catch(e){return''}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders();}catch(e){return null}},getResponseHeader:function(name){return this.transport.getResponseHeader(name);},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders();},_getHeaderJSON:function(){var json=this.getHeader('X-JSON');if(!json)return null;json=decodeURIComponent(escape(json));try{return json.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin());}catch(e){this.request.dispatchException(e);}},_getResponseJSON:function(){var options=this.request.options;if(!options.evalJSON||(options.evalJSON!='force'&&!(this.getHeader('Content-type')||'').include('application/json'))||this.responseText.blank())
return null;try{return this.responseText.evalJSON(options.sanitizeJSON||!this.request.isSameOrigin());}catch(e){this.request.dispatchException(e);}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,container,url,options){this.container={success:(container.success||container),failure:(container.failure||(container.success?null:container))};options=Object.clone(options);var onComplete=options.onComplete;options.onComplete=(function(response,json){this.updateContent(response.responseText);if(Object.isFunction(onComplete))onComplete(response,json);}).bind(this);$super(url,options);},updateContent:function(responseText){var receiver=this.container[this.success()?'success':'failure'],options=this.options;if(!options.evalScripts)responseText=responseText.stripScripts();if(receiver=$(receiver)){if(options.insertion){if(Object.isString(options.insertion)){var insertion={};insertion[options.insertion]=responseText;receiver.insert(insertion);}
else options.insertion(receiver,responseText);}
else receiver.update(responseText);}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,container,url,options){$super(options);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=container;this.url=url;this.start();},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent();},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments);},updateComplete:function(response){if(this.options.decay){this.decay=(response.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=response.responseText;}
this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency);},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options);}});function $(element){if(arguments.length>1){for(var i=0,elements=[],length=arguments.length;i<length;i++)
elements.push($(arguments[i]));return elements;}
if(Object.isString(element))
element=document.getElementById(element);return Element.extend(element);}
if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(expression,parentElement){var results=[];var query=document.evaluate(expression,$(parentElement)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0,length=query.snapshotLength;i<length;i++)
results.push(Element.extend(query.snapshotItem(i)));return results;};}
if(!window.Node)var Node={};if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});}
(function(){var element=this.Element;this.Element=function(tagName,attributes){attributes=attributes||{};tagName=tagName.toLowerCase();var cache=Element.cache;if(Prototype.Browser.IE&&attributes.name){tagName='<'+tagName+' name="'+attributes.name+'">';delete attributes.name;return Element.writeAttribute(document.createElement(tagName),attributes);}
if(!cache[tagName])cache[tagName]=Element.extend(document.createElement(tagName));return Element.writeAttribute(cache[tagName].cloneNode(false),attributes);};Object.extend(this.Element,element||{});if(element)this.Element.prototype=element.prototype;}).call(window);Element.cache={};Element.Methods={visible:function(element){return $(element).style.display!='none';},toggle:function(element){element=$(element);Element[Element.visible(element)?'hide':'show'](element);return element;},hide:function(element){element=$(element);element.style.display='none';return element;},show:function(element){element=$(element);element.style.display='';return element;},remove:function(element){element=$(element);element.parentNode.removeChild(element);return element;},update:function(element,content,options){options=options||{evalScripts:true,stripScripts:true};element=$(element);if(content&&content.toElement)content=content.toElement();if(Object.isElement(content))return element.update().insert(content);content=Object.toHTML(content);element.innerHTML=options.stripScripts?content.stripScripts():content;if(options.evalScripts)content.evalScripts.bind(content).defer();return element;},replace:function(element,content,options){options=options||{evalScripts:true,stripScripts:true};element=$(element);if(content&&content.toElement)content=content.toElement();else if(!Object.isElement(content)){content=Object.toHTML(content);var range=element.ownerDocument.createRange();range.selectNode(element);if(options.evalScripts)content.evalScripts.bind(content).defer();content=range.createContextualFragment(options.stripScripts?content.stripScripts():content);}
element.parentNode.replaceChild(content,element);return element;},insert:function(element,insertions){element=$(element);if(Object.isString(insertions)||Object.isNumber(insertions)||Object.isElement(insertions)||(insertions&&(insertions.toElement||insertions.toHTML)))
insertions={bottom:insertions};var content,insert,tagName,childNodes;for(var position in insertions){content=insertions[position];position=position.toLowerCase();insert=Element._insertionTranslations[position];if(content&&content.toElement)content=content.toElement();if(Object.isElement(content)){insert(element,content);continue;}
content=Object.toHTML(content);tagName=((position=='before'||position=='after')?element.parentNode:element).tagName.toUpperCase();childNodes=Element._getContentFromAnonymousElement(tagName,content.stripScripts());if(position=='top'||position=='after')childNodes.reverse();childNodes.each(insert.curry(element));content.evalScripts.bind(content).defer();}
return element;},wrap:function(element,wrapper,attributes){element=$(element);if(Object.isElement(wrapper))
$(wrapper).writeAttribute(attributes||{});else if(Object.isString(wrapper))wrapper=new Element(wrapper,attributes);else wrapper=new Element('div',wrapper);if(element.parentNode)
element.parentNode.replaceChild(wrapper,element);wrapper.appendChild(element);return wrapper;},inspect:function(element){element=$(element);var result='<'+element.tagName.toLowerCase();$H({'id':'id','className':'class'}).each(function(pair){var property=pair.first(),attribute=pair.last();var value=(element[property]||'').toString();if(value)result+=' '+attribute+'='+value.inspect(true);});return result+'>';},recursivelyCollect:function(element,property){element=$(element);var elements=[];while(element=element[property])
if(element.nodeType==1)
elements.push(Element.extend(element));return elements;},ancestors:function(element){return $(element).recursivelyCollect('parentNode');},descendants:function(element){return $(element).select("*");},firstDescendant:function(element){element=$(element).firstChild;while(element&&element.nodeType!=1)element=element.nextSibling;return $(element);},immediateDescendants:function(element){if(!(element=$(element).firstChild))return[];while(element&&element.nodeType!=1)element=element.nextSibling;if(element)return[element].concat($(element).nextSiblings());return[];},previousSiblings:function(element){return $(element).recursivelyCollect('previousSibling');},nextSiblings:function(element){return $(element).recursivelyCollect('nextSibling');},siblings:function(element){element=$(element);return element.previousSiblings().reverse().concat(element.nextSiblings());},match:function(element,selector){if(Object.isString(selector))
selector=new Selector(selector);return selector.match($(element));},up:function(element,expression,index){element=$(element);if(arguments.length==1)return $(element.parentNode);var ancestors=element.ancestors();return Object.isNumber(expression)?ancestors[expression]:Selector.findElement(ancestors,expression,index);},down:function(element,expression,index){element=$(element);if(arguments.length==1)return element.firstDescendant();return Object.isNumber(expression)?element.descendants()[expression]:Element.select(element,expression)[index||0];},previous:function(element,expression,index){element=$(element);if(arguments.length==1)return $(Selector.handlers.previousElementSibling(element));var previousSiblings=element.previousSiblings();return Object.isNumber(expression)?previousSiblings[expression]:Selector.findElement(previousSiblings,expression,index);},next:function(element,expression,index){element=$(element);if(arguments.length==1)return $(Selector.handlers.nextElementSibling(element));var nextSiblings=element.nextSiblings();return Object.isNumber(expression)?nextSiblings[expression]:Selector.findElement(nextSiblings,expression,index);},select:function(){var args=$A(arguments),element=$(args.shift());return Selector.findChildElements(element,args);},adjacent:function(){var args=$A(arguments),element=$(args.shift());return Selector.findChildElements(element.parentNode,args).without(element);},identify:function(element){element=$(element);var id=element.readAttribute('id'),self=arguments.callee;if(id)return id;do{id='anonymous_element_'+self.counter++}while($(id));element.writeAttribute('id',id);return id;},readAttribute:function(element,name){element=$(element);if(Prototype.Browser.IE){var t=Element._attributeTranslations.read;if(t.values[name])return t.values[name](element,name);if(t.names[name])name=t.names[name];if(name.include(':')){return(!element.attributes||!element.attributes[name])?null:element.attributes[name].value;}}
return element.getAttribute(name);},writeAttribute:function(element,name,value){element=$(element);var attributes={},t=Element._attributeTranslations.write;if(typeof name=='object')attributes=name;else attributes[name]=Object.isUndefined(value)?true:value;for(var attr in attributes){name=t.names[attr]||attr;value=attributes[attr];if(t.values[attr])name=t.values[attr](element,value);if(value===false||value===null)
element.removeAttribute(name);else if(value===true)
element.setAttribute(name,name);else element.setAttribute(name,value);}
return element;},getHeight:function(element){return $(element).getDimensions().height;},getWidth:function(element){return $(element).getDimensions().width;},classNames:function(element){return new Element.ClassNames(element);},hasClassName:function(element,className){if(!(element=$(element)))return;var elementClassName=element.className;return(elementClassName.length>0&&(elementClassName==className||new RegExp("(^|\\s)"+className+"(\\s|$)").test(elementClassName)));},addClassName:function(element,className){if(!(element=$(element)))return;if(!element.hasClassName(className))
element.className+=(element.className?' ':'')+className;return element;},removeClassName:function(element,className){if(!(element=$(element)))return;element.className=element.className.replace(new RegExp("(^|\\s+)"+className+"(\\s+|$)"),' ').strip();return element;},toggleClassName:function(element,className){if(!(element=$(element)))return;return element[element.hasClassName(className)?'removeClassName':'addClassName'](className);},cleanWhitespace:function(element){element=$(element);var node=element.firstChild;while(node){var nextNode=node.nextSibling;if(node.nodeType==3&&!/\S/.test(node.nodeValue))
element.removeChild(node);node=nextNode;}
return element;},empty:function(element){return $(element).innerHTML.blank();},descendantOf:function(element,ancestor){element=$(element),ancestor=$(ancestor);if(element.compareDocumentPosition)
return(element.compareDocumentPosition(ancestor)&8)===8;if(ancestor.contains)
return ancestor.contains(element)&&ancestor!==element;while(element=element.parentNode)
if(element==ancestor)return true;return false;},scrollTo:function(element){element=$(element);var pos=element.cumulativeOffset();window.scrollTo(pos[0],pos[1]);return element;},getStyle:function(element,style){element=$(element);style=style=='float'?'cssFloat':style.camelize();var value=element.style[style];if(!value||value=='auto'){var css=document.defaultView.getComputedStyle(element,null);value=css?css[style]:null;}
if(style=='opacity')return value?parseFloat(value):1.0;return value=='auto'?null:value;},getOpacity:function(element){return $(element).getStyle('opacity');},setStyle:function(element,styles){element=$(element);var elementStyle=element.style,match;if(Object.isString(styles)){element.style.cssText+=';'+styles;return styles.include('opacity')?element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element;}
for(var property in styles)
if(property=='opacity')element.setOpacity(styles[property]);else
elementStyle[(property=='float'||property=='cssFloat')?(Object.isUndefined(elementStyle.styleFloat)?'cssFloat':'styleFloat'):property]=styles[property];return element;},setOpacity:function(element,value){element=$(element);element.style.opacity=(value==1||value==='')?'':(value<0.00001)?0:value;return element;},getDimensions:function(element){element=$(element);var display=element.getStyle('display');if(display!='none'&&display!=null)
return{width:element.offsetWidth,height:element.offsetHeight};var els=element.style;var originalVisibility=els.visibility;var originalPosition=els.position;var originalDisplay=els.display;els.visibility='hidden';els.position='absolute';els.display='block';var originalWidth=element.clientWidth;var originalHeight=element.clientHeight;els.display=originalDisplay;els.position=originalPosition;els.visibility=originalVisibility;return{width:originalWidth,height:originalHeight};},makePositioned:function(element){element=$(element);var pos=Element.getStyle(element,'position');if(pos=='static'||!pos){element._madePositioned=true;element.style.position='relative';if(Prototype.Browser.Opera){element.style.top=0;element.style.left=0;}}
return element;},undoPositioned:function(element){element=$(element);if(element._madePositioned){element._madePositioned=undefined;element.style.position=element.style.top=element.style.left=element.style.bottom=element.style.right='';}
return element;},makeClipping:function(element){element=$(element);if(element._overflow)return element;element._overflow=Element.getStyle(element,'overflow')||'auto';if(element._overflow!=='hidden')
element.style.overflow='hidden';return element;},undoClipping:function(element){element=$(element);if(!element._overflow)return element;element.style.overflow=element._overflow=='auto'?'':element._overflow;element._overflow=null;return element;},cumulativeOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;}while(element);return Element._returnOffset(valueL,valueT);},positionedOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;if(element){if(element.tagName.toUpperCase()=='BODY')break;var p=Element.getStyle(element,'position');if(p!=='static')break;}}while(element);return Element._returnOffset(valueL,valueT);},absolutize:function(element){element=$(element);if(element.getStyle('position')=='absolute')return element;var offsets=element.positionedOffset();var top=offsets[1];var left=offsets[0];var width=element.clientWidth;var height=element.clientHeight;element._originalLeft=left-parseFloat(element.style.left||0);element._originalTop=top-parseFloat(element.style.top||0);element._originalWidth=element.style.width;element._originalHeight=element.style.height;element.style.position='absolute';element.style.top=top+'px';element.style.left=left+'px';element.style.width=width+'px';element.style.height=height+'px';return element;},relativize:function(element){element=$(element);if(element.getStyle('position')=='relative')return element;element.style.position='relative';var top=parseFloat(element.style.top||0)-(element._originalTop||0);var left=parseFloat(element.style.left||0)-(element._originalLeft||0);element.style.top=top+'px';element.style.left=left+'px';element.style.height=element._originalHeight;element.style.width=element._originalWidth;return element;},cumulativeScrollOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.scrollTop||0;valueL+=element.scrollLeft||0;element=element.parentNode;}while(element);return Element._returnOffset(valueL,valueT);},getOffsetParent:function(element){if(element.offsetParent)return $(element.offsetParent);if(element==document.body)return $(element);while((element=element.parentNode)&&element!=document.body)
if(Element.getStyle(element,'position')!='static')
return $(element);return $(document.body);},viewportOffset:function(forElement){var valueT=0,valueL=0;var element=forElement;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==document.body&&Element.getStyle(element,'position')=='absolute')break;}while(element=element.offsetParent);element=forElement;do{if(!Prototype.Browser.Opera||(element.tagName&&(element.tagName.toUpperCase()=='BODY'))){valueT-=element.scrollTop||0;valueL-=element.scrollLeft||0;}}while(element=element.parentNode);return Element._returnOffset(valueL,valueT);},clonePosition:function(element,source){var options=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});source=$(source);var p=source.viewportOffset();element=$(element);var delta=[0,0];var parent=null;if(Element.getStyle(element,'position')=='absolute'){parent=element.getOffsetParent();delta=parent.viewportOffset();}
if(parent==document.body){delta[0]-=document.body.offsetLeft;delta[1]-=document.body.offsetTop;}
if(options.setLeft)element.style.left=(p[0]-delta[0]+options.offsetLeft)+'px';if(options.setTop)element.style.top=(p[1]-delta[1]+options.offsetTop)+'px';if(options.setWidth)element.style.width=source.offsetWidth+'px';if(options.setHeight)element.style.height=source.offsetHeight+'px';return element;}};Element.Methods.identify.counter=1;Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:'class',htmlFor:'for'},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(proceed,element,style){switch(style){case'left':case'top':case'right':case'bottom':if(proceed(element,'position')==='static')return null;case'height':case'width':if(!Element.visible(element))return null;var dim=parseInt(proceed(element,style),10);if(dim!==element['offset'+style.capitalize()])
return dim+'px';var properties;if(style==='height'){properties=['border-top-width','padding-top','padding-bottom','border-bottom-width'];}
else{properties=['border-left-width','padding-left','padding-right','border-right-width'];}
return properties.inject(dim,function(memo,property){var val=proceed(element,property);return val===null?memo:memo-parseInt(val,10);})+'px';default:return proceed(element,style);}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(proceed,element,attribute){if(attribute==='title')return element.title;return proceed(element,attribute);});}
else if(Prototype.Browser.IE){Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(proceed,element){element=$(element);try{element.offsetParent}
catch(e){return $(document.body)}
var position=element.getStyle('position');if(position!=='static')return proceed(element);element.setStyle({position:'relative'});var value=proceed(element);element.setStyle({position:position});return value;});$w('positionedOffset viewportOffset').each(function(method){Element.Methods[method]=Element.Methods[method].wrap(function(proceed,element){element=$(element);try{element.offsetParent}
catch(e){return Element._returnOffset(0,0)}
var position=element.getStyle('position');if(position!=='static')return proceed(element);var offsetParent=element.getOffsetParent();if(offsetParent&&offsetParent.getStyle('position')==='fixed')
offsetParent.setStyle({zoom:1});element.setStyle({position:'relative'});var value=proceed(element);element.setStyle({position:position});return value;});});Element.Methods.cumulativeOffset=Element.Methods.cumulativeOffset.wrap(function(proceed,element){try{element.offsetParent}
catch(e){return Element._returnOffset(0,0)}
return proceed(element);});Element.Methods.getStyle=function(element,style){element=$(element);style=(style=='float'||style=='cssFloat')?'styleFloat':style.camelize();var value=element.style[style];if(!value&&element.currentStyle)value=element.currentStyle[style];if(style=='opacity'){if(value=(element.getStyle('filter')||'').match(/alpha\(opacity=(.*)\)/))
if(value[1])return parseFloat(value[1])/100;return 1.0;}
if(value=='auto'){if((style=='width'||style=='height')&&(element.getStyle('display')!='none'))
return element['offset'+style.capitalize()]+'px';return null;}
return value;};Element.Methods.setOpacity=function(element,value){function stripAlpha(filter){return filter.replace(/alpha\([^\)]*\)/gi,'');}
element=$(element);var currentStyle=element.currentStyle;if((currentStyle&&!currentStyle.hasLayout)||(!currentStyle&&element.style.zoom=='normal'))
element.style.zoom=1;var filter=element.getStyle('filter'),style=element.style;if(value==1||value===''){(filter=stripAlpha(filter))?style.filter=filter:style.removeAttribute('filter');return element;}else if(value<0.00001)value=0;style.filter=stripAlpha(filter)+'alpha(opacity='+(value*100)+')';return element;};Element._attributeTranslations={read:{names:{'class':'className','for':'htmlFor'},values:{_getAttr:function(element,attribute){return element.getAttribute(attribute,2);},_getAttrNode:function(element,attribute){var node=element.getAttributeNode(attribute);return node?node.value:"";},_getEv:(function(element,attribute){var el=document.createElement('div');el.onclick=Prototype.emptyFunction;var value=el.getAttribute('onclick');var f;if(String(value).indexOf('{')>-1){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute)return null;attribute=attribute.toString();if(!attribute.match(/^function/))return attribute;attribute=attribute.split('{')[1];attribute=attribute.split('}')[0];return attribute.strip();}}
else if(value===''){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute)return null;return attribute.strip();}}
el=null;return f;})(),_flag:function(element,attribute){return $(element).hasAttribute(attribute)?attribute:null;},style:function(element){return element.style.cssText.toLowerCase();},title:function(element){return element.title;}}}};Element._attributeTranslations.write={names:Object.extend({cellpadding:'cellPadding',cellspacing:'cellSpacing'},Element._attributeTranslations.read.names),values:{checked:function(element,value){element.checked=!!value;},style:function(element,value){element.style.cssText=value?value:'';}}};Element._attributeTranslations.has={};$w('colSpan rowSpan vAlign dateTime accessKey tabIndex '+'encType maxLength readOnly longDesc frameBorder').each(function(attr){Element._attributeTranslations.write.names[attr.toLowerCase()]=attr;Element._attributeTranslations.has[attr.toLowerCase()]=attr;});(function(v){Object.extend(v,{href:v._getAttr,src:v._getAttr,type:v._getAttr,action:v._getAttrNode,disabled:v._flag,checked:v._flag,readonly:v._flag,multiple:v._flag,onload:v._getEv,onunload:v._getEv,onclick:v._getEv,ondblclick:v._getEv,onmousedown:v._getEv,onmouseup:v._getEv,onmouseover:v._getEv,onmousemove:v._getEv,onmouseout:v._getEv,onfocus:v._getEv,onblur:v._getEv,onkeypress:v._getEv,onkeydown:v._getEv,onkeyup:v._getEv,onsubmit:v._getEv,onreset:v._getEv,onselect:v._getEv,onchange:v._getEv});})(Element._attributeTranslations.read.values);}
else if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1)?0.999999:(value==='')?'':(value<0.00001)?0:value;return element;};}
else if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1||value==='')?'':(value<0.00001)?0:value;if(value==1)
if(element.tagName.toUpperCase()=='IMG'&&element.width){element.width++;element.width--;}else try{var n=document.createTextNode(' ');element.appendChild(n);element.removeChild(n);}catch(e){}
return element;};Element.Methods.cumulativeOffset=function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==document.body)
if(Element.getStyle(element,'position')=='absolute')break;element=element.offsetParent;}while(element);return Element._returnOffset(valueL,valueT);};}
if(Prototype.Browser.IE||Prototype.Browser.Opera){Element.Methods.update=function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();if(Object.isElement(content))return element.update().insert(content);content=Object.toHTML(content);var tagName=element.tagName.toUpperCase();if(tagName in Element._insertionTranslations.tags){$A(element.childNodes).each(function(node){element.removeChild(node)});Element._getContentFromAnonymousElement(tagName,content.stripScripts()).each(function(node){element.appendChild(node)});}
else element.innerHTML=content.stripScripts();content.evalScripts.bind(content).defer();return element;};}
if('outerHTML'in document.createElement('div')){Element.Methods.replace=function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();if(Object.isElement(content)){element.parentNode.replaceChild(content,element);return element;}
content=Object.toHTML(content);var parent=element.parentNode,tagName=parent.tagName.toUpperCase();if(Element._insertionTranslations.tags[tagName]){var nextSibling=element.next();var fragments=Element._getContentFromAnonymousElement(tagName,content.stripScripts());parent.removeChild(element);if(nextSibling)
fragments.each(function(node){parent.insertBefore(node,nextSibling)});else
fragments.each(function(node){parent.appendChild(node)});}
else element.outerHTML=content.stripScripts();content.evalScripts.bind(content).defer();return element;};}
Element._returnOffset=function(l,t){var result=[l,t];result.left=l;result.top=t;return result;};Element._getContentFromAnonymousElement=function(tagName,html){var div=new Element('div'),t=Element._insertionTranslations.tags[tagName];if(t){div.innerHTML=t[0]+html+t[1];t[2].times(function(){div=div.firstChild});}else div.innerHTML=html;return $A(div.childNodes);};Element._insertionTranslations={before:function(element,node){element.parentNode.insertBefore(node,element);},top:function(element,node){element.insertBefore(node,element.firstChild);},bottom:function(element,node){element.appendChild(node);},after:function(element,node){element.parentNode.insertBefore(node,element.nextSibling);},tags:{TABLE:['<table>','</table>',1],TBODY:['<table><tbody>','</tbody></table>',2],TR:['<table><tbody><tr>','</tr></tbody></table>',3],TD:['<table><tbody><tr><td>','</td></tr></tbody></table>',4],SELECT:['<select>','</select>',1]}};(function(){Object.extend(this.tags,{THEAD:this.tags.TBODY,TFOOT:this.tags.TBODY,TH:this.tags.TD});}).call(Element._insertionTranslations);Element.Methods.Simulated={hasAttribute:function(element,attribute){attribute=Element._attributeTranslations.has[attribute]||attribute;var node=$(element).getAttributeNode(attribute);return!!(node&&node.specified);}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);if(!Prototype.BrowserFeatures.ElementExtensions&&document.createElement('div')['__proto__']){window.HTMLElement={};window.HTMLElement.prototype=document.createElement('div')['__proto__'];Prototype.BrowserFeatures.ElementExtensions=true;}
Element.extend=(function(){if(Prototype.BrowserFeatures.SpecificElementExtensions)
return Prototype.K;var Methods={},ByTag=Element.Methods.ByTag;var extend=Object.extend(function(element){if(!element||element._extendedByPrototype||element.nodeType!=1||element==window)return element;var methods=Object.clone(Methods),tagName=element.tagName.toUpperCase(),property,value;if(ByTag[tagName])Object.extend(methods,ByTag[tagName]);for(property in methods){value=methods[property];if(Object.isFunction(value)&&!(property in element))
element[property]=value.methodize();}
element._extendedByPrototype=Prototype.emptyFunction;return element;},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(Methods,Element.Methods);Object.extend(Methods,Element.Methods.Simulated);}}});extend.refresh();return extend;})();Element.hasAttribute=function(element,attribute){if(element.hasAttribute)return element.hasAttribute(attribute);return Element.Methods.Simulated.hasAttribute(element,attribute);};Element.addMethods=function(methods){var F=Prototype.BrowserFeatures,T=Element.Methods.ByTag;if(!methods){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{"FORM":Object.clone(Form.Methods),"INPUT":Object.clone(Form.Element.Methods),"SELECT":Object.clone(Form.Element.Methods),"TEXTAREA":Object.clone(Form.Element.Methods)});}
if(arguments.length==2){var tagName=methods;methods=arguments[1];}
if(!tagName)Object.extend(Element.Methods,methods||{});else{if(Object.isArray(tagName))tagName.each(extend);else extend(tagName);}
function extend(tagName){tagName=tagName.toUpperCase();if(!Element.Methods.ByTag[tagName])
Element.Methods.ByTag[tagName]={};Object.extend(Element.Methods.ByTag[tagName],methods);}
function copy(methods,destination,onlyIfAbsent){onlyIfAbsent=onlyIfAbsent||false;for(var property in methods){var value=methods[property];if(!Object.isFunction(value))continue;if(!onlyIfAbsent||!(property in destination))
destination[property]=value.methodize();}}
function findDOMClass(tagName){var klass;var trans={"OPTGROUP":"OptGroup","TEXTAREA":"TextArea","P":"Paragraph","FIELDSET":"FieldSet","UL":"UList","OL":"OList","DL":"DList","DIR":"Directory","H1":"Heading","H2":"Heading","H3":"Heading","H4":"Heading","H5":"Heading","H6":"Heading","Q":"Quote","INS":"Mod","DEL":"Mod","A":"Anchor","IMG":"Image","CAPTION":"TableCaption","COL":"TableCol","COLGROUP":"TableCol","THEAD":"TableSection","TFOOT":"TableSection","TBODY":"TableSection","TR":"TableRow","TH":"TableCell","TD":"TableCell","FRAMESET":"FrameSet","IFRAME":"IFrame"};if(trans[tagName])klass='HTML'+trans[tagName]+'Element';if(window[klass])return window[klass];klass='HTML'+tagName+'Element';if(window[klass])return window[klass];klass='HTML'+tagName.capitalize()+'Element';if(window[klass])return window[klass];window[klass]={};window[klass].prototype=document.createElement(tagName)['__proto__'];return window[klass];}
if(F.ElementExtensions){copy(Element.Methods,HTMLElement.prototype);copy(Element.Methods.Simulated,HTMLElement.prototype,true);}
if(F.SpecificElementExtensions){for(var tag in Element.Methods.ByTag){var klass=findDOMClass(tag);if(Object.isUndefined(klass))continue;copy(T[tag],klass.prototype);}}
Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh)Element.extend.refresh();Element.cache={};};document.viewport={getDimensions:function(){var dimensions={},B=Prototype.Browser;$w('width height').each(function(d){var D=d.capitalize();if(B.WebKit&&!document.evaluate){dimensions[d]=self['inner'+D];}else if(B.Opera&&parseFloat(window.opera.version())<9.5){dimensions[d]=document.body['client'+D]}else{dimensions[d]=document.documentElement['client'+D];}});return dimensions;},getWidth:function(){return this.getDimensions().width;},getHeight:function(){return this.getDimensions().height;},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop);}};var Selector=Class.create({initialize:function(expression){this.expression=expression.strip();if(this.shouldUseSelectorsAPI()){this.mode='selectorsAPI';}else if(this.shouldUseXPath()){this.mode='xpath';this.compileXPathMatcher();}else{this.mode="normal";this.compileMatcher();}},shouldUseXPath:function(){if(!Prototype.BrowserFeatures.XPath)return false;var e=this.expression;if(Prototype.Browser.WebKit&&(e.include("-of-type")||e.include(":empty")))
return false;if((/(\[[\w-]*?:|:checked)/).test(e))
return false;return true;},shouldUseSelectorsAPI:function(){if(!Prototype.BrowserFeatures.SelectorsAPI)return false;if(!Selector._div)Selector._div=new Element('div');try{Selector._div.querySelector(this.expression);}catch(e){return false;}
return true;},compileMatcher:function(){var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m;if(Selector._cache[e]){this.matcher=Selector._cache[e];return;}
this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in ps){p=ps[i];if(m=e.match(p)){this.matcher.push(Object.isFunction(c[i])?c[i](m):new Template(c[i]).evaluate(m));e=e.replace(m[0],'');break;}}}
this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join('\n'));Selector._cache[this.expression]=this.matcher;},compileXPathMatcher:function(){var e=this.expression,ps=Selector.patterns,x=Selector.xpath,le,m;if(Selector._cache[e]){this.xpath=Selector._cache[e];return;}
this.matcher=['.//*'];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in ps){if(m=e.match(ps[i])){this.matcher.push(Object.isFunction(x[i])?x[i](m):new Template(x[i]).evaluate(m));e=e.replace(m[0],'');break;}}}
this.xpath=this.matcher.join('');Selector._cache[this.expression]=this.xpath;},findElements:function(root){root=root||document;var e=this.expression,results;switch(this.mode){case'selectorsAPI':if(root!==document){var oldId=root.id,id=$(root).identify();e="#"+id+" "+e;}
results=$A(root.querySelectorAll(e)).map(Element.extend);root.id=oldId;return results;case'xpath':return document._getElementsByXPath(this.xpath,root);default:return this.matcher(root);}},match:function(element){this.tokens=[];var e=this.expression,ps=Selector.patterns,as=Selector.assertions;var le,p,m;while(e&&le!==e&&(/\S/).test(e)){le=e;for(var i in ps){p=ps[i];if(m=e.match(p)){if(as[i]){this.tokens.push([i,Object.clone(m)]);e=e.replace(m[0],'');}else{return this.findElements(document).include(element);}}}}
var match=true,name,matches;for(var i=0,token;token=this.tokens[i];i++){name=token[0],matches=token[1];if(!Selector.assertions[name](element,matches)){match=false;break;}}
return match;},toString:function(){return this.expression;},inspect:function(){return"#<Selector:"+this.expression.inspect()+">";}});Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:'/following-sibling::*',tagName:function(m){if(m[1]=='*')return'';return"[local-name()='"+m[1].toLowerCase()+"' or local-name()='"+m[1].toUpperCase()+"']";},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:function(m){m[1]=m[1].toLowerCase();return new Template("[@#{1}]").evaluate(m);},attr:function(m){m[1]=m[1].toLowerCase();m[3]=m[5]||m[6];return new Template(Selector.xpath.operators[m[2]]).evaluate(m);},pseudo:function(m){var h=Selector.xpath.pseudos[m[1]];if(!h)return'';if(Object.isFunction(h))return h(m);return new Template(Selector.xpath.pseudos[m[1]]).evaluate(m);},operators:{'=':"[@#{1}='#{3}']",'!=':"[@#{1}!='#{3}']",'^=':"[starts-with(@#{1}, '#{3}')]",'$=':"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']",'*=':"[contains(@#{1}, '#{3}')]",'~=':"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]",'|=':"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{'first-child':'[not(preceding-sibling::*)]','last-child':'[not(following-sibling::*)]','only-child':'[not(preceding-sibling::* or following-sibling::*)]','empty':"[count(*) = 0 and (count(text()) = 0)]",'checked':"[@checked]",'disabled':"[(@disabled) and (@type!='hidden')]",'enabled':"[not(@disabled) and (@type!='hidden')]",'not':function(m){var e=m[6],p=Selector.patterns,x=Selector.xpath,le,v;var exclusion=[];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i in p){if(m=e.match(p[i])){v=Object.isFunction(x[i])?x[i](m):new Template(x[i]).evaluate(m);exclusion.push("("+v.substring(1,v.length-1)+")");e=e.replace(m[0],'');break;}}}
return"[not("+exclusion.join(" and ")+")]";},'nth-child':function(m){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",m);},'nth-last-child':function(m){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",m);},'nth-of-type':function(m){return Selector.xpath.pseudos.nth("position() ",m);},'nth-last-of-type':function(m){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",m);},'first-of-type':function(m){m[6]="1";return Selector.xpath.pseudos['nth-of-type'](m);},'last-of-type':function(m){m[6]="1";return Selector.xpath.pseudos['nth-last-of-type'](m);},'only-of-type':function(m){var p=Selector.xpath.pseudos;return p['first-of-type'](m)+p['last-of-type'](m);},nth:function(fragment,m){var mm,formula=m[6],predicate;if(formula=='even')formula='2n+0';if(formula=='odd')formula='2n+1';if(mm=formula.match(/^(\d+)$/))
return'['+fragment+"= "+mm[1]+']';if(mm=formula.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(mm[1]=="-")mm[1]=-1;var a=mm[1]?Number(mm[1]):1;var b=mm[2]?Number(mm[2]):0;predicate="[((#{fragment} - #{b}) mod #{a} = 0) and "+"((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(predicate).evaluate({fragment:fragment,a:a,b:b});}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);      c = false;',className:'n = h.className(n, r, "#{1}", c);    c = false;',id:'n = h.id(n, r, "#{1}", c);           c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}", c); c = false;',attr:function(m){m[3]=(m[5]||m[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;').evaluate(m);},pseudo:function(m){if(m[6])m[6]=m[6].replace(/"/g,'\\"');return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(m);},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:{laterSibling:/^\s*~\s*/,child:/^\s*>\s*/,adjacent:/^\s*\+\s*/,descendant:/^\s/,tagName:/^\s*(\*|[\w\-]+)(\b|$)?/,id:/^#([\w\-\*]+)(\b|$)/,className:/^\.([\w\-\*]+)(\b|$)/,pseudo:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/,attrPresence:/^\[((?:[\w]+:)?[\w]+)\]/,attr:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/},assertions:{tagName:function(element,matches){return matches[1].toUpperCase()==element.tagName.toUpperCase();},className:function(element,matches){return Element.hasClassName(element,matches[1]);},id:function(element,matches){return element.id===matches[1];},attrPresence:function(element,matches){return Element.hasAttribute(element,matches[1]);},attr:function(element,matches){var nodeValue=Element.readAttribute(element,matches[1]);return nodeValue&&Selector.operators[matches[2]](nodeValue,matches[5]||matches[6]);}},handlers:{concat:function(a,b){for(var i=0,node;node=b[i];i++)
a.push(node);return a;},mark:function(nodes){var _true=Prototype.emptyFunction;for(var i=0,node;node=nodes[i];i++)
node._countedByPrototype=_true;return nodes;},unmark:function(nodes){for(var i=0,node;node=nodes[i];i++)
node._countedByPrototype=undefined;return nodes;},index:function(parentNode,reverse,ofType){parentNode._countedByPrototype=Prototype.emptyFunction;if(reverse){for(var nodes=parentNode.childNodes,i=nodes.length-1,j=1;i>=0;i--){var node=nodes[i];if(node.nodeType==1&&(!ofType||node._countedByPrototype))node.nodeIndex=j++;}}else{for(var i=0,j=1,nodes=parentNode.childNodes;node=nodes[i];i++)
if(node.nodeType==1&&(!ofType||node._countedByPrototype))node.nodeIndex=j++;}},unique:function(nodes){if(nodes.length==0)return nodes;var results=[],n;for(var i=0,l=nodes.length;i<l;i++)
if(!(n=nodes[i])._countedByPrototype){n._countedByPrototype=Prototype.emptyFunction;results.push(Element.extend(n));}
return Selector.handlers.unmark(results);},descendant:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)
h.concat(results,node.getElementsByTagName('*'));return results;},child:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++){for(var j=0,child;child=node.childNodes[j];j++)
if(child.nodeType==1&&child.tagName!='!')results.push(child);}
return results;},adjacent:function(nodes){for(var i=0,results=[],node;node=nodes[i];i++){var next=this.nextElementSibling(node);if(next)results.push(next);}
return results;},laterSibling:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)
h.concat(results,Element.nextSiblings(node));return results;},nextElementSibling:function(node){while(node=node.nextSibling)
if(node.nodeType==1)return node;return null;},previousElementSibling:function(node){while(node=node.previousSibling)
if(node.nodeType==1)return node;return null;},tagName:function(nodes,root,tagName,combinator){var uTagName=tagName.toUpperCase();var results=[],h=Selector.handlers;if(nodes){if(combinator){if(combinator=="descendant"){for(var i=0,node;node=nodes[i];i++)
h.concat(results,node.getElementsByTagName(tagName));return results;}else nodes=this[combinator](nodes);if(tagName=="*")return nodes;}
for(var i=0,node;node=nodes[i];i++)
if(node.tagName.toUpperCase()===uTagName)results.push(node);return results;}else return root.getElementsByTagName(tagName);},id:function(nodes,root,id,combinator){var targetNode=$(id),h=Selector.handlers;if(!targetNode)return[];if(!nodes&&root==document)return[targetNode];if(nodes){if(combinator){if(combinator=='child'){for(var i=0,node;node=nodes[i];i++)
if(targetNode.parentNode==node)return[targetNode];}else if(combinator=='descendant'){for(var i=0,node;node=nodes[i];i++)
if(Element.descendantOf(targetNode,node))return[targetNode];}else if(combinator=='adjacent'){for(var i=0,node;node=nodes[i];i++)
if(Selector.handlers.previousElementSibling(targetNode)==node)
return[targetNode];}else nodes=h[combinator](nodes);}
for(var i=0,node;node=nodes[i];i++)
if(node==targetNode)return[targetNode];return[];}
return(targetNode&&Element.descendantOf(targetNode,root))?[targetNode]:[];},className:function(nodes,root,className,combinator){if(nodes&&combinator)nodes=this[combinator](nodes);return Selector.handlers.byClassName(nodes,root,className);},byClassName:function(nodes,root,className){if(!nodes)nodes=Selector.handlers.descendant([root]);var needle=' '+className+' ';for(var i=0,results=[],node,nodeClassName;node=nodes[i];i++){nodeClassName=node.className;if(nodeClassName.length==0)continue;if(nodeClassName==className||(' '+nodeClassName+' ').include(needle))
results.push(node);}
return results;},attrPresence:function(nodes,root,attr,combinator){if(!nodes)nodes=root.getElementsByTagName("*");if(nodes&&combinator)nodes=this[combinator](nodes);var results=[];for(var i=0,node;node=nodes[i];i++)
if(Element.hasAttribute(node,attr))results.push(node);return results;},attr:function(nodes,root,attr,value,operator,combinator){if(!nodes)nodes=root.getElementsByTagName("*");if(nodes&&combinator)nodes=this[combinator](nodes);var handler=Selector.operators[operator],results=[];for(var i=0,node;node=nodes[i];i++){var nodeValue=Element.readAttribute(node,attr);if(nodeValue===null)continue;if(handler(nodeValue,value))results.push(node);}
return results;},pseudo:function(nodes,name,value,root,combinator){if(nodes&&combinator)nodes=this[combinator](nodes);if(!nodes)nodes=root.getElementsByTagName("*");return Selector.pseudos[name](nodes,value,root);}},pseudos:{'first-child':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(Selector.handlers.previousElementSibling(node))continue;results.push(node);}
return results;},'last-child':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(Selector.handlers.nextElementSibling(node))continue;results.push(node);}
return results;},'only-child':function(nodes,value,root){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)
if(!h.previousElementSibling(node)&&!h.nextElementSibling(node))
results.push(node);return results;},'nth-child':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root);},'nth-last-child':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,true);},'nth-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,false,true);},'nth-last-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,true,true);},'first-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,"1",root,false,true);},'last-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,"1",root,true,true);},'only-of-type':function(nodes,formula,root){var p=Selector.pseudos;return p['last-of-type'](p['first-of-type'](nodes,formula,root),formula,root);},getIndices:function(a,b,total){if(a==0)return b>0?[b]:[];return $R(1,total).inject([],function(memo,i){if(0==(i-b)%a&&(i-b)/a>=0)memo.push(i);return memo;});},nth:function(nodes,formula,root,reverse,ofType){if(nodes.length==0)return[];if(formula=='even')formula='2n+0';if(formula=='odd')formula='2n+1';var h=Selector.handlers,results=[],indexed=[],m;h.mark(nodes);for(var i=0,node;node=nodes[i];i++){if(!node.parentNode._countedByPrototype){h.index(node.parentNode,reverse,ofType);indexed.push(node.parentNode);}}
if(formula.match(/^\d+$/)){formula=Number(formula);for(var i=0,node;node=nodes[i];i++)
if(node.nodeIndex==formula)results.push(node);}else if(m=formula.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(m[1]=="-")m[1]=-1;var a=m[1]?Number(m[1]):1;var b=m[2]?Number(m[2]):0;var indices=Selector.pseudos.getIndices(a,b,nodes.length);for(var i=0,node,l=indices.length;node=nodes[i];i++){for(var j=0;j<l;j++)
if(node.nodeIndex==indices[j])results.push(node);}}
h.unmark(nodes);h.unmark(indexed);return results;},'empty':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(node.tagName=='!'||node.firstChild)continue;results.push(node);}
return results;},'not':function(nodes,selector,root){var h=Selector.handlers,selectorType,m;var exclusions=new Selector(selector).findElements(root);h.mark(exclusions);for(var i=0,results=[],node;node=nodes[i];i++)
if(!node._countedByPrototype)results.push(node);h.unmark(exclusions);return results;},'enabled':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)
if(!node.disabled&&(!node.type||node.type!=='hidden'))
results.push(node);return results;},'disabled':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)
if(node.disabled)results.push(node);return results;},'checked':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)
if(node.checked)results.push(node);return results;}},operators:{'=':function(nv,v){return nv==v;},'!=':function(nv,v){return nv!=v;},'^=':function(nv,v){return nv==v||nv&&nv.startsWith(v);},'$=':function(nv,v){return nv==v||nv&&nv.endsWith(v);},'*=':function(nv,v){return nv==v||nv&&nv.include(v);},'$=':function(nv,v){return nv.endsWith(v);},'*=':function(nv,v){return nv.include(v);},'~=':function(nv,v){return(' '+nv+' ').include(' '+v+' ');},'|=':function(nv,v){return('-'+(nv||"").toUpperCase()+'-').include('-'+(v||"").toUpperCase()+'-');}},split:function(expression){var expressions=[];expression.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(m){expressions.push(m[1].strip());});return expressions;},matchElements:function(elements,expression){var matches=$$(expression),h=Selector.handlers;h.mark(matches);for(var i=0,results=[],element;element=elements[i];i++)
if(element._countedByPrototype)results.push(element);h.unmark(matches);return results;},findElement:function(elements,expression,index){if(Object.isNumber(expression)){index=expression;expression=false;}
return Selector.matchElements(elements,expression||'*')[index||0];},findChildElements:function(element,expressions){expressions=Selector.split(expressions.join(','));var results=[],h=Selector.handlers;for(var i=0,l=expressions.length,selector;i<l;i++){selector=new Selector(expressions[i].strip());h.concat(results,selector.findElements(element));}
return(l>1)?h.unique(results):results;}});if(Prototype.Browser.IE){Object.extend(Selector.handlers,{concat:function(a,b){for(var i=0,node;node=b[i];i++)
if(node.tagName!=="!")a.push(node);return a;},unmark:function(nodes){for(var i=0,node;node=nodes[i];i++)
node.removeAttribute('_countedByPrototype');return nodes;}});}
function $$(){return Selector.findChildElements(document,$A(arguments));}
var Form={reset:function(form){$(form).reset();return form;},serializeElements:function(elements,options){if(typeof options!='object')options={hash:!!options};else if(Object.isUndefined(options.hash))options.hash=true;var key,value,submitted=false,submit=options.submit;var data=elements.inject({},function(result,element){if(!element.disabled&&element.name){key=element.name;value=$(element).getValue();if(value!=null&&element.type!='file'&&(element.type!='submit'||(!submitted&&submit!==false&&(!submit||key==submit)&&(submitted=true)))){if(key in result){if(!Object.isArray(result[key]))result[key]=[result[key]];result[key].push(value);}
else result[key]=value;}}
return result;});return options.hash?data:Object.toQueryString(data);}};Form.Methods={serialize:function(form,options){return Form.serializeElements(Form.getElements(form),options);},getElements:function(form){return $A($(form).getElementsByTagName('*')).inject([],function(elements,child){if(Form.Element.Serializers[child.tagName.toLowerCase()])
elements.push(Element.extend(child));return elements;});},getInputs:function(form,typeName,name){form=$(form);var inputs=form.getElementsByTagName('input');if(!typeName&&!name)return $A(inputs).map(Element.extend);for(var i=0,matchingInputs=[],length=inputs.length;i<length;i++){var input=inputs[i];if((typeName&&input.type!=typeName)||(name&&input.name!=name))
continue;matchingInputs.push(Element.extend(input));}
return matchingInputs;},disable:function(form){form=$(form);Form.getElements(form).invoke('disable');return form;},enable:function(form){form=$(form);Form.getElements(form).invoke('enable');return form;},findFirstElement:function(form){var elements=$(form).getElements().findAll(function(element){return'hidden'!=element.type&&!element.disabled;});var firstByIndex=elements.findAll(function(element){return element.hasAttribute('tabIndex')&&element.tabIndex>=0;}).sortBy(function(element){return element.tabIndex}).first();return firstByIndex?firstByIndex:elements.find(function(element){return['input','select','textarea'].include(element.tagName.toLowerCase());});},focusFirstElement:function(form){form=$(form);form.findFirstElement().activate();return form;},request:function(form,options){form=$(form),options=Object.clone(options||{});var params=options.parameters,action=form.readAttribute('action')||'';if(action.blank())action=window.location.href;options.parameters=form.serialize(true);if(params){if(Object.isString(params))params=params.toQueryParams();Object.extend(options.parameters,params);}
if(form.hasAttribute('method')&&!options.method)
options.method=form.method;return new Ajax.Request(action,options);}};Form.Element={focus:function(element){$(element).focus();return element;},select:function(element){$(element).select();return element;}};Form.Element.Methods={serialize:function(element){element=$(element);if(!element.disabled&&element.name){var value=element.getValue();if(value!=undefined){var pair={};pair[element.name]=value;return Object.toQueryString(pair);}}
return'';},getValue:function(element){element=$(element);var method=element.tagName.toLowerCase();return Form.Element.Serializers[method](element);},setValue:function(element,value){element=$(element);var method=element.tagName.toLowerCase();Form.Element.Serializers[method](element,value);return element;},clear:function(element){$(element).value='';return element;},present:function(element){return $(element).value!='';},activate:function(element){element=$(element);try{element.focus();if(element.select&&(element.tagName.toLowerCase()!='input'||!['button','reset','submit'].include(element.type)))
element.select();}catch(e){}
return element;},disable:function(element){element=$(element);element.disabled=true;return element;},enable:function(element){element=$(element);element.disabled=false;return element;}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(element,value){switch(element.type.toLowerCase()){case'checkbox':case'radio':return Form.Element.Serializers.inputSelector(element,value);default:return Form.Element.Serializers.textarea(element,value);}},inputSelector:function(element,value){if(Object.isUndefined(value))return element.checked?element.value:null;else element.checked=!!value;},textarea:function(element,value){if(Object.isUndefined(value))return element.value;else element.value=value;},select:function(element,value){if(Object.isUndefined(value))
return this[element.type=='select-one'?'selectOne':'selectMany'](element);else{var opt,currentValue,single=!Object.isArray(value);for(var i=0,length=element.length;i<length;i++){opt=element.options[i];currentValue=this.optionValue(opt);if(single){if(currentValue==value){opt.selected=true;return;}}
else opt.selected=value.include(currentValue);}}},selectOne:function(element){var index=element.selectedIndex;return index>=0?this.optionValue(element.options[index]):null;},selectMany:function(element){var values,length=element.length;if(!length)return null;for(var i=0,values=[];i<length;i++){var opt=element.options[i];if(opt.selected)values.push(this.optionValue(opt));}
return values;},optionValue:function(opt){return Element.extend(opt).hasAttribute('value')?opt.value:opt.text;}};Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,element,frequency,callback){$super(callback,frequency);this.element=$(element);this.lastValue=this.getValue();},execute:function(){var value=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(value)?this.lastValue!=value:String(this.lastValue)!=String(value)){this.callback(this.element,value);this.lastValue=value;}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element);}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element);}});Abstract.EventObserver=Class.create({initialize:function(element,callback){this.element=$(element);this.callback=callback;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=='form')
this.registerFormCallbacks();else
this.registerCallback(this.element);},onElementEvent:function(){var value=this.getValue();if(this.lastValue!=value){this.callback(this.element,value);this.lastValue=value;}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this);},registerCallback:function(element){if(element.type){switch(element.type.toLowerCase()){case'checkbox':case'radio':Event.observe(element,'click',this.onElementEvent.bind(this));break;default:Event.observe(element,'change',this.onElementEvent.bind(this));break;}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element);}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element);}});if(!window.Event)var Event={};Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{},relatedTarget:function(event){var element;switch(event.type){case'mouseover':element=event.fromElement;break;case'mouseout':element=event.toElement;break;default:return null;}
return Element.extend(element);}});Event.Methods=(function(){var isButton;if(Prototype.Browser.IE){var buttonMap={0:1,1:4,2:2};isButton=function(event,code){return event.button==buttonMap[code];};}else if(Prototype.Browser.WebKit){isButton=function(event,code){switch(code){case 0:return event.which==1&&!event.metaKey;case 1:return event.which==1&&event.metaKey;default:return false;}};}else{isButton=function(event,code){return event.which?(event.which===code+1):(event.button===code);};}
return{isLeftClick:function(event){return isButton(event,0)},isMiddleClick:function(event){return isButton(event,1)},isRightClick:function(event){return isButton(event,2)},element:function(event){event=Event.extend(event);var node=event.target,type=event.type,currentTarget=event.currentTarget;if(currentTarget&&currentTarget.tagName){if(type==='load'||type==='error'||(type==='click'&&currentTarget.tagName.toLowerCase()==='input'&&currentTarget.type==='radio'))
node=currentTarget;}
if(node.nodeType==Node.TEXT_NODE)node=node.parentNode;return Element.extend(node);},findElement:function(event,expression){var element=Event.element(event);if(!expression)return element;var elements=[element].concat(element.ancestors());return Selector.findElement(elements,expression,0);},pointer:function(event){var docElement=document.documentElement,body=document.body||{scrollLeft:0,scrollTop:0};return{x:event.pageX||(event.clientX+
(docElement.scrollLeft||body.scrollLeft)-
(docElement.clientLeft||0)),y:event.pageY||(event.clientY+
(docElement.scrollTop||body.scrollTop)-
(docElement.clientTop||0))};},pointerX:function(event){return Event.pointer(event).x},pointerY:function(event){return Event.pointer(event).y},stop:function(event){Event.extend(event);event.preventDefault();event.stopPropagation();event.stopped=true;}};})();Event.extend=(function(){var methods=Object.keys(Event.Methods).inject({},function(m,name){m[name]=Event.Methods[name].methodize();return m;});if(Prototype.Browser.IE){Object.extend(methods,{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}});return function(event){if(!event)return false;if(event._extendedByPrototype)return event;event._extendedByPrototype=Prototype.emptyFunction;var pointer=Event.pointer(event);Object.extend(event,{target:event.srcElement,relatedTarget:Event.relatedTarget(event),pageX:pointer.x,pageY:pointer.y});return Object.extend(event,methods);};}else{Event.prototype=Event.prototype||document.createEvent("HTMLEvents")['__proto__'];Object.extend(Event.prototype,methods);return Prototype.K;}})();Object.extend(Event,(function(){var cache=Event.cache;function getEventID(element){if(element._prototypeEventID)return element._prototypeEventID[0];arguments.callee.id=arguments.callee.id||1;return element._prototypeEventID=[++arguments.callee.id];}
function getDOMEventName(eventName){if(eventName&&eventName.include(':'))return"dataavailable";return eventName;}
function getCacheForID(id){return cache[id]=cache[id]||{};}
function getWrappersForEventName(id,eventName){var c=getCacheForID(id);return c[eventName]=c[eventName]||[];}
function createWrapper(element,eventName,handler){var id=getEventID(element);var c=getWrappersForEventName(id,eventName);if(c.pluck("handler").include(handler))return false;var wrapper=function(event){if(!Event||!Event.extend||(event.eventName&&event.eventName!=eventName))
return false;Event.extend(event);handler.call(element,event);};wrapper.handler=handler;c.push(wrapper);return wrapper;}
function findWrapper(id,eventName,handler){var c=getWrappersForEventName(id,eventName);return c.find(function(wrapper){return wrapper.handler==handler});}
function destroyWrapper(id,eventName,handler){var c=getCacheForID(id);if(!c[eventName])return false;c[eventName]=c[eventName].without(findWrapper(id,eventName,handler));}
function destroyCache(){for(var id in cache)
for(var eventName in cache[id])
cache[id][eventName]=null;}
if(window.attachEvent){window.attachEvent("onunload",destroyCache);}
if(Prototype.Browser.WebKit){window.addEventListener('unload',Prototype.emptyFunction,false);}
return{observe:function(element,eventName,handler){element=$(element);var name=getDOMEventName(eventName);var wrapper=createWrapper(element,eventName,handler);if(!wrapper)return element;if(element.addEventListener){element.addEventListener(name,wrapper,false);}else{element.attachEvent("on"+name,wrapper);}
return element;},stopObserving:function(element,eventName,handler){element=$(element);var id=getEventID(element),name=getDOMEventName(eventName);if(!handler&&eventName){getWrappersForEventName(id,eventName).each(function(wrapper){element.stopObserving(eventName,wrapper.handler);});return element;}else if(!eventName){Object.keys(getCacheForID(id)).each(function(eventName){element.stopObserving(eventName);});return element;}
var wrapper=findWrapper(id,eventName,handler);if(!wrapper)return element;if(element.removeEventListener){element.removeEventListener(name,wrapper,false);}else{element.detachEvent("on"+name,wrapper);}
destroyWrapper(id,eventName,handler);return element;},fire:function(element,eventName,memo){element=$(element);if(element==document&&document.createEvent&&!element.dispatchEvent)
element=document.documentElement;var event;if(document.createEvent){event=document.createEvent("HTMLEvents");event.initEvent("dataavailable",true,true);}else{event=document.createEventObject();event.eventType="ondataavailable";}
event.eventName=eventName;event.memo=memo||{};if(document.createEvent){element.dispatchEvent(event);}else{element.fireEvent(event.eventType,event);}
return Event.extend(event);}};})());Object.extend(Event,Event.Methods);Element.addMethods({fire:Event.fire,observe:Event.observe,stopObserving:Event.stopObserving});Object.extend(document,{fire:Element.Methods.fire.methodize(),observe:Element.Methods.observe.methodize(),stopObserving:Element.Methods.stopObserving.methodize(),loaded:false});(function(){var timer;function fireContentLoadedEvent(){if(document.loaded)return;if(timer)window.clearInterval(timer);document.fire("dom:loaded");document.loaded=true;}
if(document.addEventListener){if(Prototype.Browser.WebKit){timer=window.setInterval(function(){if(/loaded|complete/.test(document.readyState))
fireContentLoadedEvent();},0);Event.observe(window,"load",fireContentLoadedEvent);}else{document.addEventListener("DOMContentLoaded",fireContentLoadedEvent,false);}}else{document.write("<script id=__onDOMContentLoaded defer src=//:><\/script>");$("__onDOMContentLoaded").onreadystatechange=function(){if(this.readyState=="complete"){this.onreadystatechange=null;fireContentLoadedEvent();}};}})();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(element,content){return Element.insert(element,{before:content});},Top:function(element,content){return Element.insert(element,{top:content});},Bottom:function(element,content){return Element.insert(element,{bottom:content});},After:function(element,content){return Element.insert(element,{after:content});}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;},within:function(element,x,y){if(this.includeScrollOffsets)
return this.withinIncludingScrolloffsets(element,x,y);this.xcomp=x;this.ycomp=y;this.offset=Element.cumulativeOffset(element);return(y>=this.offset[1]&&y<this.offset[1]+element.offsetHeight&&x>=this.offset[0]&&x<this.offset[0]+element.offsetWidth);},withinIncludingScrolloffsets:function(element,x,y){var offsetcache=Element.cumulativeScrollOffset(element);this.xcomp=x+offsetcache[0]-this.deltaX;this.ycomp=y+offsetcache[1]-this.deltaY;this.offset=Element.cumulativeOffset(element);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+element.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+element.offsetWidth);},overlap:function(mode,element){if(!mode)return 0;if(mode=='vertical')
return((this.offset[1]+element.offsetHeight)-this.ycomp)/element.offsetHeight;if(mode=='horizontal')
return((this.offset[0]+element.offsetWidth)-this.xcomp)/element.offsetWidth;},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(element){Position.prepare();return Element.absolutize(element);},relativize:function(element){Position.prepare();return Element.relativize(element);},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(source,target,options){options=options||{};return Element.clonePosition(target,source,options);}};if(!document.getElementsByClassName)document.getElementsByClassName=function(instanceMethods){function iter(name){return name.blank()?null:"[contains(concat(' ', @class, ' '), ' "+name+" ')]";}
instanceMethods.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(element,className){className=className.toString().strip();var cond=/\s/.test(className)?$w(className).map(iter).join(''):iter(className);return cond?document._getElementsByXPath('.//*'+cond,element):[];}:function(element,className){className=className.toString().strip();var elements=[],classNames=(/\s/.test(className)?$w(className):null);if(!classNames&&!className)return elements;var nodes=$(element).getElementsByTagName('*');className=' '+className+' ';for(var i=0,child,cn;child=nodes[i];i++){if(child.className&&(cn=' '+child.className+' ')&&(cn.include(className)||(classNames&&classNames.all(function(name){return!name.toString().blank()&&cn.include(' '+name+' ');}))))
elements.push(Element.extend(child));}
return elements;};return function(className,parentElement){return $(parentElement||document.body).getElementsByClassName(className);};}(Element.Methods);Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(element){this.element=$(element);},_each:function(iterator){this.element.className.split(/\s+/).select(function(name){return name.length>0;})._each(iterator);},set:function(className){this.element.className=className;},add:function(classNameToAdd){if(this.include(classNameToAdd))return;this.set($A(this).concat(classNameToAdd).join(' '));},remove:function(classNameToRemove){if(!this.include(classNameToRemove))return;this.set($A(this).without(classNameToRemove).join(' '));},toString:function(){return $A(this).join(' ');}};Object.extend(Element.ClassNames.prototype,Enumerable);Element.addMethods();String.prototype.parseColor=function(){var color='#';if(this.slice(0,4)=='rgb('){var cols=this.slice(4,this.length-1).split(',');var i=0;do{color+=parseInt(cols[i]).toColorPart()}while(++i<3);}else{if(this.slice(0,1)=='#'){if(this.length==4)for(var i=1;i<4;i++)color+=(this.charAt(i)+this.charAt(i)).toLowerCase();if(this.length==7)color=this.toLowerCase();}}
return(color.length==7?color:(arguments[0]||this));};Element.collectTextNodes=function(element){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:(node.hasChildNodes()?Element.collectTextNodes(node):''));}).flatten().join('');};Element.collectTextNodesIgnoreClass=function(element,className){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:((node.hasChildNodes()&&!Element.hasClassName(node,className))?Element.collectTextNodesIgnoreClass(node,className):''));}).flatten().join('');};Element.setContentZoom=function(element,percent){element=$(element);element.setStyle({fontSize:(percent/100)+'em'});if(Prototype.Browser.WebKit)window.scrollBy(0,0);return element;};Element.getInlineOpacity=function(element){return $(element).style.opacity||'';};Element.forceRerendering=function(element){try{element=$(element);var n=document.createTextNode(' ');element.appendChild(n);element.removeChild(n);}catch(e){}};var Effect={_elementDoesNotExistError:{name:'ElementDoesNotExistError',message:'The specified DOM element does not exist, but is required for this effect to operate'},Transitions:{linear:Prototype.K,sinoidal:function(pos){return(-Math.cos(pos*Math.PI)/2)+.5;},reverse:function(pos){return 1-pos;},flicker:function(pos){var pos=((-Math.cos(pos*Math.PI)/4)+.75)+Math.random()/4;return pos>1?1:pos;},wobble:function(pos){return(-Math.cos(pos*Math.PI*(9*pos))/2)+.5;},pulse:function(pos,pulses){return(-Math.cos((pos*((pulses||5)-.5)*2)*Math.PI)/2)+.5;},spring:function(pos){return 1-(Math.cos(pos*4.5*Math.PI)*Math.exp(-pos*6));},none:function(pos){return 0;},full:function(pos){return 1;}},DefaultOptions:{duration:1.0,fps:100,sync:false,from:0.0,to:1.0,delay:0.0,queue:'parallel'},tagifyText:function(element){var tagifyStyle='position:relative';if(Prototype.Browser.IE)tagifyStyle+=';zoom:1';element=$(element);$A(element.childNodes).each(function(child){if(child.nodeType==3){child.nodeValue.toArray().each(function(character){element.insertBefore(new Element('span',{style:tagifyStyle}).update(character==' '?String.fromCharCode(160):character),child);});Element.remove(child);}});},multiple:function(element,effect){var elements;if(((typeof element=='object')||Object.isFunction(element))&&(element.length))
elements=element;else
elements=$(element).childNodes;var options=Object.extend({speed:0.1,delay:0.0},arguments[2]||{});var masterDelay=options.delay;$A(elements).each(function(element,index){new effect(element,Object.extend(options,{delay:index*options.speed+masterDelay}));});},PAIRS:{'slide':['SlideDown','SlideUp'],'blind':['BlindDown','BlindUp'],'appear':['Appear','Fade']},toggle:function(element,effect){element=$(element);effect=(effect||'appear').toLowerCase();var options=Object.extend({queue:{position:'end',scope:(element.id||'global'),limit:1}},arguments[2]||{});Effect[element.visible()?Effect.PAIRS[effect][1]:Effect.PAIRS[effect][0]](element,options);}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null;},_each:function(iterator){this.effects._each(iterator);},add:function(effect){var timestamp=new Date().getTime();var position=Object.isString(effect.options.queue)?effect.options.queue:effect.options.queue.position;switch(position){case'front':this.effects.findAll(function(e){return e.state=='idle'}).each(function(e){e.startOn+=effect.finishOn;e.finishOn+=effect.finishOn;});break;case'with-last':timestamp=this.effects.pluck('startOn').max()||timestamp;break;case'end':timestamp=this.effects.pluck('finishOn').max()||timestamp;break;}
effect.startOn+=timestamp;effect.finishOn+=timestamp;if(!effect.options.queue.limit||(this.effects.length<effect.options.queue.limit))
this.effects.push(effect);if(!this.interval)
this.interval=setInterval(this.loop.bind(this),15);},remove:function(effect){this.effects=this.effects.reject(function(e){return e==effect});if(this.effects.length==0){clearInterval(this.interval);this.interval=null;}},loop:function(){var timePos=new Date().getTime();for(var i=0,len=this.effects.length;i<len;i++)
this.effects[i]&&this.effects[i].loop(timePos);}});Effect.Queues={instances:$H(),get:function(queueName){if(!Object.isString(queueName))return queueName;return this.instances.get(queueName)||this.instances.set(queueName,new Effect.ScopedQueue());}};Effect.Queue=Effect.Queues.get('global');Effect.Base=Class.create({position:null,start:function(options){function codeForEvent(options,eventName){return((options[eventName+'Internal']?'this.options.'+eventName+'Internal(this);':'')+
(options[eventName]?'this.options.'+eventName+'(this);':''));}
if(options&&options.transition===false)options.transition=Effect.Transitions.linear;this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{});this.currentFrame=0;this.state='idle';this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=(function(){function dispatch(effect,eventName){if(effect.options[eventName+'Internal'])
effect.options[eventName+'Internal'](effect);if(effect.options[eventName])
effect.options[eventName](effect);}
return function(pos){if(this.state==="idle"){this.state="running";dispatch(this,'beforeSetup');if(this.setup)this.setup();dispatch(this,'afterSetup');}
if(this.state==="running"){pos=(this.options.transition(pos)*this.fromToDelta)+this.options.from;this.position=pos;dispatch(this,'beforeUpdate');if(this.update)this.update(pos);dispatch(this,'afterUpdate');}};})();this.event('beforeStart');if(!this.options.sync)
Effect.Queues.get(Object.isString(this.options.queue)?'global':this.options.queue.scope).add(this);},loop:function(timePos){if(timePos>=this.startOn){if(timePos>=this.finishOn){this.render(1.0);this.cancel();this.event('beforeFinish');if(this.finish)this.finish();this.event('afterFinish');return;}
var pos=(timePos-this.startOn)/this.totalTime,frame=(pos*this.totalFrames).round();if(frame>this.currentFrame){this.render(pos);this.currentFrame=frame;}}},cancel:function(){if(!this.options.sync)
Effect.Queues.get(Object.isString(this.options.queue)?'global':this.options.queue.scope).remove(this);this.state='finished';},event:function(eventName){if(this.options[eventName+'Internal'])this.options[eventName+'Internal'](this);if(this.options[eventName])this.options[eventName](this);},inspect:function(){var data=$H();for(property in this)
if(!Object.isFunction(this[property]))data.set(property,this[property]);return'#<Effect:'+data.inspect()+',options:'+$H(this.options).inspect()+'>';}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(effects){this.effects=effects||[];this.start(arguments[1]);},update:function(position){this.effects.invoke('render',position);},finish:function(position){this.effects.each(function(effect){effect.render(1.0);effect.cancel();effect.event('beforeFinish');if(effect.finish)effect.finish(position);effect.event('afterFinish');});}});Effect.Tween=Class.create(Effect.Base,{initialize:function(object,from,to){object=Object.isString(object)?$(object):object;var args=$A(arguments),method=args.last(),options=args.length==5?args[3]:null;this.method=Object.isFunction(method)?method.bind(object):Object.isFunction(object[method])?object[method].bind(object):function(value){object[method]=value};this.start(Object.extend({from:from,to:to},options||{}));},update:function(position){this.method(position);}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}));},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout))
this.element.setStyle({zoom:1});var options=Object.extend({from:this.element.getOpacity()||0.0,to:1.0},arguments[1]||{});this.start(options);},update:function(position){this.element.setOpacity(position);}});Effect.Move=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({x:0,y:0,mode:'relative'},arguments[1]||{});this.start(options);},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle('left')||'0');this.originalTop=parseFloat(this.element.getStyle('top')||'0');if(this.options.mode=='absolute'){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop;}},update:function(position){this.element.setStyle({left:(this.options.x*position+this.originalLeft).round()+'px',top:(this.options.y*position+this.originalTop).round()+'px'});}});Effect.MoveBy=function(element,toTop,toLeft){return new Effect.Move(element,Object.extend({x:toLeft,y:toTop},arguments[3]||{}));};Effect.Scale=Class.create(Effect.Base,{initialize:function(element,percent){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:'box',scaleFrom:100.0,scaleTo:percent},arguments[2]||{});this.start(options);},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle('position');this.originalStyle={};['top','left','width','height','fontSize'].each(function(k){this.originalStyle[k]=this.element.style[k];}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var fontSize=this.element.getStyle('font-size')||'100%';['em','px','%','pt'].each(function(fontSizeType){if(fontSize.indexOf(fontSizeType)>0){this.fontSize=parseFloat(fontSize);this.fontSizeType=fontSizeType;}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=='box')
this.dims=[this.element.offsetHeight,this.element.offsetWidth];if(/^content/.test(this.options.scaleMode))
this.dims=[this.element.scrollHeight,this.element.scrollWidth];if(!this.dims)
this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth];},update:function(position){var currentScale=(this.options.scaleFrom/100.0)+(this.factor*position);if(this.options.scaleContent&&this.fontSize)
this.element.setStyle({fontSize:this.fontSize*currentScale+this.fontSizeType});this.setDimensions(this.dims[0]*currentScale,this.dims[1]*currentScale);},finish:function(position){if(this.restoreAfterFinish)this.element.setStyle(this.originalStyle);},setDimensions:function(height,width){var d={};if(this.options.scaleX)d.width=width.round()+'px';if(this.options.scaleY)d.height=height.round()+'px';if(this.options.scaleFromCenter){var topd=(height-this.dims[0])/2;var leftd=(width-this.dims[1])/2;if(this.elementPositioning=='absolute'){if(this.options.scaleY)d.top=this.originalTop-topd+'px';if(this.options.scaleX)d.left=this.originalLeft-leftd+'px';}else{if(this.options.scaleY)d.top=-topd+'px';if(this.options.scaleX)d.left=-leftd+'px';}}
this.element.setStyle(d);}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({startcolor:'#ffff99'},arguments[1]||{});this.start(options);},setup:function(){if(this.element.getStyle('display')=='none'){this.cancel();return;}
this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle('background-image');this.element.setStyle({backgroundImage:'none'});}
if(!this.options.endcolor)
this.options.endcolor=this.element.getStyle('background-color').parseColor('#ffffff');if(!this.options.restorecolor)
this.options.restorecolor=this.element.getStyle('background-color');this._base=$R(0,2).map(function(i){return parseInt(this.options.startcolor.slice(i*2+1,i*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(i){return parseInt(this.options.endcolor.slice(i*2+1,i*2+3),16)-this._base[i]}.bind(this));},update:function(position){this.element.setStyle({backgroundColor:$R(0,2).inject('#',function(m,v,i){return m+((this._base[i]+(this._delta[i]*position)).round().toColorPart());}.bind(this))});},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}));}});Effect.ScrollTo=function(element){var options=arguments[1]||{},scrollOffsets=document.viewport.getScrollOffsets(),elementOffsets=$(element).cumulativeOffset();if(options.offset)elementOffsets[1]+=options.offset;return new Effect.Tween(null,scrollOffsets.top,elementOffsets[1],options,function(p){scrollTo(scrollOffsets.left,p.round());});};Effect.Fade=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();var options=Object.extend({from:element.getOpacity()||1.0,to:0.0,afterFinishInternal:function(effect){if(effect.options.to!=0)return;effect.element.hide().setStyle({opacity:oldOpacity});}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Appear=function(element){element=$(element);var options=Object.extend({from:(element.getStyle('display')=='none'?0.0:element.getOpacity()||0.0),to:1.0,afterFinishInternal:function(effect){effect.element.forceRerendering();},beforeSetup:function(effect){effect.element.setOpacity(effect.options.from).show();}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Puff=function(element){element=$(element);var oldStyle={opacity:element.getInlineOpacity(),position:element.getStyle('position'),top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};return new Effect.Parallel([new Effect.Scale(element,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(element,{sync:true,to:0.0})],Object.extend({duration:1.0,beforeSetupInternal:function(effect){effect.effects[0].element.absolutize();},afterFinishInternal:function(effect){effect.effects[0].element.hide().setStyle(oldStyle);}},arguments[1]||{}));};Effect.BlindUp=function(element){element=$(element);element.makeClipping();return new Effect.Scale(element,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(effect){effect.element.hide().undoClipping();}},arguments[1]||{}));};Effect.BlindDown=function(element){element=$(element);var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makeClipping().setStyle({height:'0px'}).show();},afterFinishInternal:function(effect){effect.element.undoClipping();}},arguments[1]||{}));};Effect.SwitchOff=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();return new Effect.Appear(element,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(effect){new Effect.Scale(effect.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned().setStyle({opacity:oldOpacity});}});}},arguments[1]||{}));};Effect.DropOut=function(element){element=$(element);var oldStyle={top:element.getStyle('top'),left:element.getStyle('left'),opacity:element.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(element,{x:0,y:100,sync:true}),new Effect.Opacity(element,{sync:true,to:0.0})],Object.extend({duration:0.5,beforeSetup:function(effect){effect.effects[0].element.makePositioned();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoPositioned().setStyle(oldStyle);}},arguments[1]||{}));};Effect.Shake=function(element){element=$(element);var options=Object.extend({distance:20,duration:0.5},arguments[1]||{});var distance=parseFloat(options.distance);var split=parseFloat(options.duration)/10.0;var oldStyle={top:element.getStyle('top'),left:element.getStyle('left')};return new Effect.Move(element,{x:distance,y:0,duration:split,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance,y:0,duration:split,afterFinishInternal:function(effect){effect.element.undoPositioned().setStyle(oldStyle);}});}});}});}});}});}});};Effect.SlideDown=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle('bottom');var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera)effect.element.setStyle({top:''});effect.element.makeClipping().setStyle({height:'0px'}).show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+'px'});},afterFinishInternal:function(effect){effect.element.undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.SlideUp=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle('bottom');var elementDimensions=element.getDimensions();return new Effect.Scale(element,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:'box',scaleFrom:100,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera)effect.element.setStyle({top:''});effect.element.makeClipping().show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+'px'});},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.Squish=function(element){return new Effect.Scale(element,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping();}});};Effect.Grow=function(element){element=$(element);var options=Object.extend({direction:'center',moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var initialMoveX,initialMoveY;var moveX,moveY;switch(options.direction){case'top-left':initialMoveX=initialMoveY=moveX=moveY=0;break;case'top-right':initialMoveX=dims.width;initialMoveY=moveY=0;moveX=-dims.width;break;case'bottom-left':initialMoveX=moveX=0;initialMoveY=dims.height;moveY=-dims.height;break;case'bottom-right':initialMoveX=dims.width;initialMoveY=dims.height;moveX=-dims.width;moveY=-dims.height;break;case'center':initialMoveX=dims.width/2;initialMoveY=dims.height/2;moveX=-dims.width/2;moveY=-dims.height/2;break;}
return new Effect.Move(element,{x:initialMoveX,y:initialMoveY,duration:0.01,beforeSetup:function(effect){effect.element.hide().makeClipping().makePositioned();},afterFinishInternal:function(effect){new Effect.Parallel([new Effect.Opacity(effect.element,{sync:true,to:1.0,from:0.0,transition:options.opacityTransition}),new Effect.Move(effect.element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition}),new Effect.Scale(effect.element,100,{scaleMode:{originalHeight:dims.height,originalWidth:dims.width},sync:true,scaleFrom:window.opera?1:0,transition:options.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(effect){effect.effects[0].element.setStyle({height:'0px'}).show();},afterFinishInternal:function(effect){effect.effects[0].element.undoClipping().undoPositioned().setStyle(oldStyle);}},options));}});};Effect.Shrink=function(element){element=$(element);var options=Object.extend({direction:'center',moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var moveX,moveY;switch(options.direction){case'top-left':moveX=moveY=0;break;case'top-right':moveX=dims.width;moveY=0;break;case'bottom-left':moveX=0;moveY=dims.height;break;case'bottom-right':moveX=dims.width;moveY=dims.height;break;case'center':moveX=dims.width/2;moveY=dims.height/2;break;}
return new Effect.Parallel([new Effect.Opacity(element,{sync:true,to:0.0,from:1.0,transition:options.opacityTransition}),new Effect.Scale(element,window.opera?1:0,{sync:true,transition:options.scaleTransition,restoreAfterFinish:true}),new Effect.Move(element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition})],Object.extend({beforeStartInternal:function(effect){effect.effects[0].element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoClipping().undoPositioned().setStyle(oldStyle);}},options));};Effect.Pulsate=function(element){element=$(element);var options=arguments[1]||{},oldOpacity=element.getInlineOpacity(),transition=options.transition||Effect.Transitions.linear,reverser=function(pos){return 1-transition((-Math.cos((pos*(options.pulses||5)*2)*Math.PI)/2)+.5);};return new Effect.Opacity(element,Object.extend(Object.extend({duration:2.0,from:0,afterFinishInternal:function(effect){effect.element.setStyle({opacity:oldOpacity});}},options),{transition:reverser}));};Effect.Fold=function(element){element=$(element);var oldStyle={top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};element.makeClipping();return new Effect.Scale(element,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(effect){new Effect.Scale(element,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(effect){effect.element.hide().undoClipping().setStyle(oldStyle);}});}},arguments[1]||{}));};Effect.Morph=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(options.style))this.style=$H(options.style);else{if(options.style.include(':'))
this.style=options.style.parseStyle();else{this.element.addClassName(options.style);this.style=$H(this.element.getStyles());this.element.removeClassName(options.style);var css=this.element.getStyles();this.style=this.style.reject(function(style){return style.value==css[style.key];});options.afterFinishInternal=function(effect){effect.element.addClassName(effect.options.style);effect.transforms.each(function(transform){effect.element.style[transform.style]='';});};}}
this.start(options);},setup:function(){function parseColor(color){if(!color||['rgba(0, 0, 0, 0)','transparent'].include(color))color='#ffffff';color=color.parseColor();return $R(0,2).map(function(i){return parseInt(color.slice(i*2+1,i*2+3),16);});}
this.transforms=this.style.map(function(pair){var property=pair[0],value=pair[1],unit=null;if(value.parseColor('#zzzzzz')!='#zzzzzz'){value=value.parseColor();unit='color';}else if(property=='opacity'){value=parseFloat(value);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout))
this.element.setStyle({zoom:1});}else if(Element.CSS_LENGTH.test(value)){var components=value.match(/^([\+\-]?[0-9\.]+)(.*)$/);value=parseFloat(components[1]);unit=(components.length==3)?components[2]:null;}
var originalValue=this.element.getStyle(property);return{style:property.camelize(),originalValue:unit=='color'?parseColor(originalValue):parseFloat(originalValue||0),targetValue:unit=='color'?parseColor(value):value,unit:unit};}.bind(this)).reject(function(transform){return((transform.originalValue==transform.targetValue)||(transform.unit!='color'&&(isNaN(transform.originalValue)||isNaN(transform.targetValue))));});},update:function(position){var style={},transform,i=this.transforms.length;while(i--)
style[(transform=this.transforms[i]).style]=transform.unit=='color'?'#'+
(Math.round(transform.originalValue[0]+
(transform.targetValue[0]-transform.originalValue[0])*position)).toColorPart()+
(Math.round(transform.originalValue[1]+
(transform.targetValue[1]-transform.originalValue[1])*position)).toColorPart()+
(Math.round(transform.originalValue[2]+
(transform.targetValue[2]-transform.originalValue[2])*position)).toColorPart():(transform.originalValue+
(transform.targetValue-transform.originalValue)*position).toFixed(3)+
(transform.unit===null?'':transform.unit);this.element.setStyle(style,true);}});Effect.Transform=Class.create({initialize:function(tracks){this.tracks=[];this.options=arguments[1]||{};this.addTracks(tracks);},addTracks:function(tracks){tracks.each(function(track){track=$H(track);var data=track.values().first();this.tracks.push($H({ids:track.keys().first(),effect:Effect.Morph,options:{style:data}}));}.bind(this));return this;},play:function(){return new Effect.Parallel(this.tracks.map(function(track){var ids=track.get('ids'),effect=track.get('effect'),options=track.get('options');var elements=[$(ids)||$$(ids)].flatten();return elements.map(function(e){return new effect(e,Object.extend({sync:true},options))});}).flatten(),this.options);}});Element.CSS_PROPERTIES=$w('backgroundColor backgroundPosition borderBottomColor borderBottomStyle '+'borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth '+'borderRightColor borderRightStyle borderRightWidth borderSpacing '+'borderTopColor borderTopStyle borderTopWidth bottom clip color '+'fontSize fontWeight height left letterSpacing lineHeight '+'marginBottom marginLeft marginRight marginTop markerOffset maxHeight '+'maxWidth minHeight minWidth opacity outlineColor outlineOffset '+'outlineWidth paddingBottom paddingLeft paddingRight paddingTop '+'right textIndent top width wordSpacing zIndex');Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement('div');String.prototype.parseStyle=function(){var style,styleRules=$H();if(Prototype.Browser.WebKit)
style=new Element('div',{style:this}).style;else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';style=String.__parseStyleElement.childNodes[0].style;}
Element.CSS_PROPERTIES.each(function(property){if(style[property])styleRules.set(property,style[property]);});if(Prototype.Browser.IE&&this.include('opacity'))
styleRules.set('opacity',this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return styleRules;};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(element){var css=document.defaultView.getComputedStyle($(element),null);return Element.CSS_PROPERTIES.inject({},function(styles,property){styles[property]=css[property];return styles;});};}else{Element.getStyles=function(element){element=$(element);var css=element.currentStyle,styles;styles=Element.CSS_PROPERTIES.inject({},function(results,property){results[property]=css[property];return results;});if(!styles.opacity)styles.opacity=element.getOpacity();return styles;};}
Effect.Methods={morph:function(element,style){element=$(element);new Effect.Morph(element,Object.extend({style:style},arguments[2]||{}));return element;},visualEffect:function(element,effect,options){element=$(element);var s=effect.dasherize().camelize(),klass=s.charAt(0).toUpperCase()+s.substring(1);new Effect[klass](element,options);return element;},highlight:function(element,options){element=$(element);new Effect.Highlight(element,options);return element;}};$w('fade appear grow shrink fold blindUp blindDown slideUp slideDown '+'pulsate shake puff squish switchOff dropOut').each(function(effect){Effect.Methods[effect]=function(element,options){element=$(element);Effect[effect.charAt(0).toUpperCase()+effect.substring(1)](element,options);return element;};});$w('getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles').each(function(f){Effect.Methods[f]=Element[f];});Element.addMethods(Effect.Methods);if(Object.isUndefined(Effect))
throw("dragdrop.js requires including script.aculo.us' effects.js library");var Droppables={drops:[],remove:function(element){this.drops=this.drops.reject(function(d){return d.element==$(element)});},add:function(element){element=$(element);var options=Object.extend({greedy:true,hoverclass:null,tree:false},arguments[1]||{});if(options.containment){options._containers=[];var containment=options.containment;if(Object.isArray(containment)){containment.each(function(c){options._containers.push($(c))});}else{options._containers.push($(containment));}}
if(options.accept)options.accept=[options.accept].flatten();Element.makePositioned(element);options.element=element;this.drops.push(options);},findDeepestChild:function(drops){deepest=drops[0];for(i=1;i<drops.length;++i)
if(Element.isParent(drops[i].element,deepest.element))
deepest=drops[i];return deepest;},isContained:function(element,drop){var containmentNode;if(drop.tree){containmentNode=element.treeNode;}else{containmentNode=element.parentNode;}
for(var i=0,l=drop._containers.length;i<l;i++){var dropItem=drop._containers[i],dl=dropItem.length;if(dl>0){for(var j=0;j<dl;j++){if(containmentNode==dropItem[j]){return dropItem[j];}}}else if(dropItem.tagName){if(containmentNode==dropItem){return dropItem;}}}},isAffected:function(point,element,drop){function withinRange(range_start,range,point){return(point>=range_start&&point<=range_start+range)}
return((drop.element!=element)&&((!drop._containers)||this.isContained(element,drop))&&((!drop.accept)||(Element.classNames(element).detect(function(v){return drop.accept.include(v)})))&&((drop.flat&&drop.flat=='vertical'&&withinRange(drop.element.cumulativeOffset()[1],drop.element.offsetHeight,point[1]))||(drop.flat&&drop.flat=='horizontal'&&withinRange(drop.element.cumulativeOffset()[0],drop.element.offsetWidth,point[0]))||Position.within(drop.element,point[0],point[1])));},deactivate:function(drop){if(drop.hoverclass)
Element.removeClassName(drop.element,drop.hoverclass);this.last_active=null;},activate:function(drop){if(drop.hoverclass)
Element.addClassName(drop.element,drop.hoverclass);this.last_active=drop;},show:function(point,element){if(!this.drops.length)return;var drop,affected=[];this.drops.each(function(drop){if(Droppables.isAffected(point,element,drop))
affected.push(drop);});if(affected.length>0)
drop=Droppables.findDeepestChild(affected);if(this.last_active&&this.last_active!=drop)this.deactivate(this.last_active);if(drop){Position.within(drop.element,point[0],point[1]);if(drop.onHover)
drop.onHover(element,drop.element,Position.overlap(drop.overlap,drop.element));if(drop!=this.last_active)Droppables.activate(drop);}},fire:function(event,element){if(!this.last_active)return;Position.prepare();if(this.isAffected([Event.pointerX(event),Event.pointerY(event)],element,this.last_active))
if(this.last_active.onDrop){this.last_active.onDrop(element,this.last_active.element,event);return true;}},reset:function(){if(this.last_active)
this.deactivate(this.last_active);}};var Draggables={drags:[],observers:[],register:function(draggable){if(this.drags.length==0){this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress);}
this.drags.push(draggable);},unregister:function(draggable){this.drags=this.drags.reject(function(d){return d==draggable});if(this.drags.length==0){Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress);}},activate:function(draggable){if(draggable.options.delay){this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=draggable;}.bind(this),draggable.options.delay);}else{window.focus();this.activeDraggable=draggable;}},deactivate:function(){this.activeDraggable=null;},updateDrag:function(event){if(!this.activeDraggable)return;var pointer=[Event.pointerX(event),Event.pointerY(event)];if(this._lastPointer&&(this._lastPointer.inspect()==pointer.inspect()))return;if(window.ie9&&!this._lastPointer){this._lastPointer=pointer;return;}
this._lastPointer=pointer;this.activeDraggable.updateDrag(event,pointer);},endDrag:function(event){if(this._timeout){clearTimeout(this._timeout);this._timeout=null;}
if(!this.activeDraggable)return;this._lastPointer=null;this.activeDraggable.endDrag(event);this.activeDraggable=null;},keyPress:function(event){if(this.activeDraggable)
this.activeDraggable.keyPress(event);},addObserver:function(observer){this.observers.push(observer);this._cacheObserverCallbacks();},removeObserver:function(element){this.observers=this.observers.reject(function(o){return o.element==element});this._cacheObserverCallbacks();},notify:function(eventName,draggable,event){if(this[eventName+'Count']>0)
this.observers.each(function(o){if(o[eventName])o[eventName](eventName,draggable,event);});if(draggable.options[eventName])draggable.options[eventName](draggable,event);},_cacheObserverCallbacks:function(){['onStart','onEnd','onDrag'].each(function(eventName){Draggables[eventName+'Count']=Draggables.observers.select(function(o){return o[eventName];}).length;});}};var Draggable=Class.create({initialize:function(element){var defaults={handle:false,reverteffect:function(element,top_offset,left_offset){var dur=Math.sqrt(Math.abs(top_offset^2)+Math.abs(left_offset^2))*0.02;new Effect.Move(element,{x:-left_offset,y:-top_offset,duration:dur,queue:{scope:'_draggable',position:'end'}});},endeffect:function(element){var toOpacity=Object.isNumber(element._opacity)?element._opacity:1.0;new Effect.Opacity(element,{duration:0.2,from:0.7,to:toOpacity,queue:{scope:'_draggable',position:'end'},afterFinish:function(){Draggable._dragging[element]=false}});},zindex:1000,revert:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false,delay:0};if(!arguments[1]||Object.isUndefined(arguments[1].endeffect))
Object.extend(defaults,{starteffect:function(element){element._opacity=Element.getOpacity(element);Draggable._dragging[element]=true;new Effect.Opacity(element,{duration:0.2,from:element._opacity,to:0.7});}});var options=Object.extend(defaults,arguments[1]||{});this.element=$(element);if(options.handle&&Object.isString(options.handle))
this.handle=this.element.down('.'+options.handle,0);if(!this.handle)this.handle=$(options.handle);if(!this.handle)this.handle=this.element;if(options.scroll&&!options.scroll.scrollTo&&!options.scroll.outerHTML){options.scroll=$(options.scroll);this._isScrollChild=Element.childOf(this.element,options.scroll);}
this.delta=this.currentDelta();this.options=options;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this);},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Draggables.unregister(this);},currentDelta:function(){return([parseInt(Element.getStyle(this.element,'left')||'0'),parseInt(Element.getStyle(this.element,'top')||'0')]);},initDrag:function(event){if(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element])return;if(Event.isLeftClick(event)){var src=Event.element(event);if((tag_name=src.tagName.toUpperCase())&&(tag_name=='INPUT'||tag_name=='SELECT'||tag_name=='OPTION'||tag_name=='BUTTON'||tag_name=='TEXTAREA'))return;var pointer=[Event.pointerX(event),Event.pointerY(event)];var pos=this.element.cumulativeOffset();this.offset=[0,1].map(function(i){return(pointer[i]-pos[i])});Draggables.activate(this);Event.stop(event);}},startDrag:function(event){this.dragging=true;if(!this.delta)
this.delta=this.currentDelta();if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,'z-index')||0);this.element.style.zIndex=this.options.zindex;}
if(this.options.ghosting){this._clone=this.element.cloneNode(true);this._originallyAbsolute=(this.element.getStyle('position')=='absolute');if(!this._originallyAbsolute)
this.element.absolutize();this.element.parentNode.insertBefore(this._clone,this.element);}
if(this.options.scroll){if(this.options.scroll==window){var where=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=where.left;this.originalScrollTop=where.top;}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop;}}
Draggables.notify('onStart',this,event);if(this.options.starteffect)this.options.starteffect(this.element);},updateDrag:function(event,pointer){if(!this.dragging)this.startDrag(event);if(!this.options.quiet){Position.prepare();Droppables.show(pointer,this.element);}
Draggables.notify('onDrag',this,event);this.draw(pointer);if(this.options.change)this.options.change(this);if(this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){p=[left,top,left+width,top+height];}}else{p=this.options.scroll.viewportOffset();p[0]+=this.options.scroll.scrollLeft+Position.deltaX;p[1]+=this.options.scroll.scrollTop+Position.deltaY;p.push(p[0]+this.options.scroll.offsetWidth);p.push(p[1]+this.options.scroll.offsetHeight);}
var speed=[0,0];if(pointer[0]<(p[0]+this.options.scrollSensitivity))speed[0]=pointer[0]-(p[0]+this.options.scrollSensitivity);if(pointer[1]<(p[1]+this.options.scrollSensitivity))speed[1]=pointer[1]-(p[1]+this.options.scrollSensitivity);if(pointer[0]>(p[2]-this.options.scrollSensitivity))speed[0]=pointer[0]-(p[2]-this.options.scrollSensitivity);if(pointer[1]>(p[3]-this.options.scrollSensitivity))speed[1]=pointer[1]-(p[3]-this.options.scrollSensitivity);this.startScrolling(speed);}
if(Prototype.Browser.WebKit)window.scrollBy(0,0);Event.stop(event);},finishDrag:function(event,success){this.dragging=false;if(this.options.quiet){Position.prepare();var pointer=[Event.pointerX(event),Event.pointerY(event)];Droppables.show(pointer,this.element);}
if(this.options.ghosting){if(!this._originallyAbsolute)
this.element.relativize();delete this._originallyAbsolute;Element.remove(this._clone);this._clone=null;}
var dropped=false;if(success){dropped=Droppables.fire(event,this.element);if(!dropped)dropped=false;}
if(dropped&&this.options.onDropped)this.options.onDropped(this.element);Draggables.notify('onEnd',this,event);var revert=this.options.revert;if(revert&&Object.isFunction(revert))revert=revert(this.element);var d=this.currentDelta();if(revert&&this.options.reverteffect){if(dropped==0||revert!='failure')
this.options.reverteffect(this.element,d[1]-this.delta[1],d[0]-this.delta[0]);}else{this.delta=d;}
if(this.options.zindex)
this.element.style.zIndex=this.originalZ;if(this.options.endeffect)
this.options.endeffect(this.element);Draggables.deactivate(this);Droppables.reset();},keyPress:function(event){if(event.keyCode!=Event.KEY_ESC)return;this.finishDrag(event,false);Event.stop(event);},endDrag:function(event){if(!this.dragging)return;this.stopScrolling();this.finishDrag(event,true);Event.stop(event);},draw:function(point){var pos=this.element.cumulativeOffset();if(this.options.ghosting){var r=this.element.cumulativeScrollOffset();pos[0]+=r[0]-Position.deltaX;pos[1]+=r[1]-Position.deltaY;}
var d=this.currentDelta();pos[0]-=d[0];pos[1]-=d[1];if(this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)){pos[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;pos[1]-=this.options.scroll.scrollTop-this.originalScrollTop;}
var p=[0,1].map(function(i){return(point[i]-pos[i]-this.offset[i])}.bind(this));if(this.options.snap){if(Object.isFunction(this.options.snap)){p=this.options.snap(p[0],p[1],this);}else{if(Object.isArray(this.options.snap)){p=p.map(function(v,i){return(v/this.options.snap[i]).round()*this.options.snap[i]}.bind(this));}else{p=p.map(function(v){return(v/this.options.snap).round()*this.options.snap}.bind(this));}}}
var style=this.element.style;if((!this.options.constraint)||(this.options.constraint=='horizontal'))
style.left=p[0]+"px";if((!this.options.constraint)||(this.options.constraint=='vertical'))
style.top=p[1]+"px";if(style.visibility=="hidden")style.visibility="";},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null;Draggables._lastScrollPointer=null;}},startScrolling:function(speed){if(!(speed[0]||speed[1]))return;this.scrollSpeed=[speed[0]*this.options.scrollSpeed,speed[1]*this.options.scrollSpeed];this.lastScrolled=new Date();this.scrollInterval=setInterval(this.scroll.bind(this),10);},scroll:function(){var current=new Date();var delta=current-this.lastScrolled;this.lastScrolled=current;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=delta/1000;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1]);}}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*delta/1000;this.options.scroll.scrollTop+=this.scrollSpeed[1]*delta/1000;}
Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify('onDrag',this);if(this._isScrollChild){Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer);Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*delta/1000;Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*delta/1000;if(Draggables._lastScrollPointer[0]<0)
Draggables._lastScrollPointer[0]=0;if(Draggables._lastScrollPointer[1]<0)
Draggables._lastScrollPointer[1]=0;this.draw(Draggables._lastScrollPointer);}
if(this.options.change)this.options.change(this);},_getWindowScroll:function(w){var T,L,W,H;with(w.document){if(w.document.documentElement&&documentElement.scrollTop){T=documentElement.scrollTop;L=documentElement.scrollLeft;}else if(w.document.body){T=body.scrollTop;L=body.scrollLeft;}
if(w.innerWidth){W=w.innerWidth;H=w.innerHeight;}else if(w.document.documentElement&&documentElement.clientWidth){W=documentElement.clientWidth;H=documentElement.clientHeight;}else{W=body.offsetWidth;H=body.offsetHeight;}}
return{top:T,left:L,width:W,height:H};}});Draggable._dragging={};var SortableObserver=Class.create({initialize:function(element,observer){this.element=$(element);this.observer=observer;this.lastValue=Sortable.serialize(this.element);},onStart:function(){this.lastValue=Sortable.serialize(this.element);},onEnd:function(){Sortable.unmark();if(this.lastValue!=Sortable.serialize(this.element))
this.observer(this.element)}});var Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(element){while(element.tagName.toUpperCase()!="BODY"){if(element.id&&Sortable.sortables[element.id])return element;element=element.parentNode;}},options:function(element){element=Sortable._findRootElement($(element));if(!element)return;return Sortable.sortables[element.id];},destroy:function(element){element=$(element);var s=Sortable.sortables[element.id];if(s){Draggables.removeObserver(s.element);s.droppables.each(function(d){Droppables.remove(d)});s.draggables.invoke('destroy');delete Sortable.sortables[s.element.id];}},create:function(element){element=$(element);var options=Object.extend({element:element,tag:'li',dropOnEmpty:false,tree:false,treeTag:'ul',overlap:'vertical',constraint:'vertical',containment:element,handle:false,only:false,delay:0,hoverclass:null,ghosting:false,quiet:false,scroll:false,flat:true,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:false,handles:false,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(element);var options_for_draggable={revert:true,quiet:options.quiet,scroll:options.scroll,scrollSpeed:options.scrollSpeed,scrollSensitivity:options.scrollSensitivity,delay:options.delay,ghosting:options.ghosting,constraint:options.constraint,handle:options.handle};if(options.starteffect)
options_for_draggable.starteffect=options.starteffect;if(options.reverteffect)
options_for_draggable.reverteffect=options.reverteffect;else
if(options.ghosting)options_for_draggable.reverteffect=function(element){element.style.top=0;element.style.left=0;};if(options.endeffect)
options_for_draggable.endeffect=options.endeffect;if(options.zindex)
options_for_draggable.zindex=options.zindex;var options_for_droppable={overlap:options.overlap,containment:options.containment,tree:options.tree,flat:options.flat,hoverclass:options.hoverclass,onHover:Sortable.onHover};var options_for_tree={onHover:Sortable.onEmptyHover,overlap:options.overlap,containment:options.containment,hoverclass:options.hoverclass};Element.cleanWhitespace(element);options.draggables=[];options.droppables=[];if(options.dropOnEmpty||options.tree){Droppables.add(element,options_for_tree);options.droppables.push(element);}
(options.elements||this.findElements(element,options)||[]).each(function(e,i){var handle=options.handles?$(options.handles[i]):(options.handle?$(e).select('.'+options.handle)[0]:e);options.draggables.push(new Draggable(e,Object.extend(options_for_draggable,{handle:handle})));Droppables.add(e,options_for_droppable);if(options.tree)e.treeNode=element;options.droppables.push(e);});if(options.tree){(Sortable.findTreeElements(element,options)||[]).each(function(e){Droppables.add(e,options_for_tree);e.treeNode=element;options.droppables.push(e);});}
this.sortables[element.id]=options;Draggables.addObserver(new SortableObserver(element,options.onUpdate));},findElements:function(element,options){return Element.findChildren(element,options.only,options.tree?true:false,options.tag);},findTreeElements:function(element,options){return Element.findChildren(element,options.only,options.tree?true:false,options.treeTag);},onHover:function(element,dropon,overlap){if(Element.isParent(dropon,element))return;if(overlap>.33&&overlap<.66&&Sortable.options(dropon).tree){return;}else if(overlap>0.5){Sortable.mark(dropon,'before');if(dropon.previousSibling!=element){var oldParentNode=element.parentNode;element.style.visibility="hidden";dropon.parentNode.insertBefore(element,dropon);if(dropon.parentNode!=oldParentNode)
Sortable.options(oldParentNode).onChange(element);Sortable.options(dropon.parentNode).onChange(element);}}else{Sortable.mark(dropon,'after');var nextElement=dropon.nextSibling||null;if(nextElement!=element){var oldParentNode=element.parentNode;element.style.visibility="hidden";dropon.parentNode.insertBefore(element,nextElement);if(dropon.parentNode!=oldParentNode)
Sortable.options(oldParentNode).onChange(element);Sortable.options(dropon.parentNode).onChange(element);}}},onEmptyHover:function(element,dropon,overlap){var oldParentNode=element.parentNode;var droponOptions=Sortable.options(dropon);if(!Element.isParent(dropon,element)){var index;var children=Sortable.findElements(dropon,{tag:droponOptions.tag,only:droponOptions.only});var child=null;if(children){var offset=Element.offsetSize(dropon,droponOptions.overlap)*(1.0-overlap);for(index=0;index<children.length;index+=1){if(offset-Element.offsetSize(children[index],droponOptions.overlap)>=0){offset-=Element.offsetSize(children[index],droponOptions.overlap);}else if(offset-(Element.offsetSize(children[index],droponOptions.overlap)/2)>=0){child=index+1<children.length?children[index+1]:null;break;}else{child=children[index];break;}}}
dropon.insertBefore(element,child);Sortable.options(oldParentNode).onChange(element);droponOptions.onChange(element);}},unmark:function(){if(Sortable._marker)Sortable._marker.hide();},mark:function(dropon,position){var sortable=Sortable.options(dropon.parentNode);if(sortable&&!sortable.ghosting)return;if(!Sortable._marker){Sortable._marker=($('dropmarker')||Element.extend(document.createElement('DIV'))).hide().addClassName('dropmarker').setStyle({position:'absolute'});document.getElementsByTagName("body").item(0).appendChild(Sortable._marker);}
var offsets=dropon.cumulativeOffset();Sortable._marker.setStyle({left:offsets[0]+'px',top:offsets[1]+'px'});if(position=='after')
if(sortable.overlap=='horizontal')
Sortable._marker.setStyle({left:(offsets[0]+dropon.clientWidth)+'px'});else
Sortable._marker.setStyle({top:(offsets[1]+dropon.clientHeight)+'px'});Sortable._marker.show();},_tree:function(element,options,parent){var children=Sortable.findElements(element,options)||[];for(var i=0;i<children.length;++i){var match=children[i].id.match(options.format);if(!match)continue;var child={id:encodeURIComponent(match?match[1]:null),element:element,parent:parent,children:[],position:parent.children.length,container:$(children[i]).down(options.treeTag)};if(child.container)
this._tree(child.container,options,child);parent.children.push(child);}
return parent;},tree:function(element){element=$(element);var sortableOptions=this.options(element);var options=Object.extend({tag:sortableOptions.tag,treeTag:sortableOptions.treeTag,only:sortableOptions.only,name:element.id,format:sortableOptions.format},arguments[1]||{});var root={id:null,parent:null,children:[],container:element,position:0};return Sortable._tree(element,options,root);},_constructIndex:function(node){var index='';do{if(node.id)index='['+node.position+']'+index;}while((node=node.parent)!=null);return index;},sequence:function(element){element=$(element);var options=Object.extend(this.options(element),arguments[1]||{});return $(this.findElements(element,options)||[]).map(function(item){return item.id.match(options.format)?item.id.match(options.format)[1]:'';});},setSequence:function(element,new_sequence){element=$(element);var options=Object.extend(this.options(element),arguments[2]||{});var nodeMap={};this.findElements(element,options).each(function(n){if(n.id.match(options.format))
nodeMap[n.id.match(options.format)[1]]=[n,n.parentNode];n.parentNode.removeChild(n);});new_sequence.each(function(ident){var n=nodeMap[ident];if(n){n[1].appendChild(n[0]);delete nodeMap[ident];}});},serialize:function(element){element=$(element);var options=Object.extend(Sortable.options(element),arguments[1]||{});var name=encodeURIComponent((arguments[1]&&arguments[1].name)?arguments[1].name:element.id);if(options.tree){return Sortable.tree(element,arguments[1]).children.map(function(item){return[name+Sortable._constructIndex(item)+"[id]="+
encodeURIComponent(item.id)].concat(item.children.map(arguments.callee));}).flatten().join('&');}else{return Sortable.sequence(element,arguments[1]).map(function(item){return name+"[]="+encodeURIComponent(item);}).join('&');}}};Element.isParent=function(child,element){if(!child.parentNode||child==element)return false;if(child.parentNode==element)return true;return Element.isParent(child.parentNode,element);};Element.findChildren=function(element,only,recursive,tagName){if(!element.hasChildNodes())return null;tagName=tagName.toUpperCase();if(only)only=[only].flatten();var elements=[];$A(element.childNodes).each(function(e){if(e.tagName&&e.tagName.toUpperCase()==tagName&&(!only||(Element.classNames(e).detect(function(v){return only.include(v)}))))
elements.push(e);if(recursive){var grandchildren=Element.findChildren(e,only,recursive,tagName);if(grandchildren)elements.push(grandchildren);}});return(elements.length>0?elements.flatten():[]);};Element.offsetSize=function(element,type){return element['offset'+((type=='vertical'||type=='height')?'Height':'Width')];};Object.extend(Event,{isEscPressed:function(event){return event.keyCode==Event.KEY_ESC&&!(event.altKey||event.ctrlKey||event.metaKey||event.shiftKey)}});var sortable_tasks=[];var openedDialog=false;var elementMethods={isRendered:function(element){var width=element.offsetWidth||0;var height=element.offsetHeight||0;return width!=0||height!=0;},getSelection:function(textarea){if(textarea.tagName.toUpperCase()!=='TEXTAREA')return false;var result={text:'',start:0,end:0}
if(document.selection){var selection=document.selection.createRange();result.text=selection.text;if(result.text.length>0){var clone=selection.duplicate();clone.moveToElementText(textarea);clone.setEndPoint('EndToEnd',selection);result.start=clone.text.length-result.text.length;result.end=result.start+result.text.length;}}else{result.start=textarea.selectionStart;result.end=textarea.selectionEnd;result.text=textarea.value.substring(result.start,result.end);}
return result;}}
Object.extend(Element,elementMethods);var fastClassNames={expressions:{},getExpression:function(className){if(!this.expressions[className]){this.expressions[className]=new RegExp('\\b'+className+'\\b');}
return this.expressions[className];},fastAddClassName:function(element,className){var re=this.getExpression(className);if(!re.test(element.className)){element.className+=' '+className;}
return element;},fastRemoveClassName:function(element,className){var re=this.getExpression(className);element.className=element.className.replace(re,'');},fastHasClassName:function(element,className){if(element.className.length>0){var re=this.getExpression(className);return re.test(element.className);}
return false;}}
var observersManager={observers:$A(),save:function(){if(document._prototypeEventID&&Event.cache&&Event.cache[document._prototypeEventID[0]]){var listeners=Event.cache[document._prototypeEventID[0]];for(var eventName in listeners){if(listeners[eventName].length>0&&eventName.match(/key.+/)){var portion=portion||{};portion[eventName]=listeners[eventName];}}
if(portion){for(var eventName in portion){document.stopObserving(eventName);}
this.observers.push(portion);}}},restore:function(){if(this.observers.length>0){for(var i=this.observers.length;i>this.observers.length-1;i--){var portion=this.observers[i-1];for(var eventName in portion){for(var j=0;j<portion[eventName].length;j++){document.observe(eventName,portion[eventName][j])}}
this.observers[i-1]=null}
this.observers=this.observers.compact();}}}
function hide(id){Element.addClassName(id,'hidden');}
function show(id){Element.removeClassName(id,'hidden');}
function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires="; expires="+date.toGMTString();}
else var expires="";document.cookie=name+"="+value+expires+"; path=/";}
function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);}
return null;}
var hover={begin:function(id){Element.show('task_item_hover_'+id)},end:function(id){Element.hide('task_item_hover_'+id)}}
function hide_calendar(){var caldr=window.calendar
if(caldr)
caldr.hide()}
var prettyInputs={focus:function(event){Element.addClassName(Event.element(event),'focused')},blur:function(event){Element.removeClassName(Event.element(event),'focused')},beautify:function(obj){fastClassNames.fastAddClassName(obj,'inp');Event.observe(obj,'focus',prettyInputs.focus);Event.observe(obj,'blur',prettyInputs.blur);},init:function(){if(!window.ie)return;var inps=document.getElementsByTagName('input');for(var i=0;i<inps.length;i++){if(inps[i].type=='text'||inps[i].type=='password'){prettyInputs.beautify(inps[i]);}}
inps=document.getElementsByTagName('textarea');for(var i=0;i<inps.length;i++){prettyInputs.beautify(inps[i]);}}}
var searchBox={init:function(box){if(box){Event.observe(box,'focus',searchBox.focus);Event.observe(box,'blur',searchBox.blur);}},focus:function(event){var box=Event.element(event);observersManager.save();Event.observe(box,'keydown',searchBox.escObserver);},blur:function(event){var box=Event.element(event);Event.stopObserving(box,'keydown',searchBox.escObserver);observersManager.restore();},escObserver:function(event){var box=Event.element(event);if(Event.isEscPressed(event)){Event.stop(event);box.blur();return false;}
return true;}}
var initTopSearchEscObserver=function(){searchBox.init($('search_text'))}
document.observe('dom:loaded',initTopSearchEscObserver);function redirect(url){if(url)location.href=url;}
function getTarget(event){return window.ie?event.srcElement:event.target}
function isInputTarget(e){var target=getTarget(e)
if(target&&target.nodeName){var targetNodeName=target.nodeName.toLowerCase()
if(targetNodeName=="textarea"||targetNodeName=="select"||(targetNodeName=="input"&&target.type&&(target.type.toLowerCase()=="text"||target.type.toLowerCase()=="password"||target.type.toLowerCase()=="checkbox"||target.type.toLowerCase()=="radio"))){return true;}}
return false;}
function showProjectSelector(){Element.hide('project_selector_link');Element.show('project_selector_form');Field.focus('project_menu_selector');observersManager.save();return false;}
function hideProjectSelector(){Element.hide('project_selector_form');Element.show('project_selector_link');observersManager.restore();return false;}
function smartTruncate(message){var length=30
if(length>=message.length)
return message
var sensitivity=10
var surroundings=message.substring(length-sensitivity,length+sensitivity)
if((surroundings!='')&&surroundings.match(/\s/))
return message.substring(0,(length-sensitivity)+surroundings.indexOf(" "))+"..."
else
return message.substring(0,length-3)+"..."}
function object(o){function F(){}
F.prototype=o;return new F();}
function updateSprintSelector(sprintList,options){var action=sprintList.options[sprintList.selectedIndex].value;if(!['assign_archived','other_projects'].include(action)){return true;}
var params={project:options.projectId,sprint_selector_id:sprintList.id,sprint_selector_name:sprintList.name,sprint_selector_class:sprintList.className,header:options.header,use_spacers:options.useSpacer,show_completed_sprints:options.showCompleted,include_current_sprint:options.includeCurrent,current_sprint_id:options.sprintId,change_handler:options.changeHandler,include_issues:options.includeIssues,include_any_sprint_item:options.includeAnySprintItem,allow_load_archived:options.allowLoadArchived,show_archived_sprints:options.showArchivedSprints,allow_other_projects:options.allowOtherProjects,show_other_projects:options.showOtherProjects,show_backlogs:options.showBacklogs,sprint_selector_holder:sprintList.parentNode.id,show_flash_message:true}
if(action=='assign_archived'){params.click_archived_sprints=true;}
if(action=='other_projects'){params.click_other_projects=true;}
new Ajax.Request('/sprints/selector',{asynchronous:true,evalScripts:true,parameters:params,onLoading:function(request){Spinner.show();},onComplete:function(request){Spinner.hide();}});return false;}
function reloadDependentCombos(project_selector,sprint_selector_name,user_selector_name,options){options=options||{};if(sprint_selector_name==null)
sprint_selector_name='sprint'
if(user_selector_name==null)
user_selector_name='task[owner_id]'
if(options['reload_users']==null)options['reload_users']=true
Element.show(project_selector.id+'_spinner')
var sprint_selector_id=project_selector.id.gsub('project','sprint')
params={sprint_selector_id:sprint_selector_id,sprint_selector_name:sprint_selector_name,use_spacers:false,show_completed:false,sprint_selector_holder:sprint_selector_id,show_flash_message:false};var selected_project=project_selector.options[project_selector.selectedIndex].value;if(!selected_project.blank())params.project=selected_project;if(options['include_issues']!=undefined)params.include_issues=options['include_issues'];if(options['include_any_sprint_item'])params.include_any_sprint_item=true;new Ajax.Request('/sprints/selector',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(){Element.hide(project_selector.id+'_spinner')}});if(options['reload_users']){var user_selector_id=project_selector.id.gsub('project','user')
new Ajax.Updater(user_selector_id,'/users/selector',{asynchronous:true,evalScripts:true,parameters:{project:project_selector.value,user_selector_id:user_selector_id,user_selector_name:user_selector_name},onComplete:function(){Element.hide(project_selector.id+'_spinner')}})}
if(options['reloadUserCombos']){for(var i=0;i<options['reloadUserCombos'].length;i++){var combo=options['reloadUserCombos'][i];new Ajax.Updater(combo.id,'/users/selector',{asynchronous:true,evalScripts:true,parameters:{project:project_selector.value,user_selector_id:combo.id,user_selector_name:combo.name},onComplete:function(){Element.hide(project_selector.id+'_spinner')}})}}}
var Flash={timeoutId:null,defaultTimeout:5000,initialize:function(){this.element=$('flash');this.messageElement=$('flash_message');},setMessage:function(message){this.messageElement.innerHTML=message;},setTimeout:function(timeoutLength){timeoutLength=timeoutLength||this.defaultTimeout;if(this.timeoutId){clearTimeout(this.timeoutId);}
this.timeoutId=setTimeout(this.hide.bind(this),timeoutLength);},hide:function(){if(this.timeoutId){clearTimeout(this.timeoutId);}
this.element.removeClassName('flash_shown');},show:function(timeoutLength){this.element.addClassName('flash_shown');this.setTimeout(timeoutLength);},showMessage:function(message,timeoutLength){this.setMessage(message);this.show(timeoutLength);}}
document.observe('dom:loaded',Flash.initialize.bind(Flash));var Spinner={initialize:function(){this.element=$('spinner');this.messageElement=$('spinner_message');},hide:function(){this.element.removeClassName('flash_shown');},show:function(message){this.messageElement.innerHTML=message||'processing...';this.element.addClassName('flash_shown');}}
document.observe('dom:loaded',Spinner.initialize.bind(Spinner));var HelpExample={showOrHide:function(id){if(Element.visible(id+'_animation')){$(id+'_link').innerHTML='Show Example';Element.hide(id+'_animation');Element.remove(id+'_image');}else{$(id+'_link').innerHTML='Hide Example';Element.show(id+'_animation');Element.show(id+'_spinner');new Ajax.Request('/help/example',{asyncronous:true,evalScripts:true,parameters:{example_id:id}});}
return false;}}
function loginToOrg(){org=prompt('Enter org id or domain','');if(!org)return;location.href='/orgs/try_login_root_to_org?org='+org;}
var DescriptionHints=Class.create({initialize:function(nodes,options){this.showTimeOut=null;this.hideTimeOut=null;this.currentHint=null;this.relativeParent=null;this.cursor=[0,0];this.options=Object.extend({showDelay:250,hideDelay:90,className:'hint',classNameShown:'hint_shown',stayOnScreen:true,position:'near_mouse',hintPositionStyle:'fixed'},options||{});for(var i=0;i<nodes.length;i++){Event.observe(nodes[i],'mouseover',this.mouseOver.bindAsEventListener(this,nodes[i]));Event.observe(nodes[i],'mouseout',this.mouseOut.bindAsEventListener(this,nodes[i]));Event.observe(nodes[i],'mousemove',this.mouseMove.bindAsEventListener(this));}},mouseOver:function(event,parent){var target=Event.element(event);var hint=parent.getElementsByClassName(this.options.className)[0];if(!hint)return;if(hint==this.currentHint||target.hasClassName(this.options.className)){clearTimeout(this.hideTimeOut);}else{this.cursor=[Event.pointerX(event),Event.pointerY(event)];this.showTimeOut=setTimeout(this.showHint.bind(this,hint),this.options.showDelay);if(typeof this.options.onBeforeShow=='function'){this.options.onBeforeShow(event,parent,hint);}}},mouseMove:function(event){this.cursor=[Event.pointerX(event),Event.pointerY(event)];},mouseOut:function(event,parent){var hint=parent.getElementsByClassName(this.options.className)[0];if(!hint)return;if(this.showTimeOut){clearTimeout(this.showTimeOut);}
if(hint==this.currentHint){this.hideTimeOut=setTimeout(this.hideHint.bind(this),this.options.hideDelay);}},showHint:function(hint){this.currentHint=hint;if(window.ie&&this.options.zIndexClass){var current=hint;while(!current.hasClassName(this.options.zIndexClass)){current=$(current.parentNode);}
if(current!=hint){this.relativeParent=current;this.relativeParent._oldZIndex=this.relativeParent.style.zIndex;this.relativeParent.style.zIndex='1';}}
var parentNode=$(hint.parentNode);var parentPos=windowHelper.findPos(parentNode);var parentSize=windowHelper.innerSize(parentNode);var scroll=windowHelper.scrollOffsets();var left=this.options.position=='near_mouse'?(this.cursor[0]-scroll[0]):(parentPos[0]+parentNode.offsetWidth-17-scroll[0]);var top=this.options.position=='near_mouse'?(this.cursor[1]-scroll[1]):(parentPos[1]-10-scroll[1]);if(this.options.hintPositionStyle=='absolute'){top+=scroll[1];}
if(this.options.stayOnScreen&&this.options.hintPositionStyle!='absolute'){var dimensions=this.currentHint.getDimensions(),viewport=document.viewport.getDimensions();if(left+dimensions.width>viewport.width){left=viewport.width-dimensions.width-25;}
if(top+dimensions.height>viewport.height){top=viewport.height-dimensions.height-25;}}
this.currentHint.style.left=left+'px';this.currentHint.style.top=top+'px';this.currentHint.addClassName(this.options.classNameShown);this.showTimeOut=null;},hideHint:function(){if(this.currentHint){this.currentHint.removeClassName(this.options.classNameShown);this.currentHint=null;if(window.ie&&this.relativeParent){this.relativeParent.style.zIndex=this.relativeParent._oldZIndex;this.relativeParent=null;}}
this.hideTimeOut=null;}})
var SearchHints={currentHint:null,init:function(nodes){for(var i=0,l=nodes.length;i<l;i++){Event.observe(nodes[i],'click',this.showHint.bindAsEventListener(this,nodes[i]));}
this.hideListener=this.hideHint.bind(this);},showHint:function(event,element){var hint=element.getElementsByClassName('hint')[0];if(hint!=this.currentHint){this.hideHint();hint.addClassName('hint_shown');this.currentHint=hint;document.observe('click',this.hideListener);}else{this.hideHint();}
Event.stop(event);return false;},hideHint:function(){if(this.currentHint){this.currentHint.removeClassName('hint_shown');this.currentHint=null;document.stopObserving('click',this.hideListener);}}}
var shortcutListener={listen:true,shortcut:null,combination:'',lastKeypress:0,clearTimeout:2000,keys:{KEY_BACKSPACE:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_SPACE:32,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34},map:{186:59,187:61,188:44,189:95,190:62,191:47,192:126,219:91,220:92,221:93},shifted:{59:58,61:43,44:60,45:95,46:62,47:63,192:96,92:124,222:39,222:34,49:33,50:64,51:35,52:36,53:37,54:94,55:38,56:42,57:40,58:41,91:123,93:125},UA:{gecko:navigator.userAgent.indexOf('Gecko')!=-1,ie:navigator.userAgent.indexOf('MSIE')!=-1,opera:window.opera,webkit:(/Safari|Chrome/.test(navigator.userAgent))},init:function(){if(!window.SHORTCUTS)return false;this.createStatusArea();if(this.UA.opera){this.map={},reverse={}
for(var key in this.shifted){reverse[this.shifted[key]]=key;}
var unshift=[33,64,35,36,37,94,38,42,40,41,58,43,60,95,62,63,124,34];for(var i=0;i<unshift.length;++i){this.map[unshift[i]]=reverse[unshift[i]];}}
this.setObserver();},isInputTarget:function(e){var target=e.target||e.srcElement,targetNodeName=target.nodeName.toLowerCase();if(targetNodeName=='textarea'||targetNodeName=='select'||(targetNodeName=='input'&&target.type&&(target.type.toLowerCase()=='text'||target.type.toLowerCase()=='password'))){return true;}
return false;},stopEvent:function(event){if(event.preventDefault){event.preventDefault();event.stopPropagation();}else{event.returnValue=false;event.cancelBubble=true;}
return false;},createStatusArea:function(){this.statusNode=document.createElement('div');this.statusNode.setAttribute('id','shortcut_status');this.statusNode.style.display='none';document.body.appendChild(this.statusNode);},showStatus:function(){this.statusNode.style.display='';},hideStatus:function(){this.statusNode.style.display='none';},showCombination:function(){this.statusNode.innerHTML=this.combination;this.showStatus();},eventType:function(){return(this.UA.ie||this.UA.webkit)?'keydown':'keypress';},setObserver:function(){var listener=function(e){shortcutListener.keyCollector(e)};if(document.addEventListener){document.addEventListener(this.eventType(),listener,false);}else if(document.attachEvent){document.attachEvent('on'+this.eventType(),listener);}},keyCollector:function(e){if(!shortcutListener.listen)return true;var isFunctional=(function(e){if(!this.UA.ie){if(!e.key){return(!e.which&&!e.charCode&&e.keyCode>=112&&e.keyCode<=123)}else{return(/^F\d+$/.test(e.key))}}}).bind(this)
if(isFunctional(e))return true;var code=e.which?e.which:e.keyCode;code=this.map[code]||code;if(e.shiftKey&&(this.UA.ie||this.UA.opera||this.UA.webkit)){code=this.shifted[code]||code;}
for(var key in this.keys){if(this.UA.gecko){if((e.keyCode&&e.keyCode==this.keys[key]))return true;}else{if(code==this.keys[key])return true;}}
var letter=null;if(code!=27){letter=String.fromCharCode(code).toLowerCase();}else{letter='Esc'}
if(this.isInputTarget(e)&&!(letter=='Esc'||e.altKey||e.ctrlKey||e.metaKey))return true;if(e.shiftKey){letter=letter.toUpperCase()}
if(e.altKey||e.ctrlKey||e.metaKey){letter='-'+letter;}
if(e.altKey){letter='A'+letter;}
if(e.ctrlKey){letter='C'+letter;}
if(e.metaKey){letter='M'+letter;}
if(shortcutListener.process(letter,e)){shortcutListener.stopEvent(e);}},process:function(letter,e){if(!shortcutListener.shortcut){shortcutListener.shortcut=SHORTCUTS;}
if(!shortcutListener.shortcut[letter])return false;if(typeof(shortcutListener.shortcut[letter])=="function"){shortcutListener.shortcut[letter](e,letter);shortcutListener.clearCombination();}else{shortcutListener.shortcut=shortcutListener.shortcut[letter];shortcutListener.combination=shortcutListener.combination+letter;if(shortcutListener.combination.length>0){shortcutListener.showCombination();var d=new Date;shortcutListener.lastKeypress=d.getTime();setTimeout(shortcutListener.clearCombinationOnTimeout,shortcutListener.clearTimeout);};}
return true;},clearCombination:function(){shortcutListener.shortcut=null;shortcutListener.combination='';this.hideStatus();},clearCombinationOnTimeout:function(){var d=new Date;if((d.getTime()-shortcutListener.lastKeypress)>=(shortcutListener.clearTimeout-100)){shortcutListener.clearCombination();}}}
var genericList={lastRowClicked:null,row:function(itemId){return null;},getId:function(element){return null;},getProjectId:function(){return pageProperties.projectId;},getProjectIdForTask:function(taskId){return parseInt($('project_id_for_'+taskId).innerHTML);},findItem:function(itemId,direction){var row=this.row(itemId)
if(!row)return false;do{row=direction==Direction.Back?row.previousSibling:row.nextSibling}while(row&&(row.nodeName!='TR'))
return row?this.getId(row):null},findItemsBetween:function(itemId1,itemId2){if(!itemId2||!itemId1)return[]
var items=this.findItemsBetweenInDirection(itemId1,itemId2,Direction.Forward);if(items.length==0){items=this.findItemsBetweenInDirection(itemId1,itemId2,Direction.Back);}
return items;},findItemsBetweenInDirection:function(itemId1,itemId2,direction){var items=[];var item=this.findItem(itemId1,direction);while(item&&item!=itemId2){items.push(item);item=this.findItem(item,direction);}
if(item==itemId2){items.push(item);return items;}
return[]},isLastRow:function(itemId){var next=this.findItem(itemId,Direction.Forward)
return(next==null)||(next==0)},setRowSelection:function(row,state){if(state){fastClassNames.fastAddClassName(row,'selected');}else{fastClassNames.fastRemoveClassName(row,'selected');}},getCheckBox:function(row){var inputs=row.getElementsByTagName('input');for(var i=0;i<inputs.length;i++){if(inputs[i].type=='checkbox'&&inputs[i].name=='selected'&&inputs[i].id!='checkbox_0'){return inputs[i];}}},select:function(row,checkbox,state){if(!checkbox){checkbox=this.getCheckBox(row);}
if(checkbox){checkbox.checked=state;this.setRowSelection(row,checkbox.checked);}},toggle:function(row,checkbox){if(!checkbox){checkbox=this.getCheckBox(row);checkbox.checked=!checkbox.checked;}
this.setRowSelection(row,checkbox.checked)},multipleSelect:function(id,e){var state=this.isSelected(id);var items=this.findItemsBetween(id,this.lastRowClicked);for(var i=0;i<items.length;i++){this.select(this.row(items[i]),null,state);}},selectAll:function(state){var rows=$('tasklist').tBodies[0].rows;for(var i=0;i<rows.length;i++){this.select(rows[i],null,state);}},selectedItems:function(){var items=new Array
var sels=document.getElementsByName('selected')
for(var i=0;i<sels.length;i++){var cb=sels[i]
if(cb&&cb.type&&cb.type=='checkbox'&&cb.checked)
items.push(cb.id.replace('checkbox_',''))}
return items},isSelected:function(id){var cb=$('checkbox_'+id)
if(cb)return cb.checked;return false;}}
var newTask={allowedNestingLevel:3,focusField:'task_description',canInsertChild:function(taskId){if(!taskId)return false
return taskList.getLevel(taskId)<(this.allowedNestingLevel-1)},insertChildAt:function(taskId){this.repositionTo(taskId,InsertType.Child)
this.insertTask(taskId,InsertType.Child)},insertSiblingAt:function(taskId,location){var insertId=taskId
var type=InsertType.Sibling
if(location==InsertLocation.Before){insertId=taskList.findSibling(taskId,Direction.Back)
var prevId=taskList.findItem(taskId,Direction.Back)
if(!(insertId||prevId)){this.insertAtTop()
return}else if(!insertId&&prevId){insertId=prevId
type=InsertType.Child}else{insertId=prevId}}
this.repositionTo(insertId,type)
this.insertTask(insertId,type)},insertAtTop:function(){if(Element.visible(this.new_task_form)){this.closeForm();}else{this.resetForm();Element.insert($('tasks'),{top:'<tr class="nohover" id="new_form_row">'+'<td colspan="4"></td>'+'<td class="new_form_col" id="new_form_col" colspan="'+(this.numColumns()-4)+'"/>'+'</tr>'});$('new_form_col').appendChild(this.new_task_form)
this.showForm();}},insertAtBottom:function(){if(Element.visible(this.new_task_form)){newTask.closeForm();}else{this.insertSiblingAt(0,InsertLocation.Before);Element.hide('task_item_contents_0');}},repositionTo:function(taskId,type){this.hideForm()
var insertId=taskId
if((type==InsertType.Sibling))
insertId=taskList.findChild(insertId,FindType.LastRecursive)||insertId
var taskLevel=taskList.getLevel(taskId)
var insertionLevel=(type==InsertType.Child)?taskLevel+1:taskLevel
var leftId=null
var leftType=null
var rightId=null
var rightType=null
var nextTask=taskList.findItem(insertId,Direction.Forward)
if((nextTask&&(taskList.getLevel(nextTask)<insertionLevel))||taskList.isLastRow(insertId)){leftId=(type==InsertType.Child)?taskId:taskList.findParent(taskId)
leftType='Sibling'}
if((type==InsertType.Sibling)&&newTask.canInsertChild(taskId)){rightId=taskList.findChild(taskId,FindType.Last)||taskId
rightType=rightId==taskId?'Child':'Sibling'}
var leftClick=leftId?'newTask.insert'+leftType+'At('+leftId+', InsertLocation.After);':'',rightClick=rightId?'newTask.insert'+rightType+'At('+rightId+', InsertLocation.After);':'';leftClick=leftClick+'return false;';rightClick=rightClick+'return false;';var leftClassName=leftId?"sprite-inline-left":"sprite-inline-left-disabled",rightClassName=rightId?"sprite-inline-right":"sprite-inline-right-disabled"
var td_class='new_form_col_'+insertionLevel;Element.insert($('task_item_contents_'+insertId),{after:'<tr class="nohover" id="new_form_row">'+'<td class="new_form_space"></td>'+'<td class="new_form_arrow_left">'+'<a id="new_task_form_left_arrow"  class="'+leftClassName+'" href="#" onclick="'+leftClick+'"></a>'+'</td><td class="new_form_arrow_right">'+'<a id="new_task_form_right_arrow" class="'+rightClassName+'" href="#" onclick="'+rightClick+'"></a>'+'</td>'+'<td class="new_form_space" colspan="1"></td>'+'<td class="'+td_class+'" id="new_form_col" colspan="'+(this.numColumns()-4)+'"/>'+'</tr>'});$('new_form_col').appendChild(this.new_task_form)
Element.insert($('task_new_form'),{bottom:'<input type="hidden" name="insert_after" id="insert_after" value="'+insertId+'" />'});},insertTask:function(taskId,type){if(!taskId)return
var insertionLevel=taskList.getLevel(taskId)+((type==InsertType.Child)?1:0)
this.showForm();if(!$('task_parent_id')&&(type!=InsertType.Sibling)){if($('task_sibling_id'))Element.remove('task_sibling_id')
Element.insert($('task_new_form'),{bottom:'<input type="hidden" name="task[parent_id]" id="task_parent_id" value="'+taskId+'" />'});}else if(!$('task_sibling_id')&&(type==InsertType.Sibling)){if($('task_parent_id'))Element.remove('task_parent_id')
Element.insert($('task_new_form'),{bottom:'<input type="hidden" name="task[sibling_id]" id="task_sibling_id" value="'+taskId+'" />'});}else{if($('task_sibling_id'))Element.remove('task_sibling_id')
if($('task_parent_id'))Element.remove('task_parent_id')}
Element.insert($('task_new_form'),{bottom:'<input type="hidden" name="insert_level" id="insert_level" value="'+insertionLevel+'" />'});},showForm:function(){if(!elementMethods.isRendered(this.new_task_form)){Element.show(this.new_task_form);}
var offset=windowHelper.scrollOffsets()[1]
var innerHeight=windowHelper.innerSize()[1]
var pos=windowHelper.findPos($('new_form_row'))
if(offset+innerHeight-160<pos[1])
window.scrollBy(0,160)
else if(offset>pos[1])
window.scrollBy(0,pos[1]-offset)
if(this.show_hide_new_task&&this.show_hide_new_task.value!='Hide Form'){this.show_hide_new_task.value=this.show_hide_new_task2.value='Hide Form';}
DialogManager.registerDialog(this);Field.focus('task_description');},hideForm:function(){this.resetForm();if(this.show_hide_new_task&&this.show_hide_new_task.value!='New Task'){this.show_hide_new_task.value=this.show_hide_new_task2.value='New Task';}
var toRemove=['insert_after','task_sibling_id','task_parent_id','insert_level','errorExplanation']
for(var i=0;i<toRemove.length;i++){var node=$(toRemove[i]);if(node)Element.remove(node);}
var descriptionEl=$('task_description')
var errorsEl=descriptionEl.parentNode
if(errorsEl&&errorsEl.className=='fieldWithErrors'){errorsEl.parentNode.insertBefore(descriptionEl,errorsEl)
Element.remove(errorsEl)}
if(elementMethods.isRendered(this.new_task_form)){Element.hide(this.new_task_form);}},resetForm:function(){var form_container=$('new_task_form_container')
if(this.new_task_form.parentNode!=form_container){form_container.appendChild(this.new_task_form)
var new_form_row=$('new_form_row')
if(new_form_row)Element.remove(new_form_row)}
if($('unplanned_estimate'))Element.remove('unplanned_estimate')
this.collapseMoreSection();},clearForm:function(preserveValues){if(!preserveValues){$('task_description').value='';$('task_estimate').value='';if($('task_wiki')){$('task_wiki').value='';}}},closeForm:function(preserveValues){DialogManager.unregisterDialog(this);this.hideForm();this.clearForm(preserveValues);if($('task_item_contents_0'))
Element.show('task_item_contents_0');},numColumns:function(){return $('tasklist').rows[0].cells.length;},init:function(){this.new_task_form=$('new_task_form');this.show_hide_new_task=$('show_hide_new_task');this.show_hide_new_task2=$('show_hide_new_task2');},save:function(){document.new_edit_form.onsubmit();},cancel:function(){this.closeForm();},more:function(){this.moreSectionExpanded()?this.collapseMoreSection():this.expandMoreSection();},collapseMoreSection:function(){var form=$('new_task_form_more');if(!form)return;if(form.hasClassName('hidden'))return;var arrow=$('new_task_form_more_arrow');var state=$('new_task_form_expanded');arrow.removeClassName('sprite-down_arrow').addClassName('sprite-right_arrow');form.addClassName('hidden');state.value='false';},expandMoreSection:function(){var form=$('new_task_form_more');if(!form)return;if(!form.hasClassName('hidden'))return;var arrow=$('new_task_form_more_arrow');var state=$('new_task_form_expanded');arrow.removeClassName('sprite-right_arrow').addClassName('sprite-down_arrow');;form.removeClassName('hidden');state.value='true';},moreSectionExpanded:function(){return!$('new_task_form_more').hasClassName('hidden');},moveFormLeft:function(){return this.clickOnIndentationArrow('new_task_form_left_arrow');},moveFormRight:function(){return this.clickOnIndentationArrow('new_task_form_right_arrow');},clickOnIndentationArrow:function(arrowId){if(!Element.visible(this.new_task_form))return false;var arrow=$(arrowId);if(arrow.onclick)arrow.onclick();return false}}
document.observe('dom:loaded',newTask.init.bind(newTask));var taskList={}
Object.extend(taskList,genericList);Object.extend(taskList,{rowsCache:{},row:function(taskId){var id='task_item_contents_'+taskId;if(!this.rowsCache[id]||!elementMethods.isRendered(this.rowsCache[id])){this.rowsCache[id]=$(id);}
return this.rowsCache[id];},getId:function(taskEl){if(taskEl==null)return null
while(taskEl&&taskEl.nodeName!='TR')
taskEl=taskEl.parentNode
if(taskEl&&taskEl.nodeName=='TR'){var id=parseInt(taskEl.id.substr(19,100))
return isNaN(id)?null:id}
return null},findSibling:function(taskId,direction){var desiredLevel=this.getLevel(taskId)
var sibling=null
taskId=this.findItem(taskId,direction)
while(taskId||(taskId!=null&&taskId==0)){var taskLevel=this.getLevel(taskId)
if(taskLevel<desiredLevel)
break;else if(taskLevel==desiredLevel){sibling=taskId
break;}
taskId=this.findItem(taskId,direction)}
return sibling},findChild:function(taskId,type){var childId=null
var desiredLevel=this.getLevel(taskId)+1
var op=function(){return type==FindType.LastRecursive?taskLevel>=desiredLevel:taskLevel==desiredLevel}
do{taskId=this.findItem(taskId,Direction.Forward)
var taskLevel=this.getLevel(taskId)
if(op()){childId=taskId
if(type==FindType.First)
break}}while(taskId&&(taskLevel>=desiredLevel))
return childId},findParent:function(taskId){var parentId=null
var desiredLevel=this.getLevel(taskId)-1
if(desiredLevel<0)return null
do{taskId=this.findItem(taskId,Direction.Back)
var taskLevel=this.getLevel(taskId)
if(taskLevel==desiredLevel){parentId=taskId
break}}while(taskId&&(taskLevel!=desiredLevel))
return parentId},findParents:function(taskId){var parents=[]
while(taskId=this.findParent(taskId))
parents.push(taskId)
return parents},findChildren:function(taskId){var children=[];var desiredLevel=this.getLevel(taskId)+1;do{taskId=this.findItem(taskId,Direction.Forward);var taskLevel=this.getLevel(taskId);if(taskLevel>=desiredLevel)
children.push(taskId);}while(taskId&&(taskLevel>=desiredLevel));return children;},isLastChild:function(taskId){return!this.findSibling(taskId,Direction.Forward)},isParent:function(task){if(task==0)return false
return!taskList.getField('status',task)},isPlaceholder:function(taskId){return taskId==0},taskFieldLabel:function(field,taskId){return $('task_'+field+'_link_'+taskId)},taskFieldEditor:function(field,taskId){return $('task_'+field+'_editor_'+taskId)},isMultiSprint:function(){if(typeof this._multiSprint=='undefined'){this._multiSprint=$('task_list_is_multisprint').innerHTML;}
return $('task_list_is_multisprint')=='true';},urlParams:function(){var el=$('task_list_url_params');if(!el)return'';return el.innerHTML;},constructedFrom:function(){return $('task_list_constructed_from').innerHTML;},selectedTasks:function(){return this.selectedItems();},taskFields:{'description':'','status':'','owner_id':'','estimate':'','remaining':'','resolution':''},getSprintId:function(taskEl){if(typeof this._sprintId!='undefined'){return this._sprintId;}else{var node=$('sprint_id');if(!node){this._sprintId=null;}else{this._sprintId=parseInt(node.innerHTML);}}
return this._sprintId;},getIssueNumber:function(taskId){var issue_number=$('issue_number_for_'+taskId);return taskList.isPlaceholder(taskId)?0:issue_number?parseInt(issue_number.innerHTML):0;},getIssueId:function(taskId){var issue_id=$('issue_id_for_'+taskId);return taskList.isPlaceholder(taskId)?0:issue_id?parseInt(issue_id.innerHTML):0;},getDescription:function(task){if(task==null)return null
var taskId=this.normalizeId(task)
var fieldLabel=this.taskFieldLabel('description',taskId)
if(fieldLabel)
return this.extractDescriptionText(fieldLabel.firstChild.firstChild.nextSibling.innerHTML)
else
return null},extractDescriptionText:function(str){return str.replace(/<[wW][bB][rR](\s+[^>]*)?\/?>/g,'').replace(/(\u00AD|\u200B)/g,'').replace(/<[bB][rR](\s+[^>]*)?\/?>/g,'FORGETIEANDKONQ').unescapeHTML().replace(/FORGETIEANDKONQ/g,'\n');},getField:function(field,task){if(task==null)return null
var taskId=this.normalizeId(task)
if(field=='description')
return this.getDescription(task)
else if((field in this.taskFields)&&(this.taskFieldLabel(field,taskId)))
return this.taskFieldLabel(field,taskId).firstChild.innerHTML.replace(/\u200B/g,'').unescapeHTML()
return null},getOwnerId:function(task){if(task==null)return null;var taskId=this.normalizeId(task);var ownerEl=this.taskFieldLabel('owner_id',taskId);if(ownerEl)
return parseInt(ownerEl.className.substring(9));return null;},getLevel:function(task){if(task==null)return null
var taskId=this.normalizeId(task)
return parseInt(this.row(taskId).className.match(/level_(\d)/)[1])},getParentId:function(task){if(task==null)return null
var taskId=this.normalizeId(task)
return parseInt($('parent_for_'+taskId).innerHTML)||null},normalizeId:function(task){if(task==null)return null
var taskId=task
if(task.constructor==String)
taskId=parseInt(task)
else if(task.constructor!=Number)
taskId=this.getId(task)
return taskId},taskIdByIssueId:function(issueId){var issueEl=$('issue_'+issueId);if(!issueEl)return null;return issueEl.firstChild.id.match(/issue_number_for_([0-9]+)/)[1];},getAnchor:function(){var anchor=window.location.href.match(/#(\d+)/);return(anchor)?anchor[1]:false;},blinkAnchor:function(){var anchor=this.getAnchor();if(!anchor)return false
var taskId=this.taskIdByIssueId(anchor);if(!taskId){Flash.showMessage('Unable to find task #'+anchor+'. It may be filtered out. Try to <a href="#" onclick="taskList.unsetFilters(); return false;">clear filters</a>.',10000);return false;}
var taskRow=$('task_item_contents_'+taskId);windowHelper.scroll(windowHelper.findPos(taskRow)[1],{center:true});Cursor.setTaskAtCursor(taskId);new Effect.Highlight(taskRow,{duration:5.0});return false},goToTaskSprintOrChangeset:function(){var input=prompt('Enter task, sprint (sXXXX) or changeset (cXXXX) number:','');if(input==null){return;}
input=input.strip();var match=input.match(/^([cs]?)(\d+)/),mode=match?match[1]:null;number=match?parseInt(match[2]):null;if(mode===null){Flash.showMessage('Invalid input - enter task, sprint (sXXXX) or changeset (cXXXX) number');return;}
var request_params={};if(pageProperties.projectId){request_params.project_id=pageProperties.projectId;}
if(mode==="s"){taskList.goToSprint(number);}else if(mode==="c"){taskList.goToChangeset(number,request_params);}else{taskList.goToTask(number);}},goToChangeset:function(changesetNumber,request_params){if(!changesetNumber)return;if(changesetNumber<=0){Flash.showMessage('Invalid changeset number');return;}
new Ajax.Request('/tasks/goto/c'+changesetNumber,{asynchronous:true,evalScripts:true,parameters:request_params,onLoading:function(){Spinner.show();},onComplete:function(){Spinner.hide();}})},goToSprint:function(sprintNumber){if(!sprintNumber)return;if(sprintNumber<=0){Flash.showMessage('Invalid sprint number');return;}
new Ajax.Request('/tasks/goto/s'+sprintNumber,{asynchronous:true,evalScripts:true,onLoading:function(){Spinner.show();},onComplete:function(){Spinner.hide();}})},goToTask:function(number){if(!number)return;if(number<=0){Flash.showMessage('Invalid task number');return;}
var tasklist=$('tasklist');var taskId=null;if($('issues_list')&&issueList.row(number)){IssuesCursor.setIssueAtCursor(number);IssuesCursor.showCursor($(number.toString()),CursorActivation.MoveTo);var row=$('issue_'+number);new Effect.Highlight(row,{duration:2.0});return}else{taskId=this.taskIdByIssueId(number);}
if(tasklist&&taskId){Cursor.setTaskAtCursor(taskId);Cursor.showCursor($(taskId.toString()),CursorActivation.MoveTo)
var tr=$('task_item_contents_'+taskId);new Effect.Highlight(tr,{duration:2.0});}else{new Ajax.Request('/tasks/goto/'+number,{asynchronous:true,evalScripts:true,onLoading:function(){Spinner.show();},onComplete:function(){Spinner.hide();}})}},currentUserId:function(){return parseInt($('current_user_id').innerHTML);},showSlider:function(name,controller,sliderUrlParams){var hide_url='/'+controller+'/hide_'+name
var slider=$(name+'_slider')
var slider_icon=$(name+'_slider_icon')
if(slider.className.match('slider_open')){slider.className='slider_closed'
slider_icon.className='slider_icon sprite-right_arrow'
if(window.ie)
new Element.toggle($(name+'_contents'))
else
new Effect.SlideUp($(name+'_contents'),{duration:0.5})
new Ajax.Request(hide_url,{asynchronous:true,evalScripts:true,parameters:{slider:true}})}else if(slider.className.match('slider_closed')||slider.className.match('slider_loading')){taskList.loadSlider(name,controller,sliderUrlParams)}},loadSlider:function(name,controller,sliderUrlParams){var load_url='/'+controller+'/'+name+'/'+'?'+sliderUrlParams
var slider_icon=$(name+'_slider_icon')
slider_icon.className='slider_loading'
new Ajax.Request(load_url,{asynchronous:true,evalScripts:true,parameters:{slider:true}})},filter:function(filters){params=filters;if(taskList.getProjectId())
params.project_id=taskList.getProjectId();Spinner.show('filtering...');new Ajax.Request('/tasks/rjs_list?'+taskList.urlParams(),{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(request){Spinner.hide();}});if('tag_filter'in filters){new Ajax.Updater('taglist_contents','/tags/select?'+taskList.urlParams(),{asynchronous:true,evalScripts:true,parameters:{id:filters.tag_filter}});}else if('team_filter'in filters){new Ajax.Updater('teams_progress_contents','/teams/select?'+taskList.urlParams(),{asynchronous:true,evalScripts:true,parameters:{id:filters.team_filter}});}},unsetFilters:function(){taskList.filter({unset_filters:true});if(Element.visible('taglist_contents')){new Ajax.Updater('taglist_contents','/tags/select?'+taskList.urlParams(),{asynchronous:true,evalScripts:true,parameters:{id:0}});}
if(Element.visible('teams_progress_contents')){new Ajax.Updater('teams_progress_contents','/teams/select?'+taskList.urlParams(),{asynchronous:true,evalScripts:true,parameters:{id:0}});}},setFeedbackFilter:function(mode,filterName){var filterValue=$(filterName).value;var filterBase=filterName.replace('_filter','');Spinner.show("filtering...");params={}
params[filterName]=filterValue;params['mode']=mode;new Ajax.Updater(filterBase+'_dashboard','/dashboard/rerender_feedback/',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(){Spinner.hide()}});},goToSprintList:function(){document.location=$('parent_sprints_breadcrumb_link').readAttribute('href');}});Object.extend(taskList,{rows:[],overRow:null,dragRange:8,dragLeftX:0,dragRightX:0,selectedTasksOnDrag:null,taskIds:[],tasksCount:0,sprintId:0,table:null,indicator:null,getElementRect:function(elem){var box=elem.getBoundingClientRect();var body=document.body;var docElem=document.documentElement;var scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop;var scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft;var top=box.top+scrollTop;var bottom=box.bottom+scrollTop;var left=box.left+scrollLeft;var right=box.right+scrollLeft;return{top:top,left:left,right:right,bottom:bottom};},initDragDrop:function(tasksCount,sprintId){this.tasksCount=tasksCount;if(this.tasksCount>150)Element.show('initializing');this.sprintId=sprintId;if(taskList.isMultiSprint()){return;}
this.rows=[];Draggables.drags=[];this.overRow=null;this.table=$('tasklist');var tablePos=this.getElementRect(this.table);this.dragLeftX=tablePos.left;this.dragRightX=tablePos.right;this.indicator=$('indicator');this.indicator.style.width=(tablePos.right-tablePos.left)+'px';this.indicator.style.left=tablePos.left+'px';taskList.initDragDropCycle();var menuProxy=function(event){var element=Event.element(event);element.wasProxied=true;Event.stop(event);}
Event.observe($('itemmenu'),'mousedown',menuProxy);if(this.tasksCount>150)Element.hide('initializing');},initDragDropCycle:function(){var rows=this.table.tBodies[0].rows;for(var i=0;i<rows.length;i++){var row=$(rows[i]);if(row.id!='new_form_row'){row.task_id=parseInt(row.id.match(/_([^_]*)$/)[1]);this.newDrag(row,this.sprintId);this.newDrop(row,this.sprintId);}}},reinitDragDrop:function(){this.initDragDrop(this.tasksCount,this.sprintId);},dragId:function(taskId){return'drag_'+taskId;},addEventProxy:function(element){var observers={mousedown:function(event){var element=Event.element(event);element.wasDragged=false;},click:function(event){var element=Event.element(event);if(element.wasDragged){Event.stop(event);}}}
Event.observe(element,'mousedown',observers.mousedown);Event.observe(element,'click',observers.click);},newDrag:function(row,sprint_id){if(!row||row.task_id==0)return;if(typeof row.task_id=='undefined'){throw'taskList drad\'n\'drop newDrag: row.task_id is undefined';}
var drag_elems=[row.cells[2].firstChild,row.cells[3].firstChild];for(var i=0;i<drag_elems.length;i++){var drag_elem=drag_elems[i];this.addEventProxy(drag_elem);drag_elem.ondragstart=function(){return false}
drag_elem.task_id=row.task_id;new Draggable(drag_elem,{revert:function(element){return!element.success;},ghosting:true,scroll:window,scrollSensitivity:20,scrollSpeed:20,reverteffect:function(){},endeffect:function(element){element.style.top='auto';element.style.left='auto';element.style.position='static';},onStart:function(drag,event){taskList.selectedTasksOnDrag=taskList.selectedTasks();drag.element.success=false;newTask.closeForm();taskMenu.hide();taskList.highlightDrag(drag,row);var position=taskList.getElementRect(drag.element);drag.element._initialPosition=[position.left,position.top];drag.element._offset=[event.offsetX,event.offsetY];if(typeof event.offsetX=='undefined'&&typeof event.offsetY=='undefined'){drag.element._offset=[event.layerX,event.layerY];}
drag.element._offset=drag.element._offset.map(function(o){return Math.abs(o);});if(window.opera){drag.element.parentNode.style.overflow='visible';}},onDrag:function(drag,event){taskList.highlightDropPlace(event,drag);if(!drag.element.wasDragged){var position=[Event.pointerX(event),Event.pointerY(event)];if(Math.abs(drag.element._initialPosition[0]-position[0])>taskList.dragRange||Math.abs(drag.element._initialPosition[1]-position[1])>taskList.dragRange){drag.element.wasDragged=true;}}},onEnd:function(drag,event){if(taskList.overRow!=null){var tasksToDrop=taskList.isSelected(row.task_id)?taskList.selectedTasksOnDrag:[drag.element.task_id];drag.element.success=taskActions.dropHere(taskList.overRow,tasksToDrop,sprint_id);}
taskList.clearDropPlace();taskList.clearDragHighlight(drag,row);taskList.selectedTasksOnDrag=null;if(window.opera){drag.element.parentNode.style.overflow='hidden';}}});};},newDrop:function(row,sprint_id,options){if(!row)return;options=options||{newRow:false};if(typeof row.task_id=='undefined'){throw'taskList drad\'n\'drop newDrop: row.task_id is undefined';}
var data={}
data.task_id=row.task_id;var rowPosition=this.getElementRect(row);data.y1=rowPosition.top;data.y2=rowPosition.bottom;this.rows.push(data);return data;},insertDragDrop:function(task_id,sprint_id){var row=taskList.row(task_id);row.task_id=parseInt(row.id.match(/_([^_]*)$/)[1]);this.newDrag(row,sprint_id);var new_row=this.newDrop(row,sprint_id,{newRow:true});this.updateDropPositions(new_row,{newRow:true});},highlightDrag:function(drag,row){drag.element.addClassName('is_dragging');var row_dm=this.getElementRect(row);drag.element.style.width=(row_dm.right-row_dm.left)+'px';drag.element.style.height=(row_dm.bottom-row_dm.top)+'px';drag.highlightedRows=[];var selectedTasks=taskList.selectedTasksOnDrag;if(taskList.isSelected(drag.element.task_id)){for(var i=0;i<selectedTasks.length;i++){this.highlightRow(selectedTasks[i],drag);}}else{this.highlightRow(drag.element.task_id,drag);}
for(var i=0;i<drag.highlightedRows.length;i++){var children=taskList.findChildren(drag.highlightedRows[i].task_id);for(var j=0;j<children.length;j++){this.highlightRow(children[j],drag);}}},clearDragHighlight:function(drag){drag.element.removeClassName('is_dragging');for(var i=0;i<drag.highlightedRows.length;i++){drag.highlightedRows[i].removeClassName('dragged');}
drag.highlightedRows=[];},highlightRow:function(task_id,drag){var row=taskList.row(task_id);if(!row.hasClassName('dragged')){row.addClassName('dragged');drag.highlightedRows.push(row);}},updateDropPositions:function(task_row,options){options=Object.extend({newRow:false,removedRow:false},options||{});var shift=null;if(options.newRow){shift=task_row.y2-task_row.y1;for(var i=0;i<this.rows.length;i++){var row=this.rows[i];if(row.y1>=task_row.y1&&row.task_id!=task_row.task_id){row.y1=row.y1+shift;row.y2=row.y2+shift;}}}else{if(!options.removedRow){for(var i=0;i<this.rows.length;i++){var row=this.rows[i];if(task_row.task_id==row.task_id){shift=task_row.y2-row.y2;break;}}
for(var i=0;i<this.rows.length;i++){var row=this.rows[i];if(task_row.task_id==row.task_id){row.y2=row.y2+shift;}
if(row.y1>task_row.y1){row.y1=row.y1+shift;row.y2=row.y2+shift;}}}else{for(var i=0;i<this.rows.length;i++){var row=this.rows[i];if(task_row.task_id==row.task_id){task_row.y1=row.y1;task_row.y2=row.y2;this.rows[i]=null;}
if(row.y1>task_row.y1){var shift=task_row.y1-task_row.y2;row.y1+=shift;row.y2+=shift;}}
this.rows=this.rows.compact();}}},updateRowHeight:function(task_id){var row=taskList.row(task_id);var position=this.getElementRect(row);var task_row={task_id:task_id,y1:position.top,y2:position.bottom};this.updateDropPositions(task_row);},highlightDropPlace:function(event,drag){if(!event)return;var y=Event.pointerY(event),x=Event.pointerX(event);if(x<this.dragLeftX||x>this.dragRightX){this.clearDropPlace();return;}
var checkbox=taskList.getCheckBox(drag.element.parentNode.parentNode);var isSelected=checkbox.checked;var tasksToDrop=isSelected?taskList.selectedTasksOnDrag:[drag.element.task_id];for(var i=0;i<this.rows.length;i++){if(y>=this.rows[i].y1&&y<=this.rows[i].y2){var row=this.rows[i];break;}}
this.clearDropPlace();if((row&&(row.task_id!=drag.element.task_id))&&taskActions.canMoveHere(row.task_id,tasksToDrop,{dropNotSelected:!isSelected})){this.showDropPlace(row.task_id,row.y1);}},showDropPlace:function(task_id,y){if(this.overRow&&this.overRow!=task_id){this.clearDropPlace();}
this.overRow=task_id;this.indicator.style.display='block';this.indicator.style.top=(y-2)+'px';},clearDropPlace:function(){this.indicator.style.display='none';this.overRow=null;},debugDiv:null,debugDroppables:function(){if(this.debugDiv){this.debugDiv.innerHTML='';}else{elem=document.createElement('div');elem.id='debug';document.body.appendChild(elem);this.debugDiv=elem;}
for(var i=0;i<this.rows.length;i++){var row=this.rows[i];elem=document.createElement('div');elem.style.position='absolute';elem.style.width='100%';elem.style.height='1px';elem.style.borderTop='1px solid red';elem.style.top=row.y1+'px';this.debugDiv.appendChild(elem);}}});var diffView={currentEditor:0,currentTip:0,currentIndex:0,focusField:null,save:function(){this.updateTask(this.currentEditor);},cancel:function(){this.hideEditor(this.currentEditor);},highlight:function(index){$('diff_'+index).className='diff_selected';},fadeout:function(index){if(this.currentEditor!=index){$('diff_'+index).className='diff';}},showEditor:function(index){this.hideTip(this.currentTip);Flash.hide();if(!$('diff_editor_'+index)){this.attachEditor(index);}
if(this.currentEditor>0){this.hideEditor(this.currentEditor);}
this.highlight(index);Element.show('diff_editor_'+index);this.focusField='diff_editor_textarea_'+index;Field.focus(this.focusField);var bottomY=windowHelper.findPos($('diff_bubbles_'+index))[1]
+Element.getHeight('diff_editor_'+index)
+Element.getHeight('diff_bubbles_'+index);windowHelper.scroll(bottomY,{ensureVisible:true});this.currentEditor=index;DialogManager.registerDialog(this);},hideEditor:function(index){DialogManager.unregisterDialog(this);Element.hide('diff_editor_'+index);this.currentEditor=0;this.focusField=null;this.fadeout(index);},attachEditor:function(index){var editor=$('diff_editor_0').cloneNode(true);editor.setAttribute('id','diff_editor_'+index);var form=editor.getElementsByTagName('form').item(0);form.setAttribute('id','diff_form_'+index);var inputs=form.getElementsByTagName('input');for(var i=0;i<inputs.length;i++){var element=inputs.item(i);if(element.getAttribute('name')=='diff_index'){element.value=index;}}
var selects=form.getElementsByTagName('select');for(var i=0;i<selects.length;i++){var element=selects.item(i);if(element.id=='project_selector_for_')
element.setAttribute('id','project_selector_for_'+index);}
form.getElementsByTagName('span').item(0).setAttribute('id','sprint_selector_for_'+index);form.getElementsByTagName('span').item(1).setAttribute('id','user_selector_for_'+index);form.getElementsByTagName('img').item(0).setAttribute('id','project_selector_for_'+index+'_spinner');form.getElementsByTagName('textarea').item(0).setAttribute('id','diff_editor_textarea_'+index);$('diff_bubbles_'+index).appendChild(editor);var spinner=$('diff_spinner_0').cloneNode(true);spinner.setAttribute('id','diff_spinner_'+index);$('diff_bubbles_'+index).appendChild(spinner);},detachEditor:function(index){$('diff_bubbles_'+index).innerHTML='';var bubbles=document.createElement('div');bubbles.className='active_area';bubbles.onclick=function(){showEditor(index);};$('diff_bubbles_'+index).appendChild(bubbles);},showTip:function(index){if($('note_tip_'+index)){this.hideTip(this.currentTip);Element.show('note_tip_'+index);this.currentTip=index;}},hideTip:function(index){if($('note_tip_'+index)){Element.hide('note_tip_'+index);this.currentTip=0;}},deleteTask:function(index){Flash.hide();if((this.currentEditor==0)&&confirm('Are you sure you wand to delete this task?')){this.currentIndex=index;var form=$('diff_form_'+index);var params=Form.serialize(form,true);new Ajax.Request(code_inspection_delete_url,{asynchronous:true,evalScripts:true,parameters:params,onLoading:diffView.showSpinner(index),onComplete:function(r){if(r.responseText=='true'){diffView.detachEditor(index);Flash.showMessage('Code inspection task has been deleted');}else{Flash.showMessage('Unable to delete task');}}});}},updateTask:function(index){this.hideEditor(index);var comment=$('diff_editor_'+index).getElementsByTagName('textarea').item(0).value;if(comment==''){Flash.showMessage('Please enter task description');}else{this.currentIndex=index;var form=$('diff_form_'+index);var params=Form.serialize(form,true);new Ajax.Request(code_inspection_update_url,{asynchronous:true,evalScripts:true,parameters:params,onLoading:diffView.showSpinner(index),onComplete:function(r){var index=diffView.currentIndex;diffView.currentIndex=0;diffView.hideSpinner(index);if(r.responseText.match(/diff_editor_/)){if($('note_tip_'+index)){Flash.showMessage('Code inspection task has been updated');}else{Flash.showMessage('New code inspection task has been created');}
$('diff_bubbles_'+index).innerHTML=r.responseText;}else if(r.responseText=='false'){Flash.showMessage('Unable to update code inspection');}}});}},outBubble:function(e,index){var eX=Event.pointerX(e);var eY=Event.pointerY(e);var bubble=$('status_bubble_'+index);var bX=bubble.offsetLeft;var bW=bubble.offsetWidth;if(eX<(bX+bW)-(bW/3)){this.hideTip(index);}},outTip:function(e,index){var eX=Event.pointerX(e);var eY=Event.pointerY(e);var tip=$('note_tip_'+index);var tX=tip.offsetLeft;var tY=tip.offsetTop;var tW=tip.offsetWidth;var tH=tip.offsetHeight;if(eX<=tX||eX>=tX+tW||eY<=tY||eY>=tY+tH){this.hideTip(index);}},blinkAnchor:function(){var anchor=String(window.location);var pos=anchor.indexOf('#');if(pos==-1||pos==(anchor.length-1))return false;var index=anchor.substring(pos+2);var tr=$('diff_'+index);if(!tr)return false;new Effect.Highlight(tr,{startcolor:'#ffff00',duration:4.0,restorecolor:''});return false},showSpinner:function(index){var spinner=$('diff_spinner_'+index);var bubble=$('status_bubble_'+index);if(bubble)Element.hide(bubble);if(spinner)Element.show(spinner);},hideSpinner:function(index){var spinner=$('diff_spinner_'+index);var bubble=$('status_bubble_'+index);if(spinner)Element.hide(spinner);if(bubble)Element.show(bubble);},toggleNumbers:function(){var tbl=$('diffs');if(!tbl)return false;var rows=tbl.tBodies[0].rows;var length=rows.length;if(length==0)return false;if(length>500){$('status_info').innerHTML='Please wait...';Element.show('status_info');}
var cell=rows[0].cells[1];if(cell.className=='number'){this.removeNumbers(rows,length);var text='Show Line Numbers';$('number_link_1').innerHTML=text;$('number_link_2').innerHTML=text;}else{this.addNumbers(rows,length);var text='Hide Line Numbers';$('number_link_1').innerHTML=text;$('number_link_2').innerHTML=text;}
if(length>500)Element.hide('status_info');},addNumbers:function(rows,length){for(var i=0;i<length;i++){var cell=rows[i].cells[1];var td=document.createElement('td');td.className='number';td.innerHTML=(i+1)+' ';rows[i].insertBefore(td,cell);}},removeNumbers:function(rows,length){for(var i=0;i<length;i++){var cell=rows[i].cells[1];if(cell.className=='number')rows[i].removeChild(cell);}}}
var Direction={Back:0,Forward:1}
var InsertLocation={Before:0,After:1}
var InsertType={Sibling:0,Child:1}
var FindType={First:0,Last:1,LastRecursive:2}
var CursorActivation={None:0,MoveTo:1}
var DeleteMode={Confirm:0,DoNotConfirm:1}
var windowHelper={innerSize:function(){var myWidth=0,myHeight=0;if(typeof(window.innerWidth)=='number'){myWidth=window.innerWidth;myHeight=window.innerHeight;}else if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){myWidth=document.documentElement.clientWidth;myHeight=document.documentElement.clientHeight;}else if(document.body&&(document.body.clientWidth||document.body.clientHeight)){myWidth=document.body.clientWidth;myHeight=document.body.clientHeight;}
return[myWidth,myHeight]},scrollOffsets:function(){var scrOfX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0
var scrOfY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;return[scrOfX,scrOfY];},scrollOffsetY:function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;},findPos:function(obj){var curleft=curtop=0;while(obj){curleft+=obj.offsetLeft;curtop+=obj.offsetTop;obj=obj.offsetParent;}
return[curleft,curtop];},scroll:function(y,options){options=options||{};var offset=windowHelper.scrollOffsets()[1];var innerHeight=windowHelper.innerSize()[1];var scrollUp=options.scrollUp||10;var scrollDown=options.scrollDown||10;if((y<offset)||(y>offset+innerHeight)){if(options.center){var scrollOffset=(y<offset)?-innerHeight/2:+innerHeight/2;window.scrollTo(0,y-scrollOffset);}else if(options.ensureVisible){var scrollOffset=y-offset-innerHeight;if(scrollOffset>0)
window.scrollBy(0,scrollOffset);}else{var scrollOffset=(y<offset)?-scrollUp:scrollDown;window.scrollTo(0,offset+scrollOffset);}}}}
var SizeListener={initial:null,ruler:null,initialize:function(ruler,callback,delay){if(!ruler||!callback)return;this.ruler=ruler;this.callback=callback;this.delay=delay||1500;if(!this.initial){this.initial=this.getMeasure();}
window.setInterval((function(){if(!this.paused){this.check();}}).bind(this),this.delay);},getMeasure:function(){return this.ruler.offsetWidth||0;},check:function(){var current=this.getMeasure();if(this.initial&&current!=this.initial){this.paused=true;this.callback(this.initial,current);this.initial=current;this.paused=false;}}}
var GenericCursor={cachedElements:null,elementsHash:{},clearCache:function(){this.cachedElements=null;this.elementsHash={};},getElementFromCacheById:function(id){this.elements();return this.elementsHash[id+''];},elements:function(){if(this.cachedElements)return this.cachedElements;if(window.ie){this.cachedElements=$$('div.cursor_image');}else{this.cachedElements=$('tasklist').getElementsByClassName('cursor_image');}
for(var i=0;i<this.cachedElements.length;i++){this.elementsHash[this.cachedElements[i].id]=this.cachedElements[i];}
return this.cachedElements;},setCursorCookie:function(element,value){var id=this.cursorKey();if(!id)return;value=value||element.id
var cookie=readCookie(this.cursorName())||'',cookies=cookie.split(' '),hash=$H();for(var i=0;i<cookies.length;i++){var pair=cookies[i].split('=');if(pair.length==2){hash.set(pair[0],pair[1])}}
hash.set(id,value);var serialized='';hash.each(function(pair){serialized+=pair[0]+'='+pair[1]+' ';})
createCookie(this.cursorName(),serialized);},hideCursor:function(element){if(typeof element=='string'||typeof element=='number'){element=$(this.getElementFromCacheById(element));}
if(!element)return;if(element.hasClassName('cursor_image_shown')){element.current=false;element.removeClassName('cursor_image_shown');return true;}else{return false;}},moveCursorUp:function(step){this.moveCursor(Direction.Back,step)},moveCursorDown:function(step){this.moveCursor(Direction.Forward,step)},moveCursor:function(direction,step){step=step||1;var elements=this.elements();var noNextElement=false
for(var i=0;i<elements.length;i++){var element=elements[i]
if(element.current==true){this.hideCursor(element)
var next=direction==Direction.Forward?elements[i+step]:(i-step<0)?null:elements[i-step]
if(next){this.showCursor(next)
return}else{noNextElement=true
break}}}
if(noNextElement)
this.placeCursor(elements,direction)
else
this.placeCursor(elements,direction==Direction.Back?Direction.Forward:Direction.Back)},moveCursorToTheEnd:function(direction){var elements=this.elements();var place=direction==Direction.Forward?elements.length-1:0
for(var i=0;i<elements.length;i++){var element=elements[i]
if((element.current==true)&&(elements[place])){this.hideCursor(element);this.showCursor(elements[place]);}}},placeCursor:function(elements,direction){var place=direction==Direction.Forward?elements.length-1:0
if(elements[place]){this.showCursor(elements[place])}},showCursor:function(element,move){if(typeof element=='string'||typeof element=='number'){element=$(this.getElementFromCacheById(element));}
if(!element)return;if(move==null)move=CursorActivation.MoveTo;element.current=true;element.addClassName('cursor_image_shown');if(move==CursorActivation.MoveTo){var offset=windowHelper.scrollOffsetY();var innerHeight=windowHelper.innerSize()[1];var cursorPos=this.findPos(element);if((cursorPos<(offset+60))||(cursorPos>(offset+innerHeight-60))){window.scrollTo(0,cursorPos-(innerHeight/2));}}
this.setCursorCookie(element);},idAtCursor:function(){var elements=this.elements();var id=null;for(var i=0;i<elements.length;i++){element=elements[i];if(element.current==true){id=element.id;}}
return id;}}
var Cursor={init:function(){var cookie=readCookie(this.cursorName())||'';var current=this.taskAtCursor();if(current){this.hideCursor($(current.toString()));}
if(cookie.length>0){var sprintId=taskList.getSprintId();if(sprintId){var parsed=cookie.match(new RegExp('(^|\\s)'+sprintId+'=([0-9]*)'))
if(parsed&&taskList.row(parsed[2])){this.setTaskAtCursor(parsed[2]);return;}}}
this.moveCursorDown();},cursorName:function(){return'cursor';},cursorKey:function(){return taskList.isMultiSprint()?null:taskList.getSprintId();},findPos:function(element){var id=element.id,rows=taskList.rows;if(rows.length===0){return windowHelper.findPos(element)[1];}else if(rows.length>0){for(var i=0;i<rows.length;i++){if(rows[i].task_id.toString()==id){return rows[i].y1;}}}
return 0;},taskAtCursor:function(){return this.idAtCursor();},setTaskAtCursor:function(taskId){var current=this.taskAtCursor()
if(current)
this.hideCursor($(current.toString()))
this.showCursor($(taskId.toString()),CursorActivation.None)},selectCurrentRow:function(){var task=this.taskAtCursor()
if(task){taskList.toggle(taskList.row(task));}},moveCursorToSafetyPlace:function(){var selectedTasks=taskList.selectedTasks();var tasksToDelete=selectedTasks.clone();for(var i=0;i<selectedTasks.length;i++){var children=taskList.findChildren(selectedTasks[i]);for(var j=0;j<children.length;j++){if(selectedTasks.indexOf(children[j])==-1){tasksToDelete.push(children[j]);}}}
var currentTask=this.taskAtCursor();if(tasksToDelete.indexOf(currentTask)<0)return;var elements=this.elements()
var noNextElement=false
var element=null;for(var i=0;i<elements.length;i++){element=elements[i];if(element.current==true){break;}}
var next=elements[i+1];while(next&&(tasksToDelete.indexOf(next.id)>=0)){i++;next=elements[i+1];}
if(next){this.setCursorCookie(next);}else{this.setCursorCookie(elements[elements,length-1]);}}}
Object.extend(Cursor,GenericCursor);var taskEditors={view:function(){if($('view')){return $('view').innerHTML;}
return'task_list';},showDisplayElement:function(displayElement){$(displayElement).removeClassName('hidden');},hideDisplayElement:function(displayElement){$(displayElement).addClassName('hidden');},showEditor:function(field,id,value){if(field=='status'&&taskList.isParent(id))return;var displayName='task_'+field+'_link_'+id;var editorName='task_'+field+'_editor_'+id;if(typeof(value)=='undefined')
value=taskList.getField(field,id);var editor=taskEditors.showDynamicEditor(displayName,editorName,field,value,'task_')
editor.task_id=id;},showDynamicEditor:function(displayElementId,editorElementId,field,value,prefix){prefix=prefix||'';var displayElement=$(displayElementId);var editorHeight=displayElement.offsetHeight;this.hideDisplayElement(displayElement);var editor=$(prefix+'dynamic_'+field+'_editor');var editContainer=$(editorElementId);editContainer.appendChild(editor);if(/^(owner_id|owner|qa_owner_id|business_owner_id)$/.test(field)&&(value==null)){var container=editContainer.parentNode;var username=container.getElementsByTagName("a")[0].innerHTML;var ownerId=displayElement.className.match(/owner_id_(\d+)/)[1]
var option=document.createElement("option");option.appendChild(document.createTextNode(username));option.setAttribute("value",ownerId);editor.insertBefore(option,editor.options[0]);value=0;}
if(/^(priority|severity)$/.test(field)&&value!=='-'){if(parseInt(value)>editor.options.length-1||value==null){var container=editContainer.parentNode;var value=container.getElementsByTagName("a")[0].innerHTML;var id=value.match(/(\d+)$/)[1];var option=document.createElement("option");option.appendChild(document.createTextNode(value));option.setAttribute("value",id);editor.insertBefore(option,editor.options[0]);value=0;}}
var func=editor.onchange;editor.onchange=function(){}
if(value!=null){switch(editor.tagName){case'SELECT':editor.selectedIndex=value;editor.old_value=editor.value;break;case'TEXTAREA':editor.value=value;editor.old_value=editor.value;break;case'INPUT':if(editor.getAttribute('type')=='text'){if((field=='due_date')&&(value==''))
editor.setValue('yyyy-mm-dd');else
editor.setValue(value);editor.old_value=value;}
break;}}
editor.onchange=func;if(editor.tagName=='TEXTAREA'){editor.style.height=(editorHeight>60)?editorHeight+5+'px':'';}
if(window.ie){editContainer.parentNode.style.zIndex=10;}
Element.show(editContainer);Field.focus(editor);if(field=='estimate'||field=='remaining')
editor.select();observersManager.save();return editor;},resetDynamicEditors:function(task_id){var container=$('dynamic_vault');dynamic_editor_ids=['task_dynamic_owner_id_editor','task_dynamic_description_editor','task_dynamic_estimate_editor','task_dynamic_remaining_editor','task_dynamic_status_editor','task_dynamic_resolution_editor','task_dynamic_priority_editor','task_dynamic_severity_editor'];dynamic_editor_ids.each(function(id){var editor=$(id);if(!task_id||editor.task_id==task_id){var containerId=editor.parentNode.id;if(containerId.match(/_editor_/)){var linkId=containerId.replace('editor','link');$(linkId).removeClassName('hidden');}
container.appendChild(editor);}});container.appendChild($('itemmenu'))
var connectionEditor=$('task_dynamic_conn_status_editor');if(connectionEditor){container.appendChild(connectionEditor)}},resetDynamicEditor:function(editor_id,task_id){var editor=$('task_dynamic_'+editor_id+'_editor');if(!task_id||editor.task_id==task_id){$('dynamic_vault').appendChild(editor);}},escObserver:function(event,elem){if(Event.isEscPressed(event)){Event.stop(event);elem.value=elem.old_value;elem.blur();}},keyDownObserver:function(event,elem){switch(event.keyCode){case Event.KEY_ESC:Event.stop(event);elem.value=elem.old_value;elem.blur();break;case Event.KEY_RETURN:Event.stop(event);elem.blur();break;}
if(elem.tagName=='SELECT')elem.lastKeydownAt=new Date().getTime();},onChangeObserver:function(event,elem){if(elem.lastKeydownAt&&new Date().getTime()-elem.lastKeydownAt<=10){return;}
elem.blur();},submitElement:function(elem,field,id){var value=elem.value;this.hideEditor(field,id,'task_');if(value==elem.old_value)return;var unsatisfiedDeps=false;var changingStatusOfVerifiedTask=false;var closedStatuses=$('closed_statuses').innerHTML.strip().split(',');if(field=='status'&&closedStatuses.indexOf(value)>=0&&closedStatuses.indexOf(elem.old_value)==-1&&$('unsatisfied_deps_for_'+id)&&$('unsatisfied_deps_for_'+id).innerHTML=='true')
unsatisfiedDeps=true;if(field=='status'&&taskList.getField('resolution',id)=='Verified')
changingStatusOfVerifiedTask=true;if((unsatisfiedDeps&&!confirm("This task has unsatisfied dependencies.\nDo you still want to close it?"))||(changingStatusOfVerifiedTask&&!confirm("You are changing the status of verified task.\nIf you continue, the task will be unverified."))){this.updateDisplayElement('task_'+field+'_link_'+id,elem.old_value);return;}
Cursor.hideCursor(id);var spinner=taskActions.showTaskSpinner(id);parameters={'field':field,'old_value':elem.old_value}
parameters['value_'+field+"_"+id]=value;if(taskEditors.view()=='task_details'){parameters["view"]='task_details'}
if(pageProperties.projectId)
parameters["project_id"]=pageProperties.projectId;if((/^(description|estimate|remaining)$/).test(field)){this.hideEditor(field,id,'task_');}
this.resetDynamicEditor(field);new Ajax.Request('/tasks/set_field?task='+id+'&field='+field+'&'+taskList.urlParams(),{asynchronous:true,evalScripts:true,parameters:parameters,onComplete:function(){observersManager.restore()}});},hideEditor:function(field,id,prefix){if($('task_'+field+'_link_'+id)){this.hideEditorElement(field,'task_'+field+'_link_'+id,'task_'+field+'_editor_'+id,prefix)}
observersManager.restore();},hideEditorElement:function(field,displayElementName,editorElementName,prefix){prefix=prefix||'';Element.hide(editorElementName);if(window.ie){$(displayElementName).parentNode.style.zIndex=0;}
this.showDisplayElement(displayElementName);if((/^(owner_id|owner|qa_owner_id|business_owner_id|status|resolution|priority|severity)$/).test(field)){var edit=$(prefix+'dynamic_'+field+'_editor');var sel=(edit.selectedIndex<0)?0:edit.selectedIndex;if(edit.options[sel].value!=edit.old_value){this.updateDisplayElement(displayElementName,edit.options[sel].text);}
if(!(/^(status|resolution)$/).test(field)){if(edit.options[0].value!='-2'&&edit.options[0].value!=''){edit.remove(0);edit.selectedIndex=0;}}}
if((/^(description|estimate|remaining)$/).test(field)){var edit=$(prefix+'dynamic_'+field+'_editor');if(edit.getValue()!=edit.old_value){if(field=='description'){this.updateTextareaDisplayElement(displayElementName,edit.getValue());}else{this.updateDisplayElement(displayElementName,edit.getValue());}}}},updateDisplayElement:function(displayElementName,new_pick){var display=$(displayElementName).firstChild;display.className="fullsize plain nodecor "+new_pick.replace(/ /g,'_').replace(/'/g,'').toLowerCase();display.firstChild.data=new_pick;},updateTextareaDisplayElement:function(displayElementName,new_pick){var displayElements=$(displayElementName).firstChild.select('span');displayElements[displayElements.length-2].innerHTML=new_pick.escapeHTML().replace(/\n/g,"<br/>");},selectedStatus:function(taskId){var taskStatusElement=$('task_status_link_'+taskId)
if(!taskStatusElement)return 0;var taskStatus=taskStatusElement.firstChild.innerHTML;for(var i=0;i<this.statusList.length;i++){if(this.statusList[i]==taskStatus)return i;}
return 0;},selectedOwner:function(taskId){var taskOwner=$('task_owner_id_link_'+taskId).firstChild.innerHTML;var options=$('task_dynamic_owner_id_editor').options;for(var i=0;i<options.length;i++){if(options[i].text==taskOwner)return i;}
return null;},selectedEditorValue:function(taskId,field){var link=$('task_'+field+'_link_'+taskId)
if(!link)return null;var value=link.firstChild.innerHTML;if(value==='-')return value;var options=$('task_dynamic_'+field+'_editor').options;for(var i=0;i<options.length;i++){if(options[i].text==value)return i;}
return null;},selectedPriority:function(taskId){return this.selectedEditorValue(taskId,'priority');},selectedSeverity:function(taskId){return this.selectedEditorValue(taskId,'severity');},selectedResolution:function(taskId){return this.selectedEditorValue(taskId,'resolution');},submitThreadConnStatus:function(elem,field,id){if(elem.value==elem.old_value){this.hideEditor(field,id,'task_')
return}else{elem.blur();}
new Ajax.Request('/gmail/set_status',{asynchronous:true,evalScripts:true,parameters:{conn_id:elem.task_id,status:elem.value,view:'details'},onLoading:function(){Spinner.show();},onComplete:function(){Spinner.hide();observersManager.restore()}});}}
var taskActions={descriptionLinkClick:function(event){if(event.stopPropagation){event.stopPropagation();}else{event.cancelBubble=true;}},levelFilterPopup:function(event){var menu=$('levelmenu');var left=$('level_move_left'),right=$('level_move_right');if(left&&right){left.addClassName('disabled');right.addClassName('disabled');var selectedTasks=taskList.selectedTasks();if(selectedTasks.length>0){var task=selectedTasks[0];if(this.canMoveLeft(task)){left.removeClassName('disabled');}
if(this.canMoveRight(task)){right.removeClassName('disabled');}}}
menu.toggle();Event.stop(event);},canMoveHere:function(task_id,tasks,options){options=options||{}
if(taskList.isPlaceholder(task_id))
return true
var moveHereClass='disabled'
var itselfSelected=options.dropNotSelected?task_id==tasks[0]:$('checkbox_'+task_id).checked
var ownParents=taskList.findParents(task_id)
var parentMovesToItsChild=false
var selectionHasParent=false
var singleTaskMovesToItsLocation=tasks.length==1&&tasks[0]==taskList.findItem(task_id,Direction.Back)
for(var i=0;i<tasks.length;i++){if(ownParents.indexOf(tasks[i]*1)!=-1)
parentMovesToItsChild=true}
var targetIsToplevel=!!taskList.getParentId(task_id)
return!itselfSelected&&(tasks.length>0)&&!parentMovesToItsChild&&(targetIsToplevel||!selectionHasParent)&&!singleTaskMovesToItsLocation},canMoveLeft:function(taskId){return(taskList.getLevel(taskId)>0)},canMoveRight:function(taskId){return taskList.getLevel(taskId)<newTask.allowedNestingLevel-1&&taskList.findSibling(taskId,Direction.Back)},toggleTaskCheckbox:function(task_id,e){if(taskList.isPlaceholder(task_id))
return;var row=Event.findElement(e,'tr');if(row){var checkbox=Event.element(e);taskList.toggle(row,(checkbox.name=='selected')?checkbox:false);}
if(e&&e.shiftKey){taskList.multipleSelect(task_id,e);}
taskList.lastRowClicked=task_id;},findPreviousTaskForMoveRight:function(task_id){var prev_id=taskList.findSibling(task_id,Direction.Back)
if(taskList.isSelected(task_id)){var initial_prev_id=prev_id
while(prev_id&&taskList.isSelected(prev_id)){prev_id=taskList.findSibling(prev_id,Direction.Back)}
if(!prev_id)prev_id=initial_prev_id}
return prev_id},moveTask:function(direction,task_id,options){options=options||{}
if(taskList.isPlaceholder(task_id))
return
if(!(direction=='left'?this.canMoveLeft(task_id):this.canMoveRight(task_id)))
return
var hadCursor=Cursor.hideCursor(task_id);var spinner=this.showTaskSpinner(task_id)
newTask.closeForm()
var prev_id=null
if(direction=='right'){prev_id=this.findPreviousTaskForMoveRight(task_id)
var estimate=taskList.getField('estimate',prev_id)
var hasEstimate=estimate!='-'
if(!taskList.isParent(prev_id)&&hasEstimate){var remaining=taskList.getField('remaining',prev_id)
var hasRemaining=remaining!=' '
var description=smartTruncate(taskList.getDescription(prev_id))
var ownEstimate=taskList.getField('estimate',task_id)
var parsedEstimate=parseFloat(estimate)
if(isNaN(parsedEstimate))
parsedEstimate=0
var parsedOwnEstimate=parseFloat(ownEstimate)
if(isNaN(parsedOwnEstimate))
parsedOwnEstimate=0
var unplanned=parsedEstimate-parsedOwnEstimate
var confirmationText='Task "'+description+'" is about to become parent task and be split.'
if(hasRemaining&&(remaining!=estimate))
confirmationText+='\nAlready completed work from split task will '+'be added automatically as a subtask.'
if(unplanned>0)
confirmationText+='\nUpon splitting, the total work of subtasks will become less than '+'the estimated work of task before splitting. This difference is considered as '+'unplanned work and you will be prompted to save it as another subtask.'
confirmationText+='\nProceed with splitting?'
var proceed=confirm(confirmationText)
if(!proceed){Element.remove(spinner)
if(hadCursor)
Cursor.showCursor(task_id);return}}}
new Ajax.Request('/tasks/move_'+direction+'/'+task_id,{asynchronous:true,evalScripts:true,parameters:{update:'true',sprint:taskList.getSprintId(),project_id:taskList.getProjectId(),level:taskList.getLevel(task_id),previous_or_parent:direction=='left'?taskList.getParentId(task_id):prev_id,selected:taskList.selectedTasks().toString(),single:options.single},onComplete:function(request){Element.remove(spinner)
if(hadCursor){Cursor.showCursor(task_id);}}})},moveSelectedTasks:function(direction,mode){var selectedTasks=taskList.selectedTasks(),task=selectedTasks[0];var canMove=(direction=='left')?taskActions.canMoveLeft(task):taskActions.canMoveRight(task);if(selectedTasks.length>0){if(canMove){this.moveTask(direction,task);}else{if(mode=='shortcut'){Flash.showMessage("Can\'t move selected tasks");}}}else{if(mode=='shortcut'){Flash.showMessage('No tasks selected');}}},showTaskSpinner:function(task_id){var loading=null;var loadingContainer=$$('tr#task_item_contents_'+task_id+' td.cursor')[0];if(loadingContainer&&$('loading_owner')){var loading=$('loading_owner').cloneNode(true);loading.setAttribute('id','task_spinner_'+task_id);loadingContainer.appendChild(loading);Element.show(loading);}
return loading},hideTaskSpinner:function(task_id){var spinner=$('task_spinner_'+task_id);if(spinner)Element.remove(spinner);},moveHere:function(task_id,tasks,sprint_id,options){options=options||{}
if(!this.canMoveHere(task_id,tasks,options))
return false
Cursor.hideCursor(task_id);this.showTaskSpinner(task_id)
var url='/tasks/move_selected_here/'+task_id+'?sprint='+sprint_id
var previousTask=taskList.findItem(task_id,Direction.Back)
var parentTask=taskList.findParent(task_id)
var parameters={tasks:tasks.toString(),project_id:taskList.getProjectId(),selected:taskList.selectedTasks().toString(),previous:(parentTask!=previousTask)?previousTask:null}
if(options.set_cursor)
parameters.set_cursor=0
newTask.closeForm()
new Ajax.Request(url,{parameters:parameters,asynchronous:true,evalScripts:true})
return true},dropHere:function(drop_to_id,tasks,sprint_id){return this.moveHere(drop_to_id,tasks,sprint_id,{dropNotSelected:(tasks.length==1&&!taskList.isSelected(tasks[0]))})},createTaskHere:function(task_id){if(newTask&&Element.visible(newTask.new_task_form))
newTask.closeForm();if(taskList.isPlaceholder(task_id))
newTask.insertAtBottom()
else
newTask.insertSiblingAt(task_id,InsertLocation.Before)},createTaskBelowHere:function(task_id){if(newTask&&Element.visible(newTask.new_task_form))
newTask.closeForm();if(taskList.isPlaceholder(task_id))
newTask.insertAtBottom();else
if((taskList.isParent(task_id))&&(newTask.canInsertChild(task_id)))
newTask.insertChildAt(task_id);else
newTask.insertSiblingAt(task_id,InsertLocation.After)},showTaskDetails:function(task_id){if(taskList.isPlaceholder(task_id))
return
document.location.href='/projects/'+taskList.getProjectIdForTask(task_id)+'/tasks/'+taskList.getIssueNumber(task_id);},prepareAnalyzeTasksLink:function(task_id){if(taskList.isPlaceholder(task_id))
return;var selection=taskList.selectedTasks();var location='';if(!task_id&&(selection.length==0)){Flash.showMessage('No tasks have been selected.');return;}
if((!task_id)||((selection.length>0)&&(selection.include(task_id)))){var issues=[];for(var i=0;i<selection.length;i++){issues.push(taskList.getIssueNumber(selection[i]));}
location='/projects/'+taskList.getProjectIdForTask(task_id)+'/analytics/ad-hoc?issues='+issues.join(',');}else{location='/projects/'+taskList.getProjectIdForTask(task_id)+'/analytics/ad-hoc?issues='+taskList.getIssueNumber(task_id);}
return location;},analyzeTask:function(options){options=options||{};var issue_number=options.issue_number;if(!issue_number){var task_id=options.task_id||Cursor.taskAtCursor();if(!task_id||taskList.isPlaceholder(task_id))return;issue_number=taskList.getIssueNumber(task_id);if(!issue_number)return;}
var url='/analytics/ad-hoc?issues='+issue_number
if(pageProperties.projectId)url='/projects/'+pageProperties.projectId+url;location.href=url;},analyzeSelectedTasks:function(){var selection=taskList.selectedTasks();if(selection.length==0){Flash.showMessage('No tasks have been selected.');return;}
var issues=[];for(var i=0;i<selection.length;i++){issues.push(taskList.getIssueNumber(selection[i]));}
location.href='/projects/'+pageProperties.projectId+'/analytics/ad-hoc?issues='+issues.join(',');},analyzeSprints:function(){this.analyticsArchivedCheckbox=this.analyticsArchivedCheckbox||$('show_archived_sprints');var sprintSelector=this.analyticsArchivedCheckbox.checked?$('all_sprints_to_analyze'):$('unarchived_sprints_to_analyze'),sprints=[];for(var i=0;i<sprintSelector.options.length;i++){if(sprintSelector[i].selected)
sprints.push(sprintSelector[i].value);}
if(sprints.length==0){Flash.showMessage("No sprints have been selected.");return;}
if(sprints.length>0){var projectId='';var urlParams={};if(this.analyticsArchivedCheckbox.checked){urlParams.show_archived_sprints=true;}
if($('custom_dates_multisprint').checked){urlParams.start_date=$('start_date_multisprint').value;urlParams.end_date=$('end_date_multisprint').value;}
urlParams.sprints=sprints.join(',');if(pageProperties.projectId)
projectId=pageProperties.projectId;if(projectId!=''){location.href='/projects/'+projectId+'/analytics/ad-hoc?'+$H(urlParams).toQueryString();}else{location.href='/analytics/ad-hoc?'+$H(urlParams).toQueryString();}}},analyzeTaskNumbers:function(){var urlParams={};var projectId='';urlParams.issues=$('issues').value;if($('custom_dates_selected').checked){urlParams.start_date=$('start_date_selected').value;urlParams.end_date=$('end_date_selected').value;}
if(pageProperties.projectId)
projectId=pageProperties.projectId;if(projectId!=''){location.href='/projects/'+projectId+'/analytics/ad-hoc?'+$H(urlParams).toQueryString();}else{location.href='/analytics/ad-hoc?'+$H(urlParams).toQueryString();}},analyzeQuery:function(){var urlParams={};var projectId='';urlParams.query=$('query').value;if($('custom_dates_query').checked){urlParams.start_date=$('start_date_query').value;urlParams.end_date=$('end_date_query').value;}
if($('include_subtasks').checked){urlParams.include_subtasks=true;}
if(pageProperties.projectId)
projectId=pageProperties.projectId;if(projectId!=''){location.href='/projects/'+projectId+'/analytics/ad-hoc?'+$H(urlParams).toQueryString();}else{location.href='/analytics/ad-hoc?'+$H(urlParams).toQueryString();}},showUploadForm:function(task_id){if(taskList.isPlaceholder(task_id))
return;if(pageProperties.projectId){location.href='/projects/'+pageProperties.projectId+'/attachments/new?issue='+taskList.getIssueNumber(task_id);}else{location.href='/attachments/new?issue='+taskList.getIssueNumber(task_id);}},toolBoxAction:function(name,parameters,options){options=options||{};var parametersObject=object(parameters||{})
parametersObject.sprint=taskList.getSprintId()
if(!parametersObject.target_sprint)
parametersObject.target_sprint=$('sprint_selector').value
parametersObject.toolbox_action=name
parametersObject.selected=taskList.selectedTasks().toString()
parametersObject.project_id=taskList.getProjectId()
newTask.closeForm()
var message='processing...'
if(name=='Copy Selected'){message='copying tasks...';}else if(name=='Move Selected'){message='moving tasks...';Cursor.moveCursorToSafetyPlace();}else if(name=='Apply Tag'){message='applying tag...';}else if(name=='Remove Tag'){message='removing tag...'}
if(parametersObject.selected==""&&name!='Go to Selected'){Flash.showMessage('No tasks selected');return;}
new Ajax.Request('/tasks/task_toolbox_action',{asynchronous:true,evalScripts:true,parameters:$H(parametersObject),onLoading:function(r){if(options.onLoading){options.onLoading(r);}else{Spinner.show(message);}},onComplete:function(r){if(options.onComplete){options.onComplete(r);}else{Spinner.hide();}}})},moreAction:function(){var list=$('more_actions');list.blur();newTask.closeForm()
var action=list.options[list.options.selectedIndex].value;if(action=='')return false;if(action=='order_by_user'){if(!confirm('This will permanently change the order of tasks in the sprint.\nDo you want to continue?')){list.selectedIndex=0;return false;}
var sprint_id=$('sprint_id').innerHTML;Spinner.show();new Ajax.Request('/tasks/order_by_user?sprint='+sprint_id,{asynchronous:true,evalScripts:true,parameters:{project_id:taskList.getProjectId()},onComplete:function(request){Spinner.hide();$('more_actions').selectedIndex=0;}})}
if(action=='finish'){this.finishSprint();}
if(action=='analyze'){this.analyzeSprint();}
if(action=='export'||action=='taskpad'){this.exportToCsv(action);}
if(action=='import'){var sprint_id=taskList.getSprintId();var project_id=taskList.getProjectId();location.href='/projects/'+project_id+'/sprints/'+sprint_id+'/import';$('more_actions').selectedIndex=0;}
if(action=='new_tag'){if(window.Tags)Tags.newTag();}
var matches=null;if(matches=action.match(/^apply_tag_(.*)$/)){this.toolBoxAction('Apply Tag',{tag_id:matches[1]});$('more_actions').selectedIndex=0;}
if(matches=action.match(/^remove_tag_(.*)$/)){if(matches[1]=="0")return false;this.toolBoxAction('Remove Tag',{tag_id:matches[1]});$('more_actions').selectedIndex=0}
return false;},deleteTasks:function(mode,options){options=options||{};if(taskList.isPlaceholder(options.popped_task_id))return false;var action=(mode==DeleteMode.Confirm)?'/tasks/confirm_destroy':'/tasks/destroy'
newTask.closeForm()
var onloading=function(r){Spinner.show('calculating the number of tasks to delete...')};var oncomplete=function(r){Spinner.hide()};if(mode==DeleteMode.DoNotConfirm){Cursor.moveCursorToSafetyPlace();onloading=function(r){Spinner.show('deleting tasks...')};}
var params={sprint:taskList.getSprintId(),project_id:taskList.getProjectId()}
var selectedTasks=taskList.selectedTasks();if(options['popped_task_id']&&selectedTasks.indexOf(options['popped_task_id'].toString())==-1){params.selected=options['popped_task_id'];params.preserve_selection=selectedTasks.toString();}else{params.selected=selectedTasks.toString();}
new Ajax.Request(action,{parameters:params,asynchronous:true,evalScripts:true,onLoading:onloading,onComplete:oncomplete})},showCommentForm:function(mode,task_id){if(taskList.isPlaceholder(task_id))return false;if(task_id){newTask.closeForm();CommentDialog.show(mode,{taskId:task_id});}else{CommentDialog.show(mode);}},showDueDateForm:function(task_id,view){if(taskList.isPlaceholder(task_id))return false;if(view=='task_list')
newTask.closeForm();DueDateDialog.show(task_id,view);},setCommentNotificationValue:function(val){if(!val)return false;var sel=$$('#comment_form select')[0];for(var i=0;i<sel.options.length;i++){if(sel.options[i].value==val)sel.selectedIndex=i;}},renderSingleTask:function(task_id){new Ajax.Request('/tasks/render_single_task/'+task_id+'?'+taskList.urlParams(),{asynchronous:true,evalScripts:true,parameters:{project_id:taskList.getProjectId()}})},getTaskTagIds:function(task_id){var tags_container=$('task_tags_'+task_id);if(!tags_container)return[];var tagIds=tags_container.getAttribute('tags');if(!tagIds)return[];return tagIds.split(',');},selectedTags:function(){var selectedTasks=taskList.selectedTasks();var selectedTags=[];for(var i=0;i<selectedTasks.length;i++){var ids=this.getTaskTagIds(selectedTasks[i]);for(var j=0;j<ids.length;j++){if(ids[j]!=''&&!selectedTags.include(ids[j])){selectedTags[selectedTags.length]=ids[j];}}}
return selectedTags;},updateMoreActionsListbox:function(){var selectedTags=this.selectedTags();var elem=$('more_actions');var options=elem.options;if($('remove_tag_group'))
$('remove_tag_group').remove();if(selectedTags.length>0){var optgroup=document.createElement("optgroup");optgroup.setAttribute('id','remove_tag_group');optgroup.label="Remove Tag";for(i=0;i<selectedTags.length;i++){var new_option=document.createElement('option');new_option.appendChild(document.createTextNode(tags[selectedTags[i]]));new_option.value='remove_tag_'+selectedTags[i];new_option.className='tag';optgroup.appendChild(new_option);}
elem.appendChild(optgroup);}},toggleAnalyticsForm:function(){var form=$('analytics_form');if(form.style.display=='none'){$('analytics_form_toggle_arrow').className='sprite-down_arrow';Element.show(form);}else{$('analytics_form_toggle_arrow').className='sprite-right_arrow';Element.hide(form);}},toggleAnalyticsFormSection:function(element){var sectionName=element.value;var ids=['analytics_query_form','analytics_multisprint_form','analytics_selected_form'];for(var i=0;i<ids.length;i++){this.disableFormSection(ids[i]);}
this.enableFormSection('analytics_'+sectionName+'_form');},toggleAnalyticsDateRangeForm:function(form){Element.toggle("date-selector-"+form);},disableFormSection:function(id){var section=$(id);section.className='disabled';var tagnames=['input','select'];for(var i=0;i<tagnames.length;i++){var inputs=section.getElementsByTagName(tagnames[i]);for(var j=0;j<inputs.length;j++){inputs[j].disabled=true;}}},enableFormSection:function(id){var section=$(id);section.className='';var tagnames=['input','select'];for(var i=0;i<tagnames.length;i++){var inputs=section.getElementsByTagName(tagnames[i]);for(var j=0;j<inputs.length;j++){inputs[j].disabled=false;}}},toggleAnalyticsSprintsSelector:function(){this.analyticsArchivedCheckbox=this.analyticsArchivedCheckbox||$('show_archived_sprints');this.unarchivedSelector=this.unarchivedSelector||$('unarchived_sprints_to_analyze');this.allSelector=this.allSelector||$('all_sprints_to_analyze');if(this.analyticsArchivedCheckbox.checked){this.unarchivedSelector.addClassName('hidden');this.allSelector.removeClassName('hidden');}else{this.unarchivedSelector.removeClassName('hidden');this.allSelector.addClassName('hidden');}},addDependency:function(taskId,issueNumber){if(taskId==0)return;var issueId=null;if(taskId&&!issueId){issueId=taskList.getIssueId(taskId);issueNumber=taskList.getIssueNumber(taskId);}else{issueId=issueList.getIssueIdByNumber(issueNumber);}
var number=prompt('Make task '+issueNumber+' dependent on:\n(enter task number)','');if(!number)return;number=parseInt(number);if(!number||number<=0){Flash.showMessage('Invalid task number');return}
params={change:'add',type:'depends_on',related_issue:number};if(taskId){params.task_id=taskId;params.view='tasklist';}
if(!taskId){params.view='issuelist';}
new Ajax.Request('/issues/change_relationship/'+issueId,{asynchronous:true,evalScripts:true,parameters:params,onLoading:function(){Spinner.show()},onComplete:function(){Spinner.hide()}});},linkChangeset:function(issueNumber){var revision=prompt('Link this task to changeset with revision:','');if(!revision)return;new Ajax.Request('/changesets/link',{asynchronous:true,evalScripts:true,parameters:{issue:issueNumber,revision:revision},onLoading:function(){Spinner.show()},onComplete:function(){Spinner.hide()}});},exportToCsv:function(action){var sprint_id=taskList.getSprintId();var project_id=taskList.getProjectId();var selection='';var selectedTasks=taskList.selectedTasks();if(selectedTasks.length>0)selection='&selected='+selectedTasks.toString();location.href='/projects/'+project_id+'/sprints/'+sprint_id+'/'+action+'?use_filters=true'+selection;$('more_actions').selectedIndex=0;},finishSprint:function(){var sprint_id=taskList.getSprintId();var project_id=taskList.getProjectId();location.href='/projects/'+project_id+'/sprints/'+sprint_id+'/finish';$('more_actions').selectedIndex=0;},analyzeSprint:function(){var sprint_id=taskList.getSprintId();var project_id=taskList.getProjectId();location.href='/projects/'+project_id+'/sprints/'+sprint_id+'/analyze';$('more_actions').selectedIndex=0;}}
var Menu=Class.create();Menu.prototype={initialize:function(menu,callback,context){this.menu=menu;this.callback=callback||this.callback;context=context||$('tasklist');this.items={};var items=this.menu.getElementsByTagName('li');if(items.length===0){return;}
for(var i=0,length=items.length;i<length;i++){var item=$(items[i]).down();var match=item.id.match(/popup_(\S+)/)
if(match&&match[1]){this.items[match[1]]=item;}}
Event.observe(context.parentNode,'click',this.clickProxy.bindAsEventListener(this));Event.observe(document,'click',this.documentObserver.bindAsEventListener(this));},callback:function(td){throw('Callback should be overriden in your menu instance')},hide:function(){fastClassNames.fastRemoveClassName(this.menu,'itemmenu_shown');},show:function(){fastClassNames.fastAddClassName(this.menu,'itemmenu_shown');},toggle:function(){if(fastClassNames.fastHasClassName(this.menu,'itemmenu_shown')){this.hide();}else{this.show();}},popup:function(td){this.callback(td);if(this.menu.parentNode!=td){td.appendChild(this.menu);}
this.toggle();},clickProxy:function(event){var element=Event.element(event),td=false;if(element.tagName=='TD'){td=element;}else{td=$(Event.findElement(event,'td'));}
if(td==document){return;}
if(td&&td.hasClassName('popup')){var ul=element;while(ul.tagName!='UL'&&ul!=td){ul=ul.parentNode;}
if(ul!=td&&ul.hasClassName('itemmenu')){this.hide();return;}
this.popup(td);Event.stop(event);}},documentObserver:function(event){this.hide();}};var menuCallbacks={taskMenu:function(td){var id=taskList.getId(td.parentNode);taskActions.popped_task_id=id;if(!taskList.isMultiSprint()){$H(this.items).each(function(pair){var item=pair[1];if(taskList.isPlaceholder(id)&&pair[0]!='new_task'){item.className='disabled';}else{item.className='enabled';if(pair[0]=='analyze'){item.setAttribute('href',taskActions.prepareAnalyzeTasksLink(id));}
if(pair[0]=='move_left'){item.className=taskActions.canMoveLeft(id)?'':'disabled';}
if(pair[0]=='move_right'){item.className=taskActions.canMoveRight(id)?'':'disabled';}}
if(pair[0]=='move_here'){item.className=taskActions.canMoveHere(id,taskList.selectedTasks())?'':'disabled';}})}
return id;},issueMenu:function(td){var id=issueList.getId(td.parentNode);issueActions.popped_id=id;if(this.items.analyze){this.items.analyze.setAttribute('href',issueActions.prepareAnalyzeTasksLink(id));}
return id;}}
Calendar=function(firstDayOfWeek,dateStr,onSelected,onClose){this.activeDiv=null;this.currentDateEl=null;this.getDateStatus=null;this.getDateToolTip=null;this.getDateText=null;this.timeout=null;this.onSelected=onSelected||null;this.onClose=onClose||null;this.dragging=false;this.hidden=false;this.minYear=1970;this.maxYear=2050;this.dateFormat=Calendar._TT["DEF_DATE_FORMAT"];this.ttDateFormat=Calendar._TT["TT_DATE_FORMAT"];this.isPopup=true;this.weekNumbers=true;this.firstDayOfWeek=typeof firstDayOfWeek=="number"?firstDayOfWeek:Calendar._FD;this.showsOtherMonths=false;this.dateStr=dateStr;this.ar_days=null;this.showsTime=false;this.time24=true;this.yearStep=2;this.hiliteToday=true;this.multiple=null;this.table=null;this.element=null;this.tbody=null;this.firstdayname=null;this.monthsCombo=null;this.yearsCombo=null;this.hilitedMonth=null;this.activeMonth=null;this.hilitedYear=null;this.activeYear=null;this.dateClicked=false;if(typeof Calendar._SDN=="undefined"){if(typeof Calendar._SDN_len=="undefined")
Calendar._SDN_len=3;var ar=new Array();for(var i=8;i>0;){ar[--i]=Calendar._DN[i].substr(0,Calendar._SDN_len);}
Calendar._SDN=ar;if(typeof Calendar._SMN_len=="undefined")
Calendar._SMN_len=3;ar=new Array();for(var i=12;i>0;){ar[--i]=Calendar._MN[i].substr(0,Calendar._SMN_len);}
Calendar._SMN=ar;}};Calendar._C=null;Calendar.is_ie=(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent));Calendar.is_ie5=(Calendar.is_ie&&/msie 5\.0/i.test(navigator.userAgent));Calendar.is_opera=/opera/i.test(navigator.userAgent);Calendar.is_khtml=/Konqueror|Safari|KHTML/i.test(navigator.userAgent);Calendar.getAbsolutePos=function(el){var SL=0,ST=0;var is_div=/^div$/i.test(el.tagName);if(is_div&&el.scrollLeft)
SL=el.scrollLeft;if(is_div&&el.scrollTop)
ST=el.scrollTop;var r={x:el.offsetLeft-SL,y:el.offsetTop-ST};if(el.offsetParent){var tmp=this.getAbsolutePos(el.offsetParent);r.x+=tmp.x;r.y+=tmp.y;}
return r;};Calendar.isRelated=function(el,evt){var related=evt.relatedTarget;if(!related){var type=evt.type;if(type=="mouseover"){related=evt.fromElement;}else if(type=="mouseout"){related=evt.toElement;}}
while(related){if(related==el){return true;}
related=related.parentNode;}
return false;};Calendar.removeClass=function(el,className){if(!(el&&el.className)){return;}
var cls=el.className.split(" ");var ar=new Array();for(var i=cls.length;i>0;){if(cls[--i]!=className){ar[ar.length]=cls[i];}}
el.className=ar.join(" ");};Calendar.addClass=function(el,className){Calendar.removeClass(el,className);el.className+=" "+className;};Calendar.getElement=function(ev){var f=Calendar.is_ie?window.event.srcElement:ev.currentTarget;while(f.nodeType!=1||/^div$/i.test(f.tagName))
f=f.parentNode;return f;};Calendar.getTargetElement=function(ev){var f=Calendar.is_ie?window.event.srcElement:ev.target;while(f.nodeType!=1)
f=f.parentNode;return f;};Calendar.stopEvent=function(ev){ev||(ev=window.event);if(Calendar.is_ie){ev.cancelBubble=true;ev.returnValue=false;}else{ev.preventDefault();ev.stopPropagation();}
return false;};Calendar.addEvent=function(el,evname,func){if(el.attachEvent){el.attachEvent("on"+evname,func);}else if(el.addEventListener){el.addEventListener(evname,func,true);}else{el["on"+evname]=func;}};Calendar.removeEvent=function(el,evname,func){if(el.detachEvent){el.detachEvent("on"+evname,func);}else if(el.removeEventListener){el.removeEventListener(evname,func,true);}else{el["on"+evname]=null;}};Calendar.createElement=function(type,parent){var el=null;if(document.createElementNS){el=document.createElementNS("http://www.w3.org/1999/xhtml",type);}else{el=document.createElement(type);}
if(typeof parent!="undefined"){parent.appendChild(el);}
return el;};Calendar._add_evs=function(el){with(Calendar){addEvent(el,"mouseover",dayMouseOver);addEvent(el,"mousedown",dayMouseDown);addEvent(el,"mouseout",dayMouseOut);if(is_ie){addEvent(el,"dblclick",dayMouseDblClick);el.setAttribute("unselectable",true);}}};Calendar.findMonth=function(el){if(typeof el.month!="undefined"){return el;}else if(typeof el.parentNode.month!="undefined"){return el.parentNode;}
return null;};Calendar.findYear=function(el){if(typeof el.year!="undefined"){return el;}else if(typeof el.parentNode.year!="undefined"){return el.parentNode;}
return null;};Calendar.showMonthsCombo=function(){var cal=Calendar._C;if(!cal){return false;}
var cal=cal;var cd=cal.activeDiv;var mc=cal.monthsCombo;if(cal.hilitedMonth){Calendar.removeClass(cal.hilitedMonth,"hilite");}
if(cal.activeMonth){Calendar.removeClass(cal.activeMonth,"active");}
var mon=cal.monthsCombo.getElementsByTagName("div")[cal.date.getMonth()];Calendar.addClass(mon,"active");cal.activeMonth=mon;var s=mc.style;s.display="block";if(cd.navtype<0)
s.left=cd.offsetLeft+"px";else{var mcw=mc.offsetWidth;if(typeof mcw=="undefined")
mcw=50;s.left=(cd.offsetLeft+cd.offsetWidth-mcw)+"px";}
s.top=(cd.offsetTop+cd.offsetHeight)+"px";};Calendar.showYearsCombo=function(fwd){var cal=Calendar._C;if(!cal){return false;}
var cal=cal;var cd=cal.activeDiv;var yc=cal.yearsCombo;if(cal.hilitedYear){Calendar.removeClass(cal.hilitedYear,"hilite");}
if(cal.activeYear){Calendar.removeClass(cal.activeYear,"active");}
cal.activeYear=null;var Y=cal.date.getFullYear()+(fwd?1:-1);var yr=yc.firstChild;var show=false;for(var i=12;i>0;--i){if(Y>=cal.minYear&&Y<=cal.maxYear){yr.innerHTML=Y;yr.year=Y;yr.style.display="block";show=true;}else{yr.style.display="none";}
yr=yr.nextSibling;Y+=fwd?cal.yearStep:-cal.yearStep;}
if(show){var s=yc.style;s.display="block";if(cd.navtype<0)
s.left=cd.offsetLeft+"px";else{var ycw=yc.offsetWidth;if(typeof ycw=="undefined")
ycw=50;s.left=(cd.offsetLeft+cd.offsetWidth-ycw)+"px";}
s.top=(cd.offsetTop+cd.offsetHeight)+"px";}};Calendar.tableMouseUp=function(ev){var cal=Calendar._C;if(!cal){return false;}
if(cal.timeout){clearTimeout(cal.timeout);}
var el=cal.activeDiv;if(!el){return false;}
var target=Calendar.getTargetElement(ev);ev||(ev=window.event);Calendar.removeClass(el,"active");if(target==el||target.parentNode==el){Calendar.cellClick(el,ev);}
var mon=Calendar.findMonth(target);var date=null;if(mon){date=new Date(cal.date);if(mon.month!=date.getMonth()){date.setMonth(mon.month);cal.setDate(date);cal.dateClicked=false;}}else{var year=Calendar.findYear(target);if(year){date=new Date(cal.date);if(year.year!=date.getFullYear()){date.setFullYear(year.year);cal.setDate(date);cal.dateClicked=false;}}}
with(Calendar){removeEvent(document,"mouseup",tableMouseUp);removeEvent(document,"mouseover",tableMouseOver);removeEvent(document,"mousemove",tableMouseOver);cal._hideCombos();_C=null;return stopEvent(ev);}};Calendar.tableMouseOver=function(ev){var cal=Calendar._C;if(!cal){return;}
var el=cal.activeDiv;var target=Calendar.getTargetElement(ev);if(target==el||target.parentNode==el){Calendar.addClass(el,"hilite active");Calendar.addClass(el.parentNode,"rowhilite");}else{if(typeof el.navtype=="undefined"||(el.navtype!=50&&(el.navtype==0||Math.abs(el.navtype)>2)))
Calendar.removeClass(el,"active");Calendar.removeClass(el,"hilite");Calendar.removeClass(el.parentNode,"rowhilite");}
ev||(ev=window.event);if(el.navtype==50&&target!=el){var pos=Calendar.getAbsolutePos(el);var w=el.offsetWidth;var x=ev.clientX;var dx;var decrease=true;if(x>pos.x+w){dx=x-pos.x-w;decrease=false;}else
dx=pos.x-x;if(dx<0)dx=0;var range=el._range;var current=el._current;var count=Math.floor(dx/10)%range.length;for(var i=range.length;--i>=0;)
if(range[i]==current)
break;while(count-->0)
if(decrease){if(--i<0)
i=range.length-1;}else if(++i>=range.length)
i=0;var newval=range[i];el.innerHTML=newval;cal.onUpdateTime();}
var mon=Calendar.findMonth(target);if(mon){if(mon.month!=cal.date.getMonth()){if(cal.hilitedMonth){Calendar.removeClass(cal.hilitedMonth,"hilite");}
Calendar.addClass(mon,"hilite");cal.hilitedMonth=mon;}else if(cal.hilitedMonth){Calendar.removeClass(cal.hilitedMonth,"hilite");}}else{if(cal.hilitedMonth){Calendar.removeClass(cal.hilitedMonth,"hilite");}
var year=Calendar.findYear(target);if(year){if(year.year!=cal.date.getFullYear()){if(cal.hilitedYear){Calendar.removeClass(cal.hilitedYear,"hilite");}
Calendar.addClass(year,"hilite");cal.hilitedYear=year;}else if(cal.hilitedYear){Calendar.removeClass(cal.hilitedYear,"hilite");}}else if(cal.hilitedYear){Calendar.removeClass(cal.hilitedYear,"hilite");}}
return Calendar.stopEvent(ev);};Calendar.tableMouseDown=function(ev){if(Calendar.getTargetElement(ev)==Calendar.getElement(ev)){return Calendar.stopEvent(ev);}};Calendar.calDragIt=function(ev){var cal=Calendar._C;if(!(cal&&cal.dragging)){return false;}
var posX;var posY;if(Calendar.is_ie){posY=window.event.clientY+document.body.scrollTop;posX=window.event.clientX+document.body.scrollLeft;}else{posX=ev.pageX;posY=ev.pageY;}
cal.hideShowCovered();var st=cal.element.style;st.left=(posX-cal.xOffs)+"px";st.top=(posY-cal.yOffs)+"px";return Calendar.stopEvent(ev);};Calendar.calDragEnd=function(ev){var cal=Calendar._C;if(!cal){return false;}
cal.dragging=false;with(Calendar){removeEvent(document,"mousemove",calDragIt);removeEvent(document,"mouseup",calDragEnd);tableMouseUp(ev);}
cal.hideShowCovered();};Calendar.dayMouseDown=function(ev){var el=Calendar.getElement(ev);if(el.disabled){return false;}
var cal=el.calendar;cal.activeDiv=el;Calendar._C=cal;if(el.navtype!=300)with(Calendar){if(el.navtype==50){el._current=el.innerHTML;addEvent(document,"mousemove",tableMouseOver);}else
addEvent(document,Calendar.is_ie5?"mousemove":"mouseover",tableMouseOver);addClass(el,"hilite active");addEvent(document,"mouseup",tableMouseUp);}else if(cal.isPopup){cal._dragStart(ev);}
if(el.navtype==-1||el.navtype==1){if(cal.timeout)clearTimeout(cal.timeout);cal.timeout=setTimeout("Calendar.showMonthsCombo()",250);}else if(el.navtype==-2||el.navtype==2){if(cal.timeout)clearTimeout(cal.timeout);cal.timeout=setTimeout((el.navtype>0)?"Calendar.showYearsCombo(true)":"Calendar.showYearsCombo(false)",250);}else{cal.timeout=null;}
return Calendar.stopEvent(ev);};Calendar.dayMouseDblClick=function(ev){Calendar.cellClick(Calendar.getElement(ev),ev||window.event);if(Calendar.is_ie){document.selection.empty();}};Calendar.dayMouseOver=function(ev){var el=Calendar.getElement(ev);if(Calendar.isRelated(el,ev)||Calendar._C||el.disabled){return false;}
if(el.ttip){if(el.ttip.substr(0,1)=="_"){el.ttip=el.caldate.print(el.calendar.ttDateFormat)+el.ttip.substr(1);}
el.calendar.tooltips.innerHTML=el.ttip;}
if(el.navtype!=300){Calendar.addClass(el,"hilite");if(el.caldate){Calendar.addClass(el.parentNode,"rowhilite");var cal=el.calendar;if(cal&&cal.getDateToolTip){var d=el.caldate;window.status=d;el.title=cal.getDateToolTip(d,d.getFullYear(),d.getMonth(),d.getDate());}}}
return Calendar.stopEvent(ev);};Calendar.dayMouseOut=function(ev){with(Calendar){var el=getElement(ev);if(isRelated(el,ev)||_C||el.disabled)
return false;removeClass(el,"hilite");if(el.caldate)
removeClass(el.parentNode,"rowhilite");if(el.calendar)
el.calendar.tooltips.innerHTML=_TT["SEL_DATE"];}};Calendar.cellClick=function(el,ev){var cal=el.calendar;var closing=false;var newdate=false;var date=null;if(typeof el.navtype=="undefined"){if(cal.currentDateEl){Calendar.removeClass(cal.currentDateEl,"selected");Calendar.addClass(el,"selected");closing=(cal.currentDateEl==el);if(!closing){cal.currentDateEl=el;}}
cal.date.setDateOnly(el.caldate);date=cal.date;var other_month=!(cal.dateClicked=!el.otherMonth);if(!other_month&&!cal.currentDateEl&&cal.multiple)
cal._toggleMultipleDate(new Date(date));else
newdate=!el.disabled;if(other_month)
cal._init(cal.firstDayOfWeek,date);}else{if(el.navtype==200){Calendar.removeClass(el,"hilite");cal.callCloseHandler();return;}
date=new Date(cal.date);if(el.navtype==0)
date.setDateOnly(new Date());cal.dateClicked=false;var year=date.getFullYear();var mon=date.getMonth();function setMonth(m){var day=date.getDate();var max=date.getMonthDays(m);if(day>max){date.setDate(max);}
date.setMonth(m);};switch(el.navtype){case 400:Calendar.removeClass(el,"hilite");var text=Calendar._TT["ABOUT"];if(typeof text!="undefined"){text+=cal.showsTime?Calendar._TT["ABOUT_TIME"]:"";}else{text="Help and about box text is not translated into this language.\n"+"If you know this language and you feel generous please update\n"+"the corresponding file in \"lang\" subdir to match calendar-en.js\n"+"and send it back to <mihai_bazon@yahoo.com> to get it into the distribution  ;-)\n\n"+"Thank you!\n"+"http://dynarch.com/mishoo/calendar.epl\n";}
alert(text);return;case-2:if(year>cal.minYear){date.setFullYear(year-1);}
break;case-1:if(mon>0){setMonth(mon-1);}else if(year-->cal.minYear){date.setFullYear(year);setMonth(11);}
break;case 1:if(mon<11){setMonth(mon+1);}else if(year<cal.maxYear){date.setFullYear(year+1);setMonth(0);}
break;case 2:if(year<cal.maxYear){date.setFullYear(year+1);}
break;case 100:cal.setFirstDayOfWeek(el.fdow);return;case 50:var range=el._range;var current=el.innerHTML;for(var i=range.length;--i>=0;)
if(range[i]==current)
break;if(ev&&ev.shiftKey){if(--i<0)
i=range.length-1;}else if(++i>=range.length)
i=0;var newval=range[i];el.innerHTML=newval;cal.onUpdateTime();return;case 0:if((typeof cal.getDateStatus=="function")&&cal.getDateStatus(date,date.getFullYear(),date.getMonth(),date.getDate())){return false;}
break;}
if(!date.equalsTo(cal.date)){cal.setDate(date);newdate=true;}else if(el.navtype==0)
newdate=closing=true;return false;}
if(newdate){ev&&cal.callHandler();}
if(closing){Calendar.removeClass(el,"hilite");ev&&cal.callCloseHandler();}};Calendar.prototype.create=function(_par){var parent=null;if(!_par){parent=document.getElementsByTagName("body")[0];this.isPopup=true;}else{parent=_par;this.isPopup=false;}
this.date=this.dateStr?new Date(this.dateStr):new Date();var table=Calendar.createElement("table");this.table=table;table.cellSpacing=0;table.cellPadding=0;table.calendar=this;Calendar.addEvent(table,"mousedown",Calendar.tableMouseDown);var div=Calendar.createElement("div");this.element=div;div.className="calendar";if(this.isPopup){div.style.position="absolute";div.style.display="none";}
div.appendChild(table);var thead=Calendar.createElement("thead",table);var cell=null;var row=null;var cal=this;var hh=function(text,cs,navtype){cell=Calendar.createElement("td",row);cell.colSpan=cs;cell.className="button";if(navtype!=0&&Math.abs(navtype)<=2)
cell.className+=" nav";Calendar._add_evs(cell);cell.calendar=cal;cell.navtype=navtype;cell.innerHTML="<div unselectable='on'>"+text+"</div>";return cell;};row=Calendar.createElement("tr",thead);row.className="titlerow"
var title_length=6;(this.isPopup)&&--title_length;(this.weekNumbers)&&++title_length;hh("?",1,400).ttip=Calendar._TT["INFO"];this.title=hh("",title_length,300);this.title.className="title";if(this.isPopup){this.title.ttip=Calendar._TT["DRAG_TO_MOVE"];this.title.style.cursor="move";hh("&#x00d7;",1,200).ttip=Calendar._TT["CLOSE"];}
row=Calendar.createElement("tr",thead);row.className="headrow";this._nav_py=hh("&#x00ab;",1,-2);this._nav_py.ttip=Calendar._TT["PREV_YEAR"];this._nav_pm=hh("&#x2039;",1,-1);this._nav_pm.ttip=Calendar._TT["PREV_MONTH"];this._nav_now=hh(Calendar._TT["TODAY"],this.weekNumbers?4:3,0);this._nav_now.ttip=Calendar._TT["GO_TODAY"];this._nav_nm=hh("&#x203a;",1,1);this._nav_nm.ttip=Calendar._TT["NEXT_MONTH"];this._nav_ny=hh("&#x00bb;",1,2);this._nav_ny.ttip=Calendar._TT["NEXT_YEAR"];row=Calendar.createElement("tr",thead);row.className="daynames";if(this.weekNumbers){cell=Calendar.createElement("td",row);cell.className="name wn";cell.innerHTML=Calendar._TT["WK"];}
for(var i=7;i>0;--i){cell=Calendar.createElement("td",row);if(!i){cell.navtype=100;cell.calendar=this;Calendar._add_evs(cell);}}
this.firstdayname=(this.weekNumbers)?row.firstChild.nextSibling:row.firstChild;this._displayWeekdays();var tbody=Calendar.createElement("tbody",table);this.tbody=tbody;for(i=6;i>0;--i){row=Calendar.createElement("tr",tbody);if(this.weekNumbers){cell=Calendar.createElement("td",row);}
for(var j=7;j>0;--j){cell=Calendar.createElement("td",row);cell.calendar=this;Calendar._add_evs(cell);}}
if(this.showsTime){row=Calendar.createElement("tr",tbody);row.className="time";cell=Calendar.createElement("td",row);cell.className="time";cell.colSpan=2;cell.innerHTML=Calendar._TT["TIME"]||"&nbsp;";cell=Calendar.createElement("td",row);cell.className="time";cell.colSpan=this.weekNumbers?4:3;(function(){function makeTimePart(className,init,range_start,range_end){var part=Calendar.createElement("span",cell);part.className=className;part.innerHTML=init;part.calendar=cal;part.ttip=Calendar._TT["TIME_PART"];part.navtype=50;part._range=[];if(typeof range_start!="number")
part._range=range_start;else{for(var i=range_start;i<=range_end;++i){var txt;if(i<10&&range_end>=10)txt='0'+i;else txt=''+i;part._range[part._range.length]=txt;}}
Calendar._add_evs(part);return part;};var hrs=cal.date.getHours();var mins=cal.date.getMinutes();var t12=!cal.time24;var pm=(hrs>12);if(t12&&pm)hrs-=12;var H=makeTimePart("hour",hrs,t12?1:0,t12?12:23);var span=Calendar.createElement("span",cell);span.innerHTML=":";span.className="colon";var M=makeTimePart("minute",mins,0,59);var AP=null;cell=Calendar.createElement("td",row);cell.className="time";cell.colSpan=2;if(t12)
AP=makeTimePart("ampm",pm?"pm":"am",["am","pm"]);else
cell.innerHTML="&nbsp;";cal.onSetTime=function(){var pm,hrs=this.date.getHours(),mins=this.date.getMinutes();if(t12){pm=(hrs>=12);if(pm)hrs-=12;if(hrs==0)hrs=12;AP.innerHTML=pm?"pm":"am";}
H.innerHTML=(hrs<10)?("0"+hrs):hrs;M.innerHTML=(mins<10)?("0"+mins):mins;};cal.onUpdateTime=function(){var date=this.date;var h=parseInt(H.innerHTML,10);if(t12){if(/pm/i.test(AP.innerHTML)&&h<12)
h+=12;else if(/am/i.test(AP.innerHTML)&&h==12)
h=0;}
var d=date.getDate();var m=date.getMonth();var y=date.getFullYear();date.setHours(h);date.setMinutes(parseInt(M.innerHTML,10));date.setFullYear(y);date.setMonth(m);date.setDate(d);this.dateClicked=false;this.callHandler();};})();}else{this.onSetTime=this.onUpdateTime=function(){};}
var tfoot=Calendar.createElement("tfoot",table);row=Calendar.createElement("tr",tfoot);row.className="footrow";cell=hh(Calendar._TT["SEL_DATE"],this.weekNumbers?8:7,300);cell.className="ttip";if(this.isPopup){cell.ttip=Calendar._TT["DRAG_TO_MOVE"];cell.style.cursor="move";}
this.tooltips=cell;div=Calendar.createElement("div",this.element);this.monthsCombo=div;div.className="combo";for(i=0;i<Calendar._MN.length;++i){var mn=Calendar.createElement("div");mn.className=Calendar.is_ie?"label-IEfix":"label";mn.month=i;mn.innerHTML=Calendar._SMN[i];div.appendChild(mn);}
div=Calendar.createElement("div",this.element);this.yearsCombo=div;div.className="combo";for(i=12;i>0;--i){var yr=Calendar.createElement("div");yr.className=Calendar.is_ie?"label-IEfix":"label";div.appendChild(yr);}
this._init(this.firstDayOfWeek,this.date);parent.appendChild(this.element);};Calendar._keyEvent=function(ev){var cal=window._dynarch_popupCalendar;if(!cal||cal.multiple)
return false;(Calendar.is_ie)&&(ev=window.event);var act=(Calendar.is_ie||ev.type=="keypress"),K=ev.keyCode;if(ev.ctrlKey){switch(K){case 37:act&&Calendar.cellClick(cal._nav_pm);break;case 38:act&&Calendar.cellClick(cal._nav_py);break;case 39:act&&Calendar.cellClick(cal._nav_nm);break;case 40:act&&Calendar.cellClick(cal._nav_ny);break;default:return false;}}else switch(K){case 32:Calendar.cellClick(cal._nav_now);break;case 27:act&&cal.callCloseHandler();break;case 37:case 38:case 39:case 40:if(act){var prev,x,y,ne,el,step;prev=K==37||K==38;step=(K==37||K==39)?1:7;function setVars(){el=cal.currentDateEl;var p=el.pos;x=p&15;y=p>>4;ne=cal.ar_days[y][x];};setVars();function prevMonth(){var date=new Date(cal.date);date.setDate(date.getDate()-step);cal.setDate(date);};function nextMonth(){var date=new Date(cal.date);date.setDate(date.getDate()+step);cal.setDate(date);};while(1){switch(K){case 37:if(--x>=0)
ne=cal.ar_days[y][x];else{x=6;K=38;continue;}
break;case 38:if(--y>=0)
ne=cal.ar_days[y][x];else{prevMonth();setVars();}
break;case 39:if(++x<7)
ne=cal.ar_days[y][x];else{x=0;K=40;continue;}
break;case 40:if(++y<cal.ar_days.length)
ne=cal.ar_days[y][x];else{nextMonth();setVars();}
break;}
break;}
if(ne){if(!ne.disabled)
Calendar.cellClick(ne);else if(prev)
prevMonth();else
nextMonth();}}
break;case 13:if(act)
Calendar.cellClick(cal.currentDateEl,ev);break;default:return false;}
return Calendar.stopEvent(ev);};Calendar.prototype._init=function(firstDayOfWeek,date){var today=new Date(),TY=today.getFullYear(),TM=today.getMonth(),TD=today.getDate();this.table.style.visibility="hidden";var year=date.getFullYear();if(year<this.minYear){year=this.minYear;date.setFullYear(year);}else if(year>this.maxYear){year=this.maxYear;date.setFullYear(year);}
this.firstDayOfWeek=firstDayOfWeek;this.date=new Date(date);var month=date.getMonth();var mday=date.getDate();var no_days=date.getMonthDays();date.setDate(1);var day1=(date.getDay()-this.firstDayOfWeek)%7;if(day1<0)
day1+=7;date.setDate(0-day1);date.setDate(date.getDate()+1);var row=this.tbody.firstChild;var MN=Calendar._SMN[month];var ar_days=this.ar_days=new Array();var weekend=Calendar._TT["WEEKEND"];var dates=this.multiple?(this.datesCells={}):null;for(var i=0;i<6;++i,row=row.nextSibling){var cell=row.firstChild;if(this.weekNumbers){cell.className="day wn";cell.innerHTML=date.getWeekNumber();cell=cell.nextSibling;}
row.className="daysrow";var hasdays=false,iday,dpos=ar_days[i]=[];for(var j=0;j<7;++j,cell=cell.nextSibling,date.setDate(iday+1)){iday=date.getDate();var wday=date.getDay();cell.className="day";cell.pos=i<<4|j;dpos[j]=cell;var current_month=(date.getMonth()==month);if(!current_month){if(this.showsOtherMonths){cell.className+=" othermonth";cell.otherMonth=true;}else{cell.className="emptycell";cell.innerHTML="&nbsp;";cell.disabled=true;continue;}}else{cell.otherMonth=false;hasdays=true;}
cell.disabled=false;cell.innerHTML=this.getDateText?this.getDateText(date,iday):iday;if(dates)
dates[date.print("%Y%m%d")]=cell;if(this.getDateStatus){var status=this.getDateStatus(date,year,month,iday);if(status===true){cell.className+=" disabled";cell.disabled=true;}else{if(/disabled/i.test(status))
cell.disabled=true;cell.className+=" "+status;}}
if(!cell.disabled){cell.caldate=new Date(date);cell.ttip="_";if(!this.multiple&&current_month&&iday==mday&&this.hiliteToday){cell.className+=" selected";this.currentDateEl=cell;}
if(date.getFullYear()==TY&&date.getMonth()==TM&&iday==TD){cell.className+=" today";cell.ttip+=Calendar._TT["PART_TODAY"];}
if(weekend.indexOf(wday.toString())!=-1)
cell.className+=cell.otherMonth?" oweekend":" weekend";}}
if(!(hasdays||this.showsOtherMonths))
row.className="emptyrow";}
this.title.innerHTML=Calendar._MN[month]+", "+year;this.onSetTime();this.table.style.visibility="visible";this._initMultipleDates();};Calendar.prototype._initMultipleDates=function(){if(this.multiple){for(var i in this.multiple){var cell=this.datesCells[i];var d=this.multiple[i];if(!d)
continue;if(cell)
cell.className+=" selected";}}};Calendar.prototype._toggleMultipleDate=function(date){if(this.multiple){var ds=date.print("%Y%m%d");var cell=this.datesCells[ds];if(cell){var d=this.multiple[ds];if(!d){Calendar.addClass(cell,"selected");this.multiple[ds]=date;}else{Calendar.removeClass(cell,"selected");delete this.multiple[ds];}}}};Calendar.prototype.setDateToolTipHandler=function(unaryFunction){this.getDateToolTip=unaryFunction;};Calendar.prototype.setDate=function(date){if(!date.equalsTo(this.date)){this._init(this.firstDayOfWeek,date);}};Calendar.prototype.refresh=function(){this._init(this.firstDayOfWeek,this.date);};Calendar.prototype.setFirstDayOfWeek=function(firstDayOfWeek){this._init(firstDayOfWeek,this.date);this._displayWeekdays();};Calendar.prototype.setDateStatusHandler=Calendar.prototype.setDisabledHandler=function(unaryFunction){this.getDateStatus=unaryFunction;};Calendar.prototype.setRange=function(a,z){this.minYear=a;this.maxYear=z;};Calendar.prototype.callHandler=function(){if(this.onSelected){this.onSelected(this,this.date.print(this.dateFormat));}};Calendar.prototype.callCloseHandler=function(){if(this.onClose){this.onClose(this);}
this.hideShowCovered();};Calendar.prototype.destroy=function(){var el=this.element.parentNode;el.removeChild(this.element);Calendar._C=null;window._dynarch_popupCalendar=null;};Calendar.prototype.reparent=function(new_parent){var el=this.element;el.parentNode.removeChild(el);new_parent.appendChild(el);};Calendar._checkCalendar=function(ev){var calendar=window._dynarch_popupCalendar;if(!calendar){return false;}
var el=Calendar.is_ie?Calendar.getElement(ev):Calendar.getTargetElement(ev);for(;el!=null&&el!=calendar.element;el=el.parentNode);if(el==null){window._dynarch_popupCalendar.callCloseHandler();return Calendar.stopEvent(ev);}};Calendar.prototype.show=function(){var calendar=window._dynarch_popupCalendar;if(calendar){window._dynarch_popupCalendar.callCloseHandler();}
var rows=this.table.getElementsByTagName("tr");for(var i=rows.length;i>0;){var row=rows[--i];Calendar.removeClass(row,"rowhilite");var cells=row.getElementsByTagName("td");for(var j=cells.length;j>0;){var cell=cells[--j];Calendar.removeClass(cell,"hilite");Calendar.removeClass(cell,"active");}}
this.element.style.display="block";this.hidden=false;if(this.isPopup){window._dynarch_popupCalendar=this;if(this.keyNav){Calendar.addEvent(document,"keydown",Calendar._keyEvent);Calendar.addEvent(document,"keypress",Calendar._keyEvent);}
Calendar.addEvent(document,"mousedown",Calendar._checkCalendar);}
this.hideShowCovered();};Calendar.prototype.hide=function(){if(this.isPopup){Calendar.removeEvent(document,"keydown",Calendar._keyEvent);Calendar.removeEvent(document,"keypress",Calendar._keyEvent);Calendar.removeEvent(document,"mousedown",Calendar._checkCalendar);}
this.element.style.display="none";this.hidden=true;this.hideShowCovered();};Calendar.prototype.showAt=function(x,y){var s=this.element.style;s.left=x+"px";s.top=y+"px";this.show();};Calendar.prototype.showAtElement=function(el,opts){var self=this;var p=Calendar.getAbsolutePos(el);if(!opts||typeof opts!="string"){this.showAt(p.x,p.y+el.offsetHeight);return true;}
function fixPosition(box){if(box.x<0)
box.x=0;if(box.y<0)
box.y=0;var cp=document.createElement("div");var s=cp.style;s.position="absolute";s.right=s.bottom=s.width=s.height="0px";document.body.appendChild(cp);var br=Calendar.getAbsolutePos(cp);document.body.removeChild(cp);if(Calendar.is_ie){br.y+=document.body.scrollTop;br.x+=document.body.scrollLeft;}else{br.y+=window.scrollY;br.x+=window.scrollX;}
var tmp=box.x+box.width-br.x;if(tmp>0)box.x-=tmp;tmp=box.y+box.height-br.y;if(tmp>0)box.y-=tmp;};this.element.style.display="block";Calendar.continuation_for_the_fucking_khtml_browser=function(){var w=self.element.offsetWidth;var h=self.element.offsetHeight;self.element.style.display="none";var valign=opts.substr(0,1);var halign="l";if(opts.length>1){halign=opts.substr(1,1);}
switch(valign){case"T":p.y-=h;break;case"B":p.y+=el.offsetHeight;break;case"C":p.y+=(el.offsetHeight-h)/2;break;case"t":p.y+=el.offsetHeight-h;break;case"b":break;}
switch(halign){case"L":p.x-=w;break;case"R":p.x+=el.offsetWidth;break;case"C":p.x+=(el.offsetWidth-w)/2;break;case"l":p.x+=el.offsetWidth-w;break;case"r":break;}
p.width=w;p.height=h+40;self.monthsCombo.style.display="none";fixPosition(p);self.showAt(p.x,p.y);};if(Calendar.is_khtml)
setTimeout("Calendar.continuation_for_the_fucking_khtml_browser()",10);else
Calendar.continuation_for_the_fucking_khtml_browser();};Calendar.prototype.setDateFormat=function(str){this.dateFormat=str;};Calendar.prototype.setTtDateFormat=function(str){this.ttDateFormat=str;};Calendar.prototype.parseDate=function(str,fmt){if(!fmt)
fmt=this.dateFormat;this.setDate(Date.parseDate(str,fmt));};Calendar.prototype.hideShowCovered=function(){if(!Calendar.is_ie&&!Calendar.is_opera)
return;function getVisib(obj){var value=obj.style.visibility;if(!value){if(document.defaultView&&typeof(document.defaultView.getComputedStyle)=="function"){if(!Calendar.is_khtml)
value=document.defaultView.getComputedStyle(obj,"").getPropertyValue("visibility");else
value='';}else if(obj.currentStyle){value=obj.currentStyle.visibility;}else
value='';}
return value;};var tags=new Array("applet","iframe","select");var el=this.element;var p=Calendar.getAbsolutePos(el);var EX1=p.x;var EX2=el.offsetWidth+EX1;var EY1=p.y;var EY2=el.offsetHeight+EY1;for(var k=tags.length;k>0;){var ar=document.getElementsByTagName(tags[--k]);var cc=null;for(var i=ar.length;i>0;){cc=ar[--i];p=Calendar.getAbsolutePos(cc);var CX1=p.x;var CX2=cc.offsetWidth+CX1;var CY1=p.y;var CY2=cc.offsetHeight+CY1;if(this.hidden||(CX1>EX2)||(CX2<EX1)||(CY1>EY2)||(CY2<EY1)){if(!cc.__msh_save_visibility){cc.__msh_save_visibility=getVisib(cc);}
cc.style.visibility=cc.__msh_save_visibility;}else{if(!cc.__msh_save_visibility){cc.__msh_save_visibility=getVisib(cc);}
cc.style.visibility="hidden";}}}};Calendar.prototype._displayWeekdays=function(){var fdow=this.firstDayOfWeek;var cell=this.firstdayname;var weekend=Calendar._TT["WEEKEND"];for(var i=0;i<7;++i){cell.className="day name";var realday=(i+fdow)%7;if(i){cell.ttip=Calendar._TT["DAY_FIRST"].replace("%s",Calendar._DN[realday]);cell.navtype=100;cell.calendar=this;cell.fdow=realday;Calendar._add_evs(cell);}
if(weekend.indexOf(realday.toString())!=-1){Calendar.addClass(cell,"weekend");}
cell.innerHTML=Calendar._SDN[(i+fdow)%7];cell=cell.nextSibling;}};Calendar.prototype._hideCombos=function(){this.monthsCombo.style.display="none";this.yearsCombo.style.display="none";};Calendar.prototype._dragStart=function(ev){if(this.dragging){return;}
this.dragging=true;var posX;var posY;if(Calendar.is_ie){posY=window.event.clientY+document.body.scrollTop;posX=window.event.clientX+document.body.scrollLeft;}else{posY=ev.clientY+window.scrollY;posX=ev.clientX+window.scrollX;}
var st=this.element.style;this.xOffs=posX-parseInt(st.left);this.yOffs=posY-parseInt(st.top);with(Calendar){addEvent(document,"mousemove",calDragIt);addEvent(document,"mouseup",calDragEnd);}};Date._MD=new Array(31,28,31,30,31,30,31,31,30,31,30,31);Date.SECOND=1000;Date.MINUTE=60*Date.SECOND;Date.HOUR=60*Date.MINUTE;Date.DAY=24*Date.HOUR;Date.WEEK=7*Date.DAY;Date.parseDate=function(str,fmt){var today=new Date();var y=0;var m=-1;var d=0;var a=str.split(/\W+/);var b=fmt.match(/%./g);var i=0,j=0;var hr=0;var min=0;for(i=0;i<a.length;++i){if(!a[i])
continue;switch(b[i]){case"%d":case"%e":d=parseInt(a[i],10);break;case"%m":m=parseInt(a[i],10)-1;break;case"%Y":case"%y":y=parseInt(a[i],10);(y<100)&&(y+=(y>29)?1900:2000);break;case"%b":case"%B":for(j=0;j<12;++j){if(Calendar._MN[j].substr(0,a[i].length).toLowerCase()==a[i].toLowerCase()){m=j;break;}}
break;case"%H":case"%I":case"%k":case"%l":hr=parseInt(a[i],10);break;case"%P":case"%p":if(/pm/i.test(a[i])&&hr<12)
hr+=12;else if(/am/i.test(a[i])&&hr>=12)
hr-=12;break;case"%M":min=parseInt(a[i],10);break;}}
if(isNaN(y))y=today.getFullYear();if(isNaN(m))m=today.getMonth();if(isNaN(d))d=today.getDate();if(isNaN(hr))hr=today.getHours();if(isNaN(min))min=today.getMinutes();if(y!=0&&m!=-1&&d!=0)
return new Date(y,m,d,hr,min,0);y=0;m=-1;d=0;for(i=0;i<a.length;++i){if(a[i].search(/[a-zA-Z]+/)!=-1){var t=-1;for(j=0;j<12;++j){if(Calendar._MN[j].substr(0,a[i].length).toLowerCase()==a[i].toLowerCase()){t=j;break;}}
if(t!=-1){if(m!=-1){d=m+1;}
m=t;}}else if(parseInt(a[i],10)<=12&&m==-1){m=a[i]-1;}else if(parseInt(a[i],10)>31&&y==0){y=parseInt(a[i],10);(y<100)&&(y+=(y>29)?1900:2000);}else if(d==0){d=a[i];}}
if(y==0)
y=today.getFullYear();if(m!=-1&&d!=0)
return new Date(y,m,d,hr,min,0);return today;};Date.prototype.getMonthDays=function(month){var year=this.getFullYear();if(typeof month=="undefined"){month=this.getMonth();}
if(((0==(year%4))&&((0!=(year%100))||(0==(year%400))))&&month==1){return 29;}else{return Date._MD[month];}};Date.prototype.getDayOfYear=function(){var now=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0);var then=new Date(this.getFullYear(),0,0,0,0,0);var time=now-then;return Math.floor(time/Date.DAY);};Date.prototype.getWeekNumber=function(){var d=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0);var DoW=d.getDay();d.setDate(d.getDate()-(DoW+6)%7+3);var ms=d.valueOf();d.setMonth(0);d.setDate(4);return Math.round((ms-d.valueOf())/(7*864e5))+1;};Date.prototype.equalsTo=function(date){return((this.getFullYear()==date.getFullYear())&&(this.getMonth()==date.getMonth())&&(this.getDate()==date.getDate())&&(this.getHours()==date.getHours())&&(this.getMinutes()==date.getMinutes()));};Date.prototype.setDateOnly=function(date){var tmp=new Date(date);this.setDate(1);this.setFullYear(tmp.getFullYear());this.setMonth(tmp.getMonth());this.setDate(tmp.getDate());};Date.prototype.print=function(str){var m=this.getMonth();var d=this.getDate();var y=this.getFullYear();var wn=this.getWeekNumber();var w=this.getDay();var s={};var hr=this.getHours();var pm=(hr>=12);var ir=(pm)?(hr-12):hr;var dy=this.getDayOfYear();if(ir==0)
ir=12;var min=this.getMinutes();var sec=this.getSeconds();s["%a"]=Calendar._SDN[w];s["%A"]=Calendar._DN[w];s["%b"]=Calendar._SMN[m];s["%B"]=Calendar._MN[m];s["%C"]=1+Math.floor(y/100);s["%d"]=(d<10)?("0"+d):d;s["%e"]=d;s["%H"]=(hr<10)?("0"+hr):hr;s["%I"]=(ir<10)?("0"+ir):ir;s["%j"]=(dy<100)?((dy<10)?("00"+dy):("0"+dy)):dy;s["%k"]=hr;s["%l"]=ir;s["%m"]=(m<9)?("0"+(1+m)):(1+m);s["%M"]=(min<10)?("0"+min):min;s["%n"]="\n";s["%p"]=pm?"PM":"AM";s["%P"]=pm?"pm":"am";s["%s"]=Math.floor(this.getTime()/1000);s["%S"]=(sec<10)?("0"+sec):sec;s["%t"]="\t";s["%U"]=s["%W"]=s["%V"]=(wn<10)?("0"+wn):wn;s["%u"]=w+1;s["%w"]=w;s["%y"]=(''+y).substr(2,2);s["%Y"]=y;s["%%"]="%";var re=/%./g;if(!Calendar.is_ie5&&!Calendar.is_khtml)
return str.replace(re,function(par){return s[par]||par;});var a=str.match(re);for(var i=0;i<a.length;i++){var tmp=s[a[i]];if(tmp){re=new RegExp(a[i],'g');str=str.replace(re,tmp);}}
return str;};Date.prototype.__msh_oldSetFullYear=Date.prototype.setFullYear;Date.prototype.setFullYear=function(y){var d=new Date(this);d.__msh_oldSetFullYear(y);if(d.getMonth()!=this.getMonth())
this.setDate(28);this.__msh_oldSetFullYear(y);};window._dynarch_popupCalendar=null;Calendar._DN=new Array
("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday");Calendar._SDN=new Array
("Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun");Calendar._FD=0;Calendar._MN=new Array
("January","February","March","April","May","June","July","August","September","October","November","December");Calendar._SMN=new Array
("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");Calendar._TT={};Calendar._TT["INFO"]="About the calendar";Calendar._TT["ABOUT"]="DHTML Date/Time Selector\n"+"(c) dynarch.com 2002-2005 / Author: Mihai Bazon\n"+"For latest version visit: http://www.dynarch.com/projects/calendar/\n"+"Distributed under GNU LGPL.  See http://gnu.org/licenses/lgpl.html for details."+"\n\n"+"Date selection:\n"+"- Use the \xab, \xbb buttons to select year\n"+"- Use the "+String.fromCharCode(0x2039)+", "+String.fromCharCode(0x203a)+" buttons to select month\n"+"- Hold mouse button on any of the above buttons for faster selection.";Calendar._TT["ABOUT_TIME"]="\n\n"+"Time selection:\n"+"- Click on any of the time parts to increase it\n"+"- or Shift-click to decrease it\n"+"- or click and drag for faster selection.";Calendar._TT["PREV_YEAR"]="Prev. year (hold for menu)";Calendar._TT["PREV_MONTH"]="Prev. month (hold for menu)";Calendar._TT["GO_TODAY"]="Go Today";Calendar._TT["NEXT_MONTH"]="Next month (hold for menu)";Calendar._TT["NEXT_YEAR"]="Next year (hold for menu)";Calendar._TT["SEL_DATE"]="Select date";Calendar._TT["DRAG_TO_MOVE"]="Drag to move";Calendar._TT["PART_TODAY"]=" (today)";Calendar._TT["DAY_FIRST"]="Display %s first";Calendar._TT["WEEKEND"]="0,6";Calendar._TT["CLOSE"]="Close";Calendar._TT["TODAY"]="Today";Calendar._TT["TIME_PART"]="(Shift-)Click or drag to change value";Calendar._TT["DEF_DATE_FORMAT"]="%Y-%m-%d";Calendar._TT["TT_DATE_FORMAT"]="%a, %b %e";Calendar._TT["WK"]="wk";Calendar._TT["TIME"]="Time:";Calendar.setup=function(params){if(!params.inputField._isUnderMouse){Event.observe(params.inputField,'mouseover',function(){params.inputField._isUnderMouse=true;});Event.observe(params.inputField,'mouseout',function(){params.inputField._isUnderMouse=false;});}
function param_default(pname,def){if(typeof params[pname]=="undefined"){params[pname]=def;}};param_default("inputField",null);param_default("displayArea",null);param_default("button",null);param_default("eventName","click");param_default("ifFormat","%Y/%m/%d");param_default("daFormat","%Y/%m/%d");param_default("singleClick",true);param_default("disableFunc",null);param_default("dateStatusFunc",params["disableFunc"]);param_default("dateTooltipFunc",null);param_default("dateText",null);param_default("firstDay",null);param_default("align","Br");param_default("range",[1900,2999]);param_default("weekNumbers",true);param_default("flat",null);param_default("flatCallback",null);param_default("onSelect",null);param_default("onClose",function(){if(params.inputField._isUnderMouse){return false;}
calendar.hide();});param_default("onUpdate",null);param_default("date",null);param_default("showsTime",false);param_default("timeFormat","24");param_default("electric",true);param_default("step",2);param_default("position",null);param_default("cache",false);param_default("showOthers",false);param_default("multiple",null);param_default("keyNav",true);var tmp=["inputField","displayArea","button"];for(var i in tmp){if(typeof params[tmp[i]]=="string"){params[tmp[i]]=document.getElementById(params[tmp[i]]);}}
if(!(params.flat||params.multiple||params.inputField||params.displayArea||params.button)){alert("Calendar.setup:\n  Nothing to setup (no fields found).  Please check your code");return false;}
function onSelect(cal){var p=cal.params;var update=(cal.dateClicked||p.electric);if(update&&p.inputField){p.inputField.value=cal.date.print(p.ifFormat);if(typeof p.inputField.onchange=="function")
p.inputField.onchange();}
if(update&&p.displayArea)
p.displayArea.innerHTML=cal.date.print(p.daFormat);if(update&&typeof p.onUpdate=="function")
p.onUpdate(cal);if(update&&p.flat){if(typeof p.flatCallback=="function")
p.flatCallback(cal);}
if(update&&p.singleClick&&cal.dateClicked)
cal.callCloseHandler();};if(params.flat!=null){if(typeof params.flat=="string")
params.flat=document.getElementById(params.flat);if(!params.flat){alert("Calendar.setup:\n  Flat specified but can't find parent.");return false;}
var cal=new Calendar(params.firstDay,params.date,params.onSelect||onSelect);cal.setDateToolTipHandler(params.dateTooltipFunc);cal.showsOtherMonths=params.showOthers;cal.showsTime=params.showsTime;cal.time24=(params.timeFormat=="24");cal.params=params;cal.weekNumbers=params.weekNumbers;cal.setRange(params.range[0],params.range[1]);cal.setDateStatusHandler(params.dateStatusFunc);cal.getDateText=params.dateText;if(params.ifFormat){cal.setDateFormat(params.ifFormat);}
if(params.inputField&&typeof params.inputField.value=="string"){cal.parseDate(params.inputField.value);}
cal.create(params.flat);cal.show();return false;}
var triggerEl=params.button||params.displayArea||params.inputField;triggerEl["on"+params.eventName]=function(){var dateEl=params.inputField||params.displayArea;var dateFmt=params.inputField?params.ifFormat:params.daFormat;var mustCreate=false;var cal=window.calendar;if(dateEl)
params.date=Date.parseDate(dateEl.value||dateEl.innerHTML,dateFmt);if(!(cal&&params.cache)){window.calendar=cal=new Calendar(params.firstDay,params.date,params.onSelect||onSelect,params.onClose||function(cal){cal.hide();});cal.setDateToolTipHandler(params.dateTooltipFunc);cal.showsTime=params.showsTime;cal.keyNav=params.keyNav
cal.time24=(params.timeFormat=="24");cal.weekNumbers=params.weekNumbers;mustCreate=true;}else{if(params.date)
cal.setDate(params.date);cal.hide();}
if(params.multiple){cal.multiple={};for(var i=params.multiple.length;--i>=0;){var d=params.multiple[i];var ds=d.print("%Y%m%d");cal.multiple[ds]=d;}}
cal.showsOtherMonths=params.showOthers;cal.yearStep=params.step;cal.setRange(params.range[0],params.range[1]);cal.params=params;cal.setDateStatusHandler(params.dateStatusFunc);cal.getDateText=params.dateText;cal.setDateFormat(dateFmt);if(mustCreate)
cal.create();cal.refresh();if(!params.position)
cal.showAtElement(params.button||params.displayArea||params.inputField,params.align);else
cal.showAt(params.position[0],params.position[1]);return false;};return cal;};cal_sprint_start=''
cal_sprint_end_date=''
date_format="%Y-%m-%d"
function disallowDateBefore(dateEnd){dateEnd.setHours(0,0,0,0)
if(cal_sprint_start&&cal_sprint_start>dateEnd)
return true;return false;}
function set_end(cal){var date=cal.date;cal_sprint_end_date=new Date(cal.date)
cal_sprint_end_date.setHours(0,0,0,0)}
function set_start(cal){var date=cal.date;cal_sprint_start=new Date(cal.date)
cal_sprint_start.setHours(0,0,0,0)
if(cal_sprint_end_date<cal_sprint_start){cal_sprint_end_date=cal_sprint_start
$('sprint_end_date').value=cal_sprint_start.print(date_format)}}
function setup_calendars(){cal_sprint_start=Date.parseDate($('sprint_start_date').value,date_format)
cal_sprint_end_date=Date.parseDate($('sprint_end_date').value,date_format)
Calendar.setup({inputField:"sprint_start_date",ifFormat:date_format,eventName:"focus",weekNumbers:false,onUpdate:set_start,keyNav:false});Calendar.setup({inputField:"sprint_end_date",ifFormat:date_format,eventName:"focus",weekNumbers:false,dateStatusFunc:disallowDateBefore,onUpdate:set_end,keyNav:false});}
var Tags={sliderClassName:'',formVisible:false,newTag:function(){if($('more_actions'))
$('more_actions').selectedIndex=0;var tag_name=this.getTagName();if(!tag_name)return false;var selected_tasks=taskList.selectedTasks().toString();new Ajax.Request('/tags/create/?'+taskList.urlParams(),{asynchronous:true,evalScripts:true,parameters:{name:tag_name,selected_tasks:selected_tasks},onComplete:function(request){Tags.hideSpinner();},onLoading:function(request){Tags.showSpinner()}});return false;},showSpinner:function(){var slider=$('taglist_slider_icon');this.sliderClassName=slider.className;slider.className='slider_loading';},hideSpinner:function(){$('taglist_slider_icon').className=this.sliderClassName;},reloadTasklist:function(){var sprint_id=$('sprint_id').innerHTML;if(!sprint_id)return false;new Ajax.Request('/tasks/rjs_list',{asynchronous:true,evalScripts:true,parameters:{sprint:sprint_id},onLoading:function(request){Spinner.show();},onComplete:function(request){Spinner.hide();}});},getTagName:function(){var tag_name=prompt("Please enter a new tag name:",'');if(!tag_name)return false;if(tag_name==''){Flash.showMessage('Please enter tag name');return false;}
return tag_name;}}
var TagView={newTag:function(){var tag_name=Tags.getTagName();if(!tag_name)return false;new Ajax.Request('/tags/create/',{asynchronous:true,evalScripts:true,parameters:{name:tag_name,view:'table'}});return false;},deleteTag:function(tag_id){var tag_name=$('tag_'+tag_id).innerHTML;if(confirm('Are you sure you want to delete \''+tag_name+'\' tag?')){new Ajax.Request('/tags/destroy/'+tag_id,{asynchronous:true,evalScripts:true,parameters:{view:'table'}});}
return false;},renameTag:function(tag_id,old_name){var new_name=prompt("Please enter a new tag name:",old_name);if(!new_name)return false;if(new_name==old_name)return false;new Ajax.Request('/tags/rename/'+tag_id,{asynchronous:true,evalScripts:true,parameters:{'tag[name]':new_name}});return false;}}
var ProjectSettings={backUrl:"",init:function(backUrl){this.backUrl=backUrl;DialogManager.registerDialog(this);},save:function(){this.updateGeneralSettings($('update_settings_form'));},cancel:function(){window.location.href=this.backUrl;},enableDisableAddRepoButton:function(){if($('repository').value=='')
$('add_button').setAttribute('disabled','disabled');else
$('add_button').removeAttribute('disabled');},assignUsersToProject:function(projectId,selected_users){selected_users=selected_users||$F('users_for_project').toString();Spinner.show();new Ajax.Request('/projects/assign_users/'+projectId,{asyncronous:true,evalScripts:true,parameters:{selected_users:selected_users,selector:$('users_for_project_filter').value}});},excludeUsersFromProject:function(projectId,selected_users){selected_users=selected_users||$F('project_users').toString();Spinner.show();new Ajax.Request('/projects/exclude_users/'+projectId,{asyncronous:true,evalScripts:true,parameters:{selected_users:selected_users,selector:$('users_for_project_filter').value}});},enableDisableBugtrackerSettings:function(){$('project_bugtracker').disabled=!$('project_bugtracker_url').disabled;$('project_bugtracker_url').disabled=!$('project_bugtracker_url').disabled;},updateGeneralSettings:function(form){Element.show('misc_settings_spinner');if(this.timerId)
clearTimeout(this.timerId);form.onsubmit();},addToWatchList:function(projectId,selected_users){selected_users=selected_users||$F('users_for_project_watch_list').toString();Spinner.show();new Ajax.Request('/projects/add_to_watch_list/'+projectId,{asyncronous:true,evalScripts:true,parameters:{selected_users:selected_users,selector:$('users_for_project_watch_list_filter').value}});},removeFromWatchList:function(projectId,selected_users){selected_users=selected_users||$F('project_watch_list').toString();Spinner.show();new Ajax.Request('/projects/remove_from_watch_list/'+projectId,{asyncronous:true,evalScripts:true,parameters:{selected_users:selected_users,selector:$('users_for_project_watch_list_filter').value}});},addMeToWatchList:function(projectId,userId){Spinner.show();new Ajax.Request('/projects/add_to_watch_list/'+projectId,{asyncronous:true,evalScripts:true,parameters:{selected_users:userId,view:'sprints'}});},removeMeFromWatchList:function(projectId,userId){Spinner.show();new Ajax.Request('/projects/remove_from_watch_list/'+projectId,{asyncronous:true,evalScripts:true,parameters:{selected_users:userId,view:'sprints'}});}}
var chooseImport={activeForm:1,showForm:function(formId,focusTo){$('import'+this.activeForm).removeClassName('active');$('import'+this.activeForm+'_form').addClassName('hidden');$('import'+formId).addClassName('active');$('import'+formId+'_form').removeClassName('hidden');this.activeForm=formId;var data=$('data_to_import');if(focusTo=='data_to_import'&&data){if((data.getValue()=='')&&$('exported_data')){data.setValue($('exported_data').getValue());}else if(data.getValue()==''&&pageProperties.importHeader){data.setValue(pageProperties.importHeader);}
data.focus();}else{if(data)data.setValue('');$(focusTo).focus();}
return false;}}
var AdvancedSelectDialog=Class.create();AdvancedSelectDialog.prototype={initialize:function(dialogId,itemPrefix,options){this.dialogId=dialogId;this.run=false;this.items=[];this.initalItems=[];this.currentItem=-1;this.projectId=null;this.combination='';this.prefix=itemPrefix;this.dialog=null;this.header='';this.callbackId=0;this.showOtherProjects=false;this.showArchivedSprints=false;Object.extend(this,options||{});},show:function(callbackId){this.callbackId=callbackId||0;if(openedDialog){new Effect.Highlight(openedDialog+'_header',{startcolor:'#ffff00',duration:0.5,restorecolor:'#4998d0'});return false;}
if(!this.dialog)this.dialog=$(this.dialogId);if(this.dialog){Flash.hide();this.eventType='keypress';if(navigator.appVersion.match(/Safari|KHTML/)){this.eventType='keydown';}
this.init();this.dialog.style.display='';observersManager.save();openedDialog=this.dialogId;if(typeof this.eventListener!='function'){this.eventListener=this.keyObserver.bindAsEventListener(this);}
Event.observe(document,this.eventType,this.eventListener);}},init:function(){if(this.run){this.combination='';this.updateList();}else{var header=$(this.dialogId+'_header');if(header)this.header=header.innerHTML;var list=$(this.prefix+'list');var spans=list.getElementsByTagName('span');for(var i=0;i<spans.length;i++){var span=spans[i];var spanId=span.getAttribute('id');if(spanId&&spanId.match(this.prefix)){var item={id:parseInt(spanId.substring(this.prefix.length)),name:(document.body.textContent?span.textContent:span.innerText)}
this.items.push(item);}}
this.run=true;if(this.items.length>0){this.selectFirstItem();if(this.initalItems.length==0){this.initalItems=this.items;}}}},reset:function(){this.run=false;this.combination='';this.items=[];this.init();},fetchAdvSelDialogSprints:function(){var projectId=pageProperties.projectId;new Ajax.Updater('nav_sprint_list','/projects/'+projectId+'/sprints/nav_dialog_selector',{asynchronous:true,evalScripts:true,parameters:{archived_sprints:this.showArchivedSprints,other_projects:this.showOtherProjects},onLoading:function(request){Spinner.show();},onComplete:function(request){navDialog.reset();navDialog.header='Type in Sprint Name';navDialog.init();Spinner.hide();Flash.showMessage("Archived sprints have been loaded.");}});},selectFirstItem:function(){this.selectItem(0);},act:function(idx){var items=this.filteredItems();if(items[idx].name=="Load Archived Sprints..."){this.showArchivedSprints=true;this.fetchAdvSelDialogSprints();return false;}
if(items[idx].name=="Load Sprints from All Projects..."){this.showOtherProjects=true;this.fetchAdvSelDialogSprints();return false;}
if(typeof(this.callback)=='function'){this.callback(idx);}else{this.callback[this.callbackId](idx);}},callback:function(idx){alert(idx+' was selected. Override me!');},filteredItems:function(){var items=[];if(this.combination.length==0){items=this.items;}else{for(var i=0;i<this.items.length;i++){var item=this.items[i];var name=item.name.toLowerCase();if(name.substring(0,this.combination.length)==this.combination)
items.push(item);}}
return items;},updateList:function(){this.currentItem=-1;var items=this.filteredItems();this.drawHeader();this.drawList(items);if(items.length>0){this.selectFirstItem();}},drawHeader:function(){var header=$(this.dialogId+'_header');if(this.combination.length>0){header.innerHTML=this.combination;}else{header.innerHTML=this.header;}},drawList:function(items){var list=$(this.prefix+'list');var html='';if(items.length>0){for(var i=0;i<items.length;i++){html=html+'<span id="'+this.prefix+items[i].id+'">'
html=html+items[i].name;html=html+'</span>'
if(i<items.length-1)html=html+'\n<span>&#149;</span>\n';}}else{html='No matches.'}
list.innerHTML=html;},hide:function(){this.showOtherProjects=false;this.showArchivedSprints=false;this.items=this.initalItems;this.drawList(this.initalItems);this.dialog.style.display='none';openedDialog=false;Event.stopObserving(document,this.eventType,this.eventListener);observersManager.restore();},keyObserver:function(e){if(e.ctrlKey||e.metaKey){return;}
Event.stop(e);switch(e.keyCode){case Event.KEY_ESC:this.hide();break;case Event.KEY_DOWN:case Event.KEY_RIGHT:this.selectItem(this.nextItem());break;case Event.KEY_UP:case Event.KEY_LEFT:this.selectItem(this.prevItem());break;case Event.KEY_RETURN:this.act(this.currentItem);break;case Event.KEY_BACKSPACE:if(this.combination.length>1){this.combination=this.combination.substring(0,this.combination.length-1);}else if(this.combination.length==1){this.combination='';}
this.updateList();break;default:var code=e.which?e.which:e.keyCode;if(code==189&&Prototype.Browser.WebKit){code=45;}
if(code==186&&Prototype.Browser.WebKit){code=58;}
if(code==55&&e.shiftKey&&Prototype.Browser.WebKit){code=38;}
var letter=String.fromCharCode(code).toLowerCase();if(!letter.match(/[0-9a-z&\:\s_-]/))return false;this.combination=this.combination+letter;this.updateList();}},selectItem:function(idx){var items=this.filteredItems();var item=null;if(this.currentItem>=0){item=items[this.currentItem];$(this.prefix+item.id).className='';}
item=items[idx];if(!item)return false;$(this.prefix+item.id).className='selected';this.currentItem=idx;},nextItem:function(){var items=this.filteredItems();var idx=this.currentItem+1;if(idx>(items.length-1))idx=0;return idx;},prevItem:function(){var items=this.filteredItems();var idx=this.currentItem-1;if(idx<0)idx=items.length-1;return idx;}};var navDialog=new AdvancedSelectDialog('nav_dialog','nav_sprint_',{callback:function(idx){var projectId=pageProperties.projectId;var items=this.filteredItems();var item=items[idx];if(!item)return;this.hide()
redirect('/projects/'+projectId+'/sprints/'+item.id+'/show');}});var navProjectDialog=new AdvancedSelectDialog('nav_project_dialog','nav_project_',{callback:function(idx){var items=this.filteredItems();var item=items[idx];if(!item)return;this.hide()
redirect('/projects/'+item.id+'/sprints');}});var Wiki={minInclusionEditorHeight:150,maxInclusionEditorHeight:400,minHeight:250,ignoreEsc:true,pageWiki:0,taskWiki:1,addHelp:1,removeHelp:-1,editorId:'wiki_editor',defaultContainerId:'current_wiki_edit_container',defaultParentContainerId:'parent_wiki_edit_container',formId:'issue_wiki_edit_form',type:this.pageWiki,containerId:null,parentContainerId:null,projectId:null,wikiKey:null,revisionId:null,currentRevisionId:null,defaultOptions:function(){return{type:this.type,containerId:this.containerId,projectId:this.projectId,wikiKey:this.wikiKey,revisionId:this.revisionId,currentRevisionId:this.currentRevisionId,section:this.section}},execute:function(action,options){if(action=='edit')DialogManager.registerDialog(this);options=options||this.defaultOptions();var params={}
if(action=='create_task')params=$('extract_form').serialize(true);params.container_id=options.containerId;params.project_id=options.projectId;params.current_revision=options.currentRevisionId;if(parseInt(options.revisionId)>0)params.revision=options.revisionId;if(options.section)params.section=options.section;if(options.section&&['quick_save','create_task'].include(action)){params.parent_container_id=this.parentContainerId;}
if(options.type==Wiki.pageWiki){params.title=options.wikiKey;}else{params.issue_id=options.wikiKey;}
if(options.containerId!='page_wiki'){if(options.editorHeight){params.wiki_editor_height=options.editorHeight;}}
if(['save','quick_save','preview','preview_diff','switch_editor'].include(action)){params.wiki=this.getEditedWiki();}
if(this.richEditor.active)params.html_formatted=true;new Ajax.Request('/wiki/'+action,{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});},resetContainers:function(){this.containerId=null;var container=$(this.defaultContainerId);if(container)container.setAttribute('id','');},setCurrentRevision:function(newRevisionId){this.currentRevisionId=newRevisionId;if(this.containerId=='page_wiki')$('current_revision').setValue(newRevisionId);},getEditedWiki:function(){if(this.richEditor.active){return this.richEditor.getContent();}else{var editor=this.getEditor();return editor.getValue();}},prepareParentContainerForUpdate:function(action){var container=$(this.containerId);var parentContainer=container;while(parentContainer=parentContainer.parentNode){var parentId=parentContainer.getAttribute('id');var className=parentContainer.className;if(parentId=='page_wiki'||parentId=='issue_wiki'){if(action=='quick_save'){this.parentContainerId=parentId;break;}else{this.resetContainers();this.containerId=parentId;break;}}
if(className=='edit-container'){if(action=='quick_save'){this.parentContainerId=this.defaultParentContainerId;parentContainer.setAttribute('id',this.parentContainerId);break;}else{container.setAttribute('id','');parentContainer.setAttribute('id',this.containerId);break;}}}
return null;},save:function(){if(!this.isEditing()&&!this.taskEditor.active)return false;if(this.taskEditor.active){if(this.section)this.prepareParentContainerForUpdate('quick_save');this.execute('create_task');}else{if(this.section)this.prepareParentContainerForUpdate('save');this.execute('save');}},cancel:function(){if(!this.isEditing()&&!this.taskEditor.active)return false;if(this.section){this.section=null;this.prepareParentContainerForUpdate();}
this.execute('show');},edit:function(link,options){if(this.taskEditor.active||$(this.formId)){Flash.showMessage('Close current wiki editor before opening a new one.');return false;}
var container=null;if(options.section){container=link.parentNode.parentNode;}else{var spans=link.parentNode.parentNode.getElementsByTagName('span');for(var i=0;i<spans.length;i++){if(spans[i].className=="edit-container"){container=spans[i];break;}}}
if(container){var dm=Element.getDimensions(container);options.editorHeight=dm.height+50;if(options.editorHeight<this.minInclusionEditorHeight)options.editorHeight=this.minInclusionEditorHeight;if(options.editorHeight>this.maxInclusionEditorHeight)options.editorHeight=this.maxInclusionEditorHeight;container.setAttribute('id',this.defaultContainerId);options.containerId=this.defaultContainerId;if(options.extract){this.execute('extract',options);}else{this.execute('edit',options);}}},preview:function(){if(this.isEditing())this.execute('preview');},previewDiff:function(){if(this.isEditing())this.execute('preview_diff');},quickSave:function(){if(!this.isEditing())return false;if(this.section)this.prepareParentContainerForUpdate('quick_save');this.execute('quick_save');},isEditing:function(){if(this.richEditor.active)return true;var editor=this.getEditor();return(editor&&editor.visible());},getEditor:function(){return $(this.editorId);},focusEditor:function(){if(!this.richEditor.active){Field.focus(this.editorId);}},replaceWiki:function(start,end,issue_number){var editor=this.getEditor();if(editor){var text=editor.value;editor.value=text.substring(0,start)+'{{Task:'+issue_number+'}}'+text.substring(end,text.length);}},rename:function(title,project){var newTitle=prompt("Please enter new title:",title.replace(/_/g,' '));if(!newTitle)return false;if(newTitle==''){Flash.showMessage('Cannot rename page to empty title.');return false;}
new Ajax.Request('/wiki/rename',{asynchronous:true,evalScripts:true,parameters:{title:title,new_title:newTitle,project_id:project},onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});},insertTemplate:function(selector,editor_id){var template_id=selector.value;selector.selectedIndex=0;new Ajax.Request('/wiki/insert_template',{asynchronous:true,evalScripts:true,parameters:{id:template_id,editor_id:editor_id},onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});},newTemplate:function(projectId,namespace){var title=prompt("Please enter a new template name:",namespace+':Name');if(!title)return false;if(title==''){Flash.showMessage('Please enter template name');return false;}
var regNamespace=new RegExp('^'+namespace+':',"i");title=title.replace(regNamespace,'');location.href='/projects/'+projectId+'/wiki/'+encodeURIComponent(namespace)+':'+title;},expandOrCollapseInclusion:function(event){var link=Event.element(event);if(link.innerHTML=='[+]')
link.innerHTML='[-]';else
link.innerHTML='[+]';var editLink=link.parentNode.parentNode.getElementsByClassName("edit_link")[0];if(editLink)Element.toggle(editLink);var expandableWikiContainer=link.parentNode.parentNode.getElementsByClassName("expandable_inclusion")[0];Element.toggle(expandableWikiContainer);},ensureVisible:function(){pos=windowHelper.findPos($(this.formId));var bottomY=pos[1]+Element.getHeight(this.formId);bottomY+=16;windowHelper.scroll(bottomY,{ensureVisible:true});},hideConflictWarning:function(){var element=$('conflict_warning');if(element)Element.hide(element);},resizeForm:function(howToResize){if(Wiki.containerId!='page_wiki'&&Wiki.containerId!='issue_wiki')return false;var wrapper=$('wiki_editor_wrapper');var help=$('wiki_inline_help');if(howToResize==Wiki.addHelp){wrapper.addClassName('wrapper_with_help');help.show();}else{wrapper.removeClassName('wrapper_with_help');help.hide();}},setExclusiveActiveStatus:function(editor){this.plainTextEditor.active=false;this.richEditor.active=false;this.taskEditor.active=false;editor.active=true;},plainTextEditor:{active:true,activate:function(){if(this.active)return;Wiki.richEditor.deactivate();},switchToRichEditor:function(htmlContent){Wiki.resizeForm(Wiki.removeHelp);Wiki.richEditor.show();Wiki.richEditor.setContent(htmlContent);Wiki.richEditor.setActive();}},richEditor:{loaded:false,active:false,content:null,activate:function(){if(this.active)return;if(!this.loaded){Spinner.show();this.load();return;}
Wiki.execute('switch_editor');},deactivate:function(){if(this.active)Wiki.execute('switch_editor');},switchToPlainTextEditor:function(textContent){Wiki.richEditor.hide();Wiki.resizeForm(Wiki.addHelp);Wiki.getEditor().setValue(textContent);Wiki.focusEditor();Wiki.setExclusiveActiveStatus(Wiki.plainTextEditor);},load:function(){var script=document.createElement("script");script.setAttribute('type','text/javascript');if(script.readyState){script.onreadystatechange=function(){if(script.readyState=="loaded"||script.readyState=="complete"){script.onreadystatechange=null;Wiki.richEditor.onLoad();}}}else{script.onload=function(){Wiki.richEditor.onLoad()};}
script.setAttribute('src','/javascripts/tiny_mce/tiny_mce.js');document.getElementsByTagName("head")[0].appendChild(script);},onLoad:function(){window.tinymce.dom.Event.domLoaded=true;tinyMCE.init({mode:"none",theme:"advanced",content_css:"/stylesheets/acunote.css",body_class:"wiki",convert_urls:false,plugins:"style,table,advimage,insertdatetime,searchreplace,fullscreen,paste,preelementfix",theme_advanced_buttons1:"formatselect,bold,italic,underline,strikethrough,|,"+"justifyleft,justifycenter,justifyright,justifyfull,|,"+"forecolor,backcolor,|,"+"bullist,numlist,|,"+"outdent,indent,|,"+"search,replace,|,undo,redo,|,fullscreen",theme_advanced_buttons2:"link,unlink,image,|,hr,sub,sup,|,"+"tablecontrols,|,delete_table",theme_advanced_buttons3:"",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"bottom",theme_advanced_path:false,theme_advanced_resizing:true,init_instance_callback:"Wiki.richEditor.updateContent",extended_valid_elements:"a[accesskey|charset|class|coords|dir<ltr?rtl|href|hreflang|id|lang|name"
+"|onblur|onclick|ondblclick|onfocus|onkeydown|onkeypress|onkeyup"
+"|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|rel|rev"
+"|shape<circle?default?poly?rect|style|tabindex|title|target|type|res|ohref],"
+"nowiki",custom_elements:'~nowiki',advlink_styles:"internal-link;general-link;task-link;sprint-link;user-link",paste_postprocess:function(pl,o){var styles=o.node.getElementsByTagName('mce:style');for(var i=0;i<styles.length;i++){styles[i].parentNode.removeChild(styles[i]);}
var styles=o.node.getElementsByTagName('style');for(var i=0;i<styles.length;i++){styles[i].parentNode.removeChild(styles[i]);}},setup:Wiki.richEditor.setupShortcuts});this.loaded=true;Wiki.execute('switch_editor');},setupShortcuts:function(editor){if(!SHORTCUTS)return;for(var combination in SHORTCUTS){if(matches=combination.match(/^A-(.*)$/)){editor.addShortcut('alt+'+matches[1],'',SHORTCUTS[combination]);}}},setActive:function(){var richEditSwitch=$('rich_edit_switch');var plainEditSwitch=$('plain_edit_switch');richEditSwitch.removeClassName('inactive_editor_tab');richEditSwitch.addClassName('active_editor_tab');plainEditSwitch.removeClassName('active_editor_tab');plainEditSwitch.addClassName('inactive_editor_tab');var new_task_button=$('new_task_from_selection_btn');if(new_task_button)new_task_button.hide();var template_selector=$('taskwiki_template');if(template_selector)template_selector.hide();Wiki.setExclusiveActiveStatus(this);if(Wiki.containerId=='page_wiki')$('html_formatted').setValue('true');},setInactive:function(){var richEditSwitch=$('rich_edit_switch');var plainEditSwitch=$('plain_edit_switch');richEditSwitch.removeClassName('active_editor_tab');richEditSwitch.addClassName('inactive_editor_tab');plainEditSwitch.removeClassName('inactive_editor_tab');plainEditSwitch.addClassName('active_editor_tab');var new_task_button=$('new_task_from_selection_btn');if(new_task_button)new_task_button.show();var template_selector=$('taskwiki_template');if(template_selector)template_selector.show();this.content=null;this.active=false;if(Wiki.containerId=='page_wiki')$('html_formatted').setValue('false');},show:function(){tinyMCE.execCommand('mceAddControl',false,Wiki.editorId);},hide:function(){tinyMCE.execCommand('mceRemoveControl',false,Wiki.editorId);this.setInactive();},setContent:function(content){this.content=content;},updateContent:function(editor){editor.setContent(this.content);},getContent:function(){return tinyMCE.activeEditor.getContent();}},taskEditor:{active:false},moreActions:function(select){select.blur();var action=select.options[select.options.selectedIndex].value;if(action=='inclusion_builder'){InclusionBuilder.show();}else{this.insertTemplate(select);}
select.selectedIndex=0}}
var issueList={}
Object.extend(issueList,genericList);Object.extend(issueList,{defaultExportLimit:1000,row:function(issueId){return $('issue_'+issueId)},getId:function(element){if(element==null)return null
while(element.nodeName!='TR')
element=element.parentNode
if(element&&element.nodeName=='TR'){var id=parseInt(element.id.substr(6,100))
return isNaN(id)?null:id}
return null},getOwnerId:function(id){var ownerEl=$('issue_owner_'+id);if(ownerEl)
return parseInt(ownerEl.className.substring(9));return null;},getIssueIdByNumber:function(issueNumber){return parseInt($('issue_id_for_'+issueNumber).innerHTML);},getCurrentQuery:function(){var query_element=$('current_query');if(query_element){return query_element.innerHTML;}else{return'';}}});var issueActions={actionsRoutedToTasks:['','/search','/export','/import','/taskpad','/filters'],popped_id:null,resetPopup:function(cell,id){issueActions.popped_id=id;var menu=$('itemmenu');if(menu.parentNode==cell.firstChild){Element.toggle(menu);}else{cell.firstChild.appendChild(menu);Element.toggle(menu);}},toggleIssueCheckbox:function(id,e){var row=Event.findElement(e,'tr');if(row){var checkbox=Event.element(e);issueList.toggle(row,(checkbox.name=='selected')?checkbox:false);}
if(e&&e.shiftKey){issueList.multipleSelect(id,e);}
issueList.lastRowClicked=id;},deleteUndeleteIssue:function(action,issueNumber){if(!confirm('Are you sure you want to '+action+' this task?'))return false;new Ajax.Request('/issues/'+action,{asynchronous:true,evalScripts:true,parameters:{project_id:issueList.getProjectId(),number:issueNumber},onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});return false;},moreAction:function(page){query=issueList.getCurrentQuery();var list=$('more_actions');list.blur();if(this.getView()=='issue_list')NewIssue.closeForm();var action=list.options[list.options.selectedIndex].value;list.selectedIndex=0;if(action=='')return false;if(action=='set_deployed_resolution'){IssueEditors.setDeployedResolution(page,query);}
if(action=='move_to_project'){IssueEditors.showMoveToProject();}
if(action=='export_csv'){this.exportToCsv();}
if(action=='import'){var importUrl="/tasks/import";if(issueList.getProjectId())importUrl='/projects/'+issueList.getProjectId()+importUrl;location.href=importUrl;}
if(action=='taskpad'){this.exportToCsv({showTaskPad:true});}
if(action=='merge'){var mergeTaskForm=$('merge_tasks_form');if(mergeTaskForm){mergeTaskForm.show();}else{IssueEditors.merge(page,query);}}
if(action=='undelete'){this.toolBoxAction('undelete_selected',{},page,query);}
if(action=='new_tag'){var tag_name=Tags.getTagName();if(!tag_name)return false;this.toolBoxAction('new_tag',{tag_name:tag_name},page,query);}
var matches=null;if(matches=action.match(/^apply_tag_(.*)$/)){this.toolBoxAction('apply_tag',{tag_id:matches[1]},page,query);}
if(matches=action.match(/^remove_tag_(.*)$/)){if(matches[1]=="0")return false;this.toolBoxAction('remove_tag',{tag_id:matches[1]},page,query);}
return false;},updateMoreActionsListbox:function(){var selectedTags=this.selectedTags();var elem=$('more_actions');var options=elem.options;if($('remove_tag_group'))
$('remove_tag_group').remove();if(this.isDeletedItemSelected()&&$('undelete_option')){Element.show('undelete_option');}else
Element.hide('undelete_option');if(selectedTags.length>0){var optgroup=document.createElement("optgroup");optgroup.setAttribute('id','remove_tag_group');optgroup.label="Remove Tag";for(i=0;i<selectedTags.length;i++){var new_option=document.createElement('option');new_option.appendChild(document.createTextNode(tags[selectedTags[i]]));new_option.value='remove_tag_'+selectedTags[i];new_option.className='tag';optgroup.appendChild(new_option);}
elem.appendChild(optgroup);}},isDeletedItemSelected:function(){var selectedItems=[];var view=this.getView();if(view=='task_details'){return false;}else{selectedItems=issueList.selectedItems();}
for(var i=0;i<selectedItems.length;i++){if($$('#issue_description_'+selectedItems[i]+' span.deleted_notice').length>0){return true;}}
return false;},selectedTags:function(selected){var selectedItems=[];var view=this.getView();if(view=='task_details'){selectedItems=[$('issue_number').innerHTML];}else{selectedItems=issueList.selectedItems();}
var selectedTags=[];for(var i=0;i<selectedItems.length;i++){var ids=taskActions.getTaskTagIds(selectedItems[i]);for(var j=0;j<ids.length;j++){if(!selectedTags.include(ids[j])){selectedTags[selectedTags.length]=ids[j];}}}
return selectedTags;},toolBoxAction:function(action,params,page,query){var view=this.getView();var selectedItems=[];if(view=='task_details'){params.selected_issues=$('issue_number').innerHTML;selectedItems=[params.selected_issues];}else{selectedItems=issueList.selectedItems();params.selected_issues=selectedItems.toString();}
if(action=='undelete_selected'){var message='Are you sure you want to undelete selected issue';if(selectedItems.length>1)message=message+'s';if(!confirm(message+'?'))return false;}
params.view=view;params.page=page;params.query=query;params.toolbox_action=action;if(issueList.getProjectId())params.project_id=issueList.getProjectId();new Ajax.Request('/issues/'+action,{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});return false;},getView:function(){var viewContainer=$('view');if(viewContainer&&viewContainer.innerHTML=='task_details')return'task_details';return'issue_list';},showTaskDetails:function(issueNumber){var url='/tasks/'+issueNumber;if(pageProperties.projectId)url='/projects/'+pageProperties.projectId+url;location.href=url;},analyzeIssue:function(){var issue=IssuesCursor.issueAtCursor();if(!issue)return;var url='/analytics/ad-hoc?issues='+issue;var projectId=issueList.getProjectId();if(projectId)url='/projects/'+issueList.getProjectId()+url;location.href=url;},analyzeSelectedIssues:function(){var issues=issueList.selectedItems();if(issues.length==0){Flash.showMessage('No tasks have been selected.');return;}
var url='/analytics/ad-hoc?issues='+issues.join(',');var projectId=issueList.getProjectId();if(projectId)url='/projects/'+issueList.getProjectId()+url;location.href=url;},prepareAnalyzeTasksLink:function(id){var selection=issueList.selectedItems();var location='';if(!id&&(selection.length==0)){Flash.showMessage('No issues have been selected.');return;}
var projectUrl='';if(issueList.getProjectId())
projectUrl='/projects/'+issueList.getProjectId();if((selection.length>0)&&(selection.include(id)))
location=projectUrl+'/analytics/ad-hoc?issues='+selection.join(',');else
location=projectUrl+'/analytics/ad-hoc?issues='+id;return location;},showCommentForm:function(mode,issue_id){NewIssue.closeForm();CommentDialog.show(mode,{issueId:issue_id});},showUploadForm:function(id){if(pageProperties.projectId){location.href='/projects/'+pageProperties.projectId+'/attachments/new?issue='+id;}else{location.href='/attachments/new?issue='+id;}},addToWatchList:function(issueId,selected_users){selected_users=selected_users||$F('users_for_issue_watch_list').toString();Spinner.show();new Ajax.Request('/issues/add_to_watch_list/'+issueId,{asyncronous:true,evalScripts:true,parameters:{selected_users:selected_users,selector:$('users_for_issue_watch_list_filter').value}});},removeFromWatchList:function(issueId,selected_users){selected_users=selected_users||$F('issue_watch_list').toString();Spinner.show();new Ajax.Request('/issues/remove_from_watch_list/'+issueId,{asyncronous:true,evalScripts:true,parameters:{selected_users:selected_users,selector:$('users_for_issue_watch_list_filter').value}});},exportToCsv:function(options){var selectedIssues=issueList.selectedItems().toString();if((selectedIssues=='')&&(pageProperties.issuesCount>issueList.defaultExportLimit)){if(!confirm('This will load '+pageProperties.issuesCount+' issues. Are you sure?'))return;}
query=issueList.getCurrentQuery();var projectId='';if(issueList.getProjectId())projectId=issueList.getProjectId();options=options||{showTaskPad:false};var action='/export';if(options.showTaskPad)action='/taskpad';location.href=issueActions.constructUrl(action,projectId,query,selectedIssues,pageProperties.page);},constructUrl:function(action,projectId,query,selectedIssues,page){var url='';if(this.actionsRoutedToTasks.include(action)){url=url+'/tasks';}else{url=url+'/issues';}
var params={};if(projectId!='')url='/projects/'+projectId+url;if(selectedIssues!='')params['selected']=selectedIssues.toString();if(query!='')params['query']=query;if(page>0)params['page']=page
return url+action+'?'+$H(params).toQueryString();}}
var initIssueSearchEscObserver=function(){searchBox.init($('query'));}
document.observe('dom:loaded',initIssueSearchEscObserver);var SearchForm={toggleOptions:function(type,mode){var arrow=$('as_more_arrow');var form=$('as_more_form');if(form.hasClassName('hidden')){arrow.removeClassName('sprite-right_arrow').addClassName('sprite-down_arrow');;form.removeClassName('hidden');}else{arrow.removeClassName('sprite-down_arrow').addClassName('sprite-right_arrow');form.addClassName('hidden');}}}
var IssueEditors={showEditor:function(field,number,value){var displayName='issue_'+field+'_'+number;var editorName='issue_'+field+'_editor_'+number;if(typeof(value)=='undefined')
value=this.getField(field,number);var editor=taskEditors.showDynamicEditor(displayName,editorName,field,value,'issue_');editor.number=number;},hideEditor:function(field,number){var displayName='issue_'+field+'_'+number;var editorName='issue_'+field+'_editor_'+number;taskEditors.hideEditorElement(field,displayName,editorName,'issue_');if((field=='due_date')&&(typeof(calendar)!='undefined'))
calendar.hide();observersManager.restore();},onChangeObserver:function(event,elem){if(elem.lastKeydownAt&&new Date().getTime()-elem.lastKeydownAt<=10){return;}
elem.blur();},updateField:function(element,field,number){var value=element.value;this.hideEditor(field,number);if((value==element.old_value)||((field=='due_date')&&(value=='yyyy-mm-dd')))return;var unsatisfiedDeps=false;var changingStatusOfVerifiedTask=false;var closedStatuses=$('closed_statuses').innerHTML.strip().split(',');if(field=='status'&&closedStatuses.indexOf(value)>=0&&closedStatuses.indexOf(element.old_value)==-1&&$('unsatisfied_deps_for_'+number)&&$('unsatisfied_deps_for_'+number).innerHTML=='true')
unsatisfiedDeps=true;if($('issue_resolution_'+number)){var currentResolution=$('issue_resolution_'+number).firstChild.innerHTML.replace(/\u200B/g,'').unescapeHTML();if(field=='status'&&currentResolution=='Verified')
changingStatusOfVerifiedTask=true;}
if((unsatisfiedDeps&&!confirm("This task has unsatisfied dependencies.\nDo you still want to close it?"))||(changingStatusOfVerifiedTask&&!confirm("You are changing the status of verified task.\nIf you continue, the task will be unverified."))){taskEditors.updateDisplayElement('issue_'+field+'_'+number,element.old_value);return;}
this.showIssueSpinner(number);var params={number:number,field:field,view:issueActions.getView(),value:value,old_value:element.old_value}
if(params.view=='issue_list'&&$('checkbox_'+number).checked){params.selected=number;}
if((/^(description|estimate|remaining)$/).test(field)){IssueEditors.hideEditor(field,number);}
this.resetDynamicEditor(field);new Ajax.Request('/issues/update',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(){observersManager.restore();}});},resetDynamicEditors:function(number){var container=$('dynamic_vault');dynamic_editor_ids=['issue_dynamic_description_editor','issue_dynamic_owner_editor','issue_dynamic_status_editor','issue_dynamic_resolution_editor','issue_dynamic_estimate_editor','issue_dynamic_remaining_editor','issue_dynamic_priority_editor','issue_dynamic_severity_editor','issue_dynamic_business_owner_id_editor','issue_dynamic_qa_owner_id_editor','issue_dynamic_due_date_editor'];dynamic_editor_ids.each(function(id){var editor=$(id);if(!number||editor.number==number){var containerId=editor.parentNode.id;if(containerId.match(/_editor_/)){var linkId=containerId.replace('_editor','');$(linkId).removeClassName('hidden');}
container.appendChild(editor);}});container.appendChild($('itemmenu'));},resetDynamicEditor:function(editor){$('dynamic_vault').appendChild($('issue_dynamic_'+editor+'_editor'));},getField:function(field,number){var fieldLabel=$('issue_'+field+'_'+number);if(!fieldLabel)return null;if(field=='description'){return taskList.extractDescriptionText(fieldLabel.firstChild.firstChild.nextSibling.innerHTML);}else if(field=='estimate'||field=='remaining'){return fieldLabel.firstChild.innerHTML.replace(/\u200B/g,'').unescapeHTML()}else if(field=='status'||field=='owner'||field=='resolution'){var value=$('issue_'+field+'_'+number+'_value').innerHTML
if(value=='null'){value=null;return value;}else{return parseInt(value);}}else if(field=='priority'||field=='severity'){var html=fieldLabel.firstChild.innerHTML;if(html==='-')return 0;return parseInt(fieldLabel.firstChild.innerHTML.match(/(\d+)$/)[1])}
return null;},showIssueSpinner:function(number){var loading=null;if($('loading_issue')){var loading=$('loading_issue').cloneNode(true);loading.setAttribute('id','issue_spinner_'+number);$$('tr#issue_'+number+' td.cursor')[0].appendChild(loading);Element.show(loading);}
return loading},hideIssueSpinner:function(number){var spinner=$('issue_spinner_'+number);if(spinner)Element.remove(spinner);},copyToSprint:function(page,query,sprintId){if(!sprintId){var sprintSelector=$('sprint_selector');sprintId=sprintSelector[sprintSelector.selectedIndex].value;if(parseInt(sprintId)<=0)return;}
if(!sprintId)
return;Spinner.show("Copying issues to sprint...");var params={sprint_id:sprintId,view:issueActions.getView()}
if(params.view=='task_details'){var sprintRow=IssueEditors.getSprintRadioValue();if(sprintRow){params.task_id=sprintRow.taskId;}
params.selected=$('issue_number').innerHTML;}else{params.selected=issueList.selectedItems().toString();params.page=page;params.query=unescape(query);}
new Ajax.Request('/issues/copy_to_sprint',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(request){Spinner.hide();}});},moveToSprint:function(page,query,sprintId,fromTaskId){if(!sprintId){var sprintSelector=$('sprint_selector');sprintId=sprintSelector.getValue();if(parseInt(sprintId)<=0)return;}
if(!sprintId)
return;Spinner.show("Moving tasks to sprint...");var params={sprint_id:sprintId,view:issueActions.getView(),page:page,query:unescape(query)};if(params.view=='task_details'){if(fromTaskId){params.from_task_id=fromTaskId;}
params.selected=$('issue_number').innerHTML;}else{params.selected=issueList.selectedItems().toString();}
new Ajax.Request('/issues/move_to_sprint',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(request){Spinner.hide();}});},moveFromSprintToSprint:function(page,query,sprintId){if(!sprintId){var sprintSelector=$('sprint_selector');sprintId=sprintSelector.getValue();if(parseInt(sprintId)<=0){return;}}
if(!sprintId){return;}
var sprintRow=IssueEditors.getSprintRadioValue(),taskId=(sprintRow)?(sprintRow.taskId):null;if(sprintRow.sprintId==sprintId){Flash.showMessage("Cannot move into the same sprint.");return;}
IssueEditors.moveToSprint(page,query,sprintId,taskId);},removeFromSprint:function(showConfirm){var sprintRow=IssueEditors.getSprintRadioValue();if(!sprintRow){Flash.showMessage("No sprints selected.");return;}
var message='Are you sure you want to remove this task from "'+sprintRow.sprintName+'" sprint?',spinnerMessage='deleting task...',requestLink='/issues/remove_from_sprint'
if(showConfirm){if(!confirm(message))return false;requestLink='/issues/confirm_remove_from_sprint'}
var params={view:'task_details',sprint:sprintRow.sprintId,selected:sprintRow.taskId};var project_id=taskList.getProjectId();if(project_id){params.project_id=project_id;}
new Ajax.Request(requestLink,{parameters:params,asynchronous:true,evalScripts:true,onLoading:function(){Spinner.show(spinnerMessage)},onComplete:function(){Spinner.hide();}})},removeFromFirstSprint:function(page,query){if(issueList.selectedItems().length==0){Flash.showMessage("No tasks selected.");return;}
if(!confirm("Are you sure you want to remove selected tasks from from their sprints?")){return;}
Spinner.show("Deleting tasks from first sprint...");var params={view:issueActions.getView()};params.selected=issueList.selectedItems().toString();params.page=page;params.query=query;new Ajax.Request('/issues/remove_from_first_sprint',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(request){Spinner.hide();}});},showMoveToProject:function(){$('move_to_project_dialog').removeClassName('hidden');},hideMoveToProject:function(){$('move_to_project_dialog').addClassName('hidden');},moveToProject:function(page,query,projectId){if(!projectId){var selector=$('move_to_project_selector');if(selector.selectedIndex==0)
return;projectId=selector[selector.selectedIndex].value;}
if(!projectId)return;this.hideMoveToProject();Spinner.show();var params={project_to_move_id:projectId,selected:issueList.selectedItems().toString(),page:page,query:query}
if(issueList.getProjectId())params.project_id=issueList.getProjectId();new Ajax.Request('/issues/move_to_project',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(request){Spinner.hide();selector.selectedIndex=0;}});},setDeployedResolution:function(page,query){Spinner.show();var params={selected:issueList.selectedItems().toString(),page:page,query:query};if(issueList.getProjectId())
params.project_id=issueList.getProjectId();new Ajax.Request('/issues/set_deployed_resolution',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(request){Spinner.hide();}});},merge:function(page,query){Spinner.show();var params={selected:issueList.selectedItems().toString(),page:page,query:query};if(issueList.getProjectId())
params.project_id=issueList.getProjectId();new Ajax.Request('/issues/merge',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(request){Spinner.hide();}});},toggleSprintRadio:function(taskId){$('issue_tasks_row_'+taskId).checked=true;},getSprintRadioValue:function(){var sprintList=$('sprintlist'),result=false;sprintList.getElementsBySelector('tr.task_item').each(function(sprintRow){var item=sprintRow.down('input[type="radio"]');if(item.checked){result={taskId:item.getValue(),sprintId:sprintRow.down('input.issue_sprints').getValue(),sprintName:sprintRow.down('a.sprint_name_link').innerHTML}
return;}});return result;}}
var IssuesCursor={init:function(){var current=this.issueAtCursor();if(current){this.hideCursor($(current.toString()));}
var elements=this.elements();var cookie=readCookie(this.cursorName())||'';if(cookie.length>0){var parsed=cookie.match(new RegExp('(^|\\s)'+this.cursorKey()+'=(-?[0-9]*)'));if(parsed&&parsed[2]){if(parsed[2]=='-1'){this.showCursor(elements[elements.length-1]);return;}
if(issueList.row(parsed[2])){this.setIssueAtCursor(parsed[2]);return;}}}
this.showCursor(elements[0]);},cursorName:function(){return'issues_cursor';},cursorKey:function(){if(pageProperties.projectId)
return pageProperties.projectId;else
return'org';},findPos:function(element){return windowHelper.findPos(element)[1];},issueAtCursor:function(){return this.idAtCursor();},selectCurrentRow:function(){var issue=this.issueAtCursor()
if(issue){issueList.toggle(issueList.row(issue));}}}
Object.extend(IssuesCursor,GenericCursor);Object.extend(IssuesCursor,{placeCursor:function(elements,direction){var currentPage=$$('div.pagination span.current')[0]?parseInt($$('div.pagination span.current')[0].innerHTML):1;var nextPage=direction==Direction.Forward?currentPage+1:currentPage-1;var totalPages=parseInt($('total_pages_count').innerHTML);if((nextPage>0)&&(nextPage<=totalPages)){observersManager.save();if(direction==Direction.Back){this.setCursorCookie(false,-1);}
if(direction==Direction.Back)
location.href=$$('div.pagination a.prev_page')[0].href;else
location.href=$$('div.pagination a.next_page')[0].href;return;}
var place=direction==Direction.Forward?elements.length-1:0;if(elements[place]){this.showCursor(elements[place]);}},setIssueAtCursor:function(issueId){var current=this.issueAtCursor()
if(current)
this.hideCursor($(current.toString()))
this.showCursor($(issueId.toString()),CursorActivation.None)}});var NewIssue={focusField:'issue_description',insertIssue:function(){if(Element.visible('new_issue_form')){this.closeForm();}else{this.resetForm();var numColumns=$('tasklist').rows[0].cells.length;Element.insert($('issues'),{top:'<tr class="nohover" id="new_form_row">'+'<td colspan="4"></td>'+'<td class="new_form_col" id="new_form_col" colspan="'+(numColumns-2)+'"/>'+'</tr>'});var form=$('new_issue_form');$('new_form_col').appendChild(form);this.showForm();}},closeForm:function(){this.hideForm();this.clearForm();},showForm:function(){Element.show('new_issue_form');$('show_hide_new_issue').value='Hide Form'
Field.focus('issue_description');DialogManager.registerDialog(this);},hideForm:function(){Element.hide('new_issue_form');this.resetForm();$('show_hide_new_issue').value='New Task';if($('errorExplanation'))Element.remove('errorExplanation');var descriptionEl=$('issue_description');var errorsEl=descriptionEl.parentNodel;if(errorsEl&&errorsEl.className=='fieldWithErrors'){errorsEl.parentNode.insertBefore(descriptionEl,errorsEl);Element.remove(errorsEl);}
DialogManager.unregisterDialog(this);},resetForm:function(){var form=$('new_issue_form')
var form_container=$('new_issue_form_container')
if(form.parentNode!=form_container){form_container.appendChild(form)
if($('new_form_row'))Element.remove('new_form_row')}
this.collapseMoreSection();},clearForm:function(){$('issue_description').setValue('');$('issue_current_estimate').setValue('');if($('issue_inline_due_date'))$('issue_inline_due_date').setValue('');$('issue_current_status').selectedIndex=0;$('issue_current_owner').selectedIndex=0;if($('issue_wiki')){$('issue_wiki').setValue('');}},save:function(){document.new_issue_form.onsubmit()},cancel:function(){this.closeForm();},more:function(){this.moreSectionExpanded()?this.collapseMoreSection():this.expandMoreSection();},collapseMoreSection:function(){var form=$('new_issue_form_more');if(!form)return;if(form.hasClassName('hidden'))return;var arrow=$('new_issue_form_more_arrow');var state=$('new_issue_form_expanded');arrow.removeClassName('sprite-down_arrow').addClassName('sprite-right_arrow');form.addClassName('hidden');state.value='false';},expandMoreSection:function(){var form=$('new_issue_form_more');if(!form)return;if(!form.hasClassName('hidden'))return;var arrow=$('new_issue_form_more_arrow');var state=$('new_issue_form_expanded');arrow.removeClassName('sprite-right_arrow').addClassName('sprite-down_arrow');;form.removeClassName('hidden');state.value='true';},moreSectionExpanded:function(){return!$('new_issue_form_more').hasClassName('hidden');}}
var UserSelector={refreshSourceList:function(sourceId,targetId,selector){Spinner.show();new Ajax.Updater(sourceId+'_container','/projects/select_users',{asyncronous:true,evalScripts:true,parameters:{selector:selector.value,users_in_target:this.getAllUserIds($(targetId)).join(','),source_id:sourceId,target_id:targetId},onComplete:function(){Spinner.hide();UserSelector.enableDisableButtons(sourceId,targetId,$(sourceId));}});},getAllUserIds:function(selector){var userIds=[]
var options=selector.options;for(i=0;i<options.length;i++){var option=options[i];if(option.value!=0)userIds[userIds.length]=option.value;}
return userIds;},getAvailableUserIds:function(selector){var userIds=[]
var options=selector.options;for(i=0;i<options.length;i++){var option=options[i];if(option.value!=0&&!option.disabled)userIds[userIds.length]=option.value;}
return userIds;},enableDisableButtons:function(sourceId,targetId){var button=$(sourceId+'_button');button.disabled=($F(sourceId).length==0);button=$(targetId+'_button');button.disabled=($F(targetId).length==0);},toggleForm:function(targetId){var form=$(targetId+'_form');if(form.style.display=='none'){$(targetId+'_arrow').className='user_selector_arrow sprite-down_arrow';Element.show(form);}else{$(targetId+'_arrow').className='user_selector_arrow sprite-right_arrow';Element.hide(form);}}}
var UserSettings={enableDisableForm:function(id,enabled){var form=$(id);if(enabled){form.className='';}else{form.className='disabled';}
var inputs=form.getElementsByTagName("input");for(var i=0;i<inputs.length;i++){inputs[i].disabled=!enabled;}},updateNotificationForm:function(){var email_checkbox=$('user_news_feed_by_email');this.enableDisableForm('email_notification_settings',email_checkbox.checked);}}
var SyncronizationSettings={toggleForm:function(){var form=$('syncronization_form');if(form.style.display=='none'){$('syncronization_form_toggle_arrow').className='sprite-down_arrow';Element.show(form);}else{$('syncronization_form_toggle_arrow').className='sprite-right_arrow';Element.hide(form);}}}
var Filters={process:function(){var selector=$('saved_filters_selector');var value=selector.options[selector.selectedIndex].value;if(value=='')return;if(value=='_all_issues_')value='';if(value=="_save_as_widget_"){this.saveAsWidget();return;}else if(value=="_save_current_filter_"){this.newFilter();return;}else if(matches=value.match(/^_manage_filters_(.*)$/)){selector.selectedIndex=0;if(genericList.getProjectId()){location.href="/projects/"+genericList.getProjectId()+"/"+matches[1]+"/filters";}else{location.href="/"+matches[1]+"/filters";}}else{var currentQuery=$('query').value;var newQuery=value.replace(/__QUOTE__/g,'"');if(currentQuery==newQuery)return false;$('query').value=newQuery;$('filter_form').submit();}},newFilter:function(){$('saved_filters_selector').selectedIndex=0;filter=$('query').value;var name=this.getName('filter');if(!name)return false;new Ajax.Request('/filters/create/',{asynchronous:true,evalScripts:true,parameters:{name:name,filter:filter},onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});return false;},saveAsWidget:function(){$('saved_filters_selector').selectedIndex=0;var filter=$('query').value;var widget_name=this.getName('dashboard widget');if(!widget_name)return false;var form=$('create_from_filter_form');$('create_from_filter_name').value=widget_name;$('create_from_filter_query').value=filter;form.submit();return false;},getName:function(objectName){var name=prompt("Please enter "+objectName+" name:",'');if(!name)return false;if(name==''){Flash.showMessage('Please enter '+objectName+' name');return false;}
return name;},checkIfCanBeSaved:function(){var selector=$('saved_filters_selector');for(var i=0;i<selector.options.length;i++){var option=selector.options[i];if(option.value=='_save_current_filter_'||option.value=='_save_as_widget_'){if($('query').value==''){option.disabled='disabled';}else{option.disabled='';}}}}}
var FilterView={newFilter:function(){this.hideForm();var form=$('saved_filter_form_container');var container=$('filters_list');$('saved_filter_id').value='';$('saved_filter_name').value='';$('saved_filter_filter').value='';container.insertBefore(form,container.firstChild);var noTasksRow=container.getElementsByClassName('no_filters')[0];if(noTasksRow){noTasksRow.hide();}
this.showForm();},editFilter:function(id){this.hideForm();var filter_container=$('filter_'+id);var form=$('saved_filter_form_container');$('saved_filter_id').value=id;$('saved_filter_name').value=$('filter_'+id+'_name').innerHTML;$('saved_filter_filter').value=$('filter_'+id+'_filter').innerHTML;filter_container.parentNode.insertBefore(form,filter_container);Element.hide(filter_container);this.showForm();},shareFilter:function(id){new Ajax.Request('/filters/share',{asynchronous:true,evalScripts:true,parameters:{id:id},onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});},deleteFilter:function(id){if(!confirm('Are you sure you want to delete filter '+$('filter_'+id+'_name').innerHTML))return false;new Ajax.Request('/filters/delete',{asynchronous:true,evalScripts:true,parameters:{id:id},onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});},showForm:function(){Element.show('saved_filter_form_container');$('saved_filter_name').focus();},hideForm:function(){var trs=$('filters_list_table_container').getElementsByTagName('tr');for(var i=0;i<trs.length;i++){Element.show(trs[i]);}
Element.hide('saved_filter_form_container');}}
var DashboardConfig={newWidget:function(){this.hideForm();var form=$('widget_form_container');var container=$('widgets_list');$('widget_id').value='';$('widget_name').value='';$('widget_query').value='';container.insertBefore(form,container.firstChild);var noTasksRow=container.getElementsByClassName('no_filters')[0];if(noTasksRow){noTasksRow.hide();}
this.showForm();},editWidget:function(id){this.hideForm();var container=$('widget_'+id);var form=$('widget_form_container');$('widget_id').value=id;$('widget_name').value=$('widget_'+id+'_name').innerHTML.unescapeHTML();$('widget_query').value=$('widget_'+id+'_query').innerHTML.unescapeHTML();container.parentNode.insertBefore(form,container);Element.hide(container);this.showForm();},shareWidget:function(id){new Ajax.Request('/dashboard/share_widget',{asynchronous:true,evalScripts:true,parameters:{id:id},onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});},deleteWidget:function(id){if(!confirm('Are you sure you want to delete '+$('widget_'+id+'_name').innerHTML+' widget'))return false;new Ajax.Request('/dashboard/delete_widget',{asynchronous:true,evalScripts:true,parameters:{id:id},onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});},showForm:function(){Element.show('widget_form_container');$('widget_name').focus();},hideForm:function(){var trs=$('widgets_table_container').getElementsByTagName('tr');for(var i=0;i<trs.length;i++){Element.show(trs[i]);}
Element.hide('widget_form_container');},init:function(){this.updateWidgetsSelector();var columns=document.getElementsByClassName('dashboard_column');for(var i=0;i<columns.length;i++){var column=columns[i];Sortable.create(column,{containment:columns,constraint:null,dropOnEmpty:true,starteffect:function(){},reverteffect:function(){},endeffect:function(element){element.style.top='auto';element.style.left='auto';},onUpdate:function(element){}});}},updateWidgetsSelector:function(){var selector=$('widgets_to_add');var options=selector.getElementsByTagName("option");for(var i=options.length-1;i>=0;i--){selector.removeChild(options[i]);}
var widgets=$$('#hidden_dashboard_column li.dashboard_widget');if(widgets.length==0){var new_option=document.createElement('option');new_option.text=new_option.innerHTML='All widgets are already added';new_option.value='';selector.appendChild(new_option);selector.disabled='disabled';$('widgets_to_add_button').disabled='disabled';}else{for(var i=0;i<widgets.length;i++){var widget=widgets[i];var new_option=document.createElement('option');new_option.text=new_option.innerHTML=widget.getElementsByTagName('strong')[0].innerHTML.unescapeHTML();new_option.value=widget.id;selector.appendChild(new_option);}
selector.disabled='';$('widgets_to_add_button').disabled='';}},addWidget:function(){var selector=$('widgets_to_add');var widget_id=selector.options[selector.selectedIndex].value;var widget=$(widget_id);$('dashboard_column2').appendChild(widget);this.updateWidgetsSelector();this.init();},removeWidget:function(widget_id){var widget=$('dashboard_widget_'+widget_id);$('hidden_dashboard_column').appendChild(widget);this.init();},saveLayout:function(){new Ajax.Request('/dashboard/save_layout',{asynchronous:true,evalScripts:true,parameters:Sortable.serialize('dashboard_column1')+'&'+Sortable.serialize('dashboard_column2'),onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});}}
var Announcements={backUrl:"",init:function(backUrl){this.backUrl=backUrl;DialogManager.registerDialog(this);},save:function(){this.selectPlansForSubmit();$('export_announcement').value="";document.announcement_form.submit();},cancel:function(){window.location.href=this.backUrl;},exportToMigration:function(){this.selectPlansForSubmit();$('export_announcement').value="true";document.announcement_form.submit();},preview:function(){new Ajax.Request('/announcements/preview',{asyncronous:true,evalScripts:true,parameters:{title:$('announcement_title').value,wiki:$('announcement_wiki').value},onLoading:function(){Spinner.show()},onComplete:function(){Spinner.hide()}});},dismiss:function(post_id,options){options=options||{};params={id:post_id};if(options.list){this.markAsRead(post_id);}else{$('announcement-'+post_id).addClassName('hidden');}
new Ajax.Request('/announcements/dismiss',{asynchronous:true,evalScripts:true,parameters:params});},markAsRead:function(post_id){if(!$('dismiss-link-'+post_id))return;$('announcement-title-'+post_id).removeClassName('unread');$('dismiss-link-'+post_id).addClassName('hidden');},hideVotePanel:function(post_id,val){$('vote-'+post_id).addClassName('hidden');$('vote-more-'+post_id).addClassName('hidden');var result='';if(val==-1){result="Dislike it"}else if(val==0){result="Don't care"}else if(val==1){result="Like it"}
var voteResultPanel=$('vote-result-'+post_id);voteResultPanel.innerHTML=voteResultPanel.innerHTML+' '+result;voteResultPanel.removeClassName('hidden');},vote:function(post_id,val,options){options=options||{more:false};var form=null;if(options['more']){form=$('vote-form-'+post_id);var votes=$$('#vote-form-'+post_id+' input[type=radio]')
for(var i=0;i<votes.length;i++){if(votes[i].checked)val=votes[i].value;}}
if($('announcements')){Announcements.markAsRead(post_id);Announcements.hideVotePanel(post_id,val);}else{$('announcement-'+post_id).addClassName('hidden');}
var params={vote:val};if(options['more'])params.details=form.more.value;new Ajax.Request('/announcements/vote/'+post_id,{asyncronous:true,evalScripts:true,parameters:params});},showMore:function(post_id){var dialog={id:'vote-more-'+post_id,focusField:'more-'+post_id,save:function(){DialogManager.unregisterDialog(this);Announcements.vote(post_id,null,{more:true});},cancel:function(){this.hide();},show:function(){DialogManager.registerDialog(this);$('vote-'+post_id).addClassName('hidden');$('vote-more-'+post_id).removeClassName('hidden');Field.focus(dialog.focusField);},hide:function(){DialogManager.unregisterDialog(this);$('vote-'+post_id).removeClassName('hidden');$('vote-more-'+post_id).addClassName('hidden');}}
var inputs=$(dialog.id).getElementsByTagName('input');inputs[3].onclick=dialog.save;inputs[4].onclick=dialog.hide;dialog.show();},addPlans:function(){this.moveOptions('available_pricing_plans','pricing_plans');},removePlans:function(){this.moveOptions('pricing_plans','available_pricing_plans');},moveOptions:function(from,to){var fromOptions=$(from).options;var toOptions=$(to).options;var optionsToMove=[];for(var i=fromOptions.length-1;i>=0;i--){if(fromOptions[i].selected){optionsToMove.push(fromOptions[i]);fromOptions[i]=null;}}
for(var i=optionsToMove.length;i>=0;i--){toOptions[toOptions.length]=optionsToMove[i];}},selectPlansForSubmit:function(){var planOptions=$('pricing_plans').options;for(var i=0;i<planOptions.length;i++){planOptions[i].selected=true;}},togglePricingPlansSelector:function(checkbox){var selector=$('announcement_pricing_plans_selector');if(checkbox.checked){selector.addClassName('hidden');}else{selector.removeClassName('hidden');}}}
var Teams={newTeam:function(){var teamName=this.getTeamName();if(!teamName)return false;new Ajax.Request('/teams/create',{asynchronous:true,evalScripts:true,parameters:{name:teamName},onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});return false;},renameTeam:function(id,name){var teamName=this.getTeamName(name);if(!teamName)return false;new Ajax.Request('/teams/rename',{asynchronous:true,evalScripts:true,parameters:{id:id,'team[name]':teamName},onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});return false;},deleteTeam:function(id,name){if(!confirm('Are you sure you want to delete team \''+name+'\'?'))
return;new Ajax.Request('/teams/destroy',{asynchronous:true,evalScripts:true,parameters:{id:id},onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});return false;},getTeamName:function(prefilledName){if(!prefilledName)prefilledName='';var teamName=prompt("Please enter team name:",prefilledName);if(!teamName)return false;return teamName;},assignUsersToTeam:function(teamId){Spinner.show();var selectedUsers=$F('users_for_team').toString()
new Ajax.Request('/teams/assign_users/'+teamId,{asyncronous:true,evalScripts:true,parameters:{selected_users:selectedUsers,mode:'add'},onComplete:function(){Spinner.hide()}});},unassignUsersFromTeam:function(teamId){Spinner.show();var selectedUsers=$F('users_in_team').toString()
new Ajax.Request('/teams/assign_users/'+teamId,{asyncronous:true,evalScripts:true,parameters:{selected_users:selectedUsers,mode:'remove'},onComplete:function(){Spinner.hide()}});}}
var rowHintsIE6={hintsCache:{},init:function(nodes){for(var i=0,l=nodes.length;i<l;i++){var row=nodes[i],listener=this.listener.bindAsEventListener(this,row);row.observe('mouseover',listener).observe('mouseout',listener);}},listener:function(event,row){Element.identify(row);this.hintsCache[row.id]=this.hintsCache[row.id]||row.getElementsByClassName('toggler')[0];var hint=this.hintsCache[row.id],target=Event.element(event);while(target&&(target!=row||target!=document.body)){target=target.parentNode;}
if(target===row)return;if(hint){if(hint.hasClassName('toggler_shown')){this.hideHint(hint);}else{this.showHint(hint);}}},showHint:function(hint){hint.addClassName('toggler_shown');},hideHint:function(hint){hint.removeClassName('toggler_shown');}}
if(navigator.userAgent.match(/MSIE 6\.0/)){document.observe('dom:loaded',function(){rowHintsIE6.init(document.getElementsByClassName('toggler_row'));});}
var Analytics={selectDates:function(url_template){var startDate=$('start_date').value;var endDate=$('end_date').value;window.location.href=url_template.replace('start_date=START_DATE','start_date='+startDate).replace('end_date=END_DATE','end_date='+endDate);},filterSelection:function(url_template,no_filter_url){selection=genericList.selectedItems();if(selection.length==0)
window.location.href=no_filter_url;else
window.location.href=url_template.replace('filter=FILTER','filter='+selection.join(','));},filterSprintsSelection:function(url_template){var selection=new Array();var list=$('all_sprints_to_analyze');for(var i=0;i<list.length;i++)
{if(list.options[i].selected)
selection.push(list.options[i].value);}
window.location.href=url_template.replace('selected_sprints=SPRINTS','selected_sprints='+selection.join(','));},changeDimension:function(url_template,no_dimension_url){var selector=$('dimension_selector');var dimension=selector.options[selector.selectedIndex].value;if(dimension=='')
window.location.href=no_dimension_url;else
window.location.href=url_template.replace('dimension=DIMENSION','dimension='+dimension);},changeTeam:function(url_template){var selector=$('team_selector');var team=selector.options[selector.selectedIndex].value;window.location.href=url_template.replace('team=TEAM','team='+team);},changeTag:function(url_template){var selector=$('tag_selector');var tag=selector.options[selector.selectedIndex].value;window.location.href=url_template.replace('tag=TAG','tag='+tag);},changeSprint:function(url_template){var selector=$('sprint_selector');var sprint=selector.options[selector.selectedIndex].value;window.location.href=url_template.replace('sprint=SPRINT','sprint='+sprint);},changeOwner:function(url_template){var selector=$('owner_selector');var owner=selector.options[selector.selectedIndex].value;window.location.href=url_template.replace('owner=OWNER','owner='+owner);},changeCreator:function(url_template){var selector=$('creator_selector');var creator=selector.options[selector.selectedIndex].value;window.location.href=url_template.replace('creator=CREATOR','creator='+creator);},changeProject:function(url_template){var selector=$('project_selector');var project=selector.options[selector.selectedIndex].value;window.location.href=url_template.replace('project=PROJECT','project='+project);},changeCapitalization:function(url_template){var selector=$('capitalization_selector');var capitalization=selector.options[selector.selectedIndex].value;window.location.href=url_template.replace('capitalization=CAPITALIZATION','capitalization='+capitalization);},filterSprintsList:function(){var filterBox=$('sprints_filter');var listBox=$('all_sprints_to_analyze');var filter=filterBox.value;if(filter&&filter!=''){for(var i=0;i<listBox.options.length;i++){var opt=listBox.options[i];if(!opt.readAttribute('value'))
continue;if(!opt.text.match(new RegExp(filter,"i")))
Element.hide(opt);else
Element.show(opt);}}else{for(var i=0;i<listBox.options.length;i++){var opt=listBox.options[i];Element.show(opt);}}},selectAllVelocityDetails:function(state){var checkboxes=$$('input.row_detail');for(var i=0;i<checkboxes.length;i++){var checkbox=checkboxes[i];checkbox.checked=state;}},dateFormat:"%Y-%m-%d",calendarStart:'',calendarEnd:'',setupCalendars:function(){this.calendarStart=Date.parseDate($('start_date').value,this.dateFormat);this.calendarEnd=Date.parseDate($('end_date').value,this.dateFormat);},disallowDateInCalendar:function(date){date.setHours(0,0,0,0);if(Analytics.calendarStart&&Analytics.calendarStart>date)
return true;return false;},setEndDateInCalendar:function(cal){var date=cal.date;Analytics.calendarEnd=new Date(cal.date);Analytics.calendarEnd.setHours(0,0,0,0);},setStartDateInCalendar:function(cal){var date=cal.date;Analytics.calendarStart=new Date(cal.date);Analytics.calendarStart.setHours(0,0,0,0);if(Analytics.calendarEnd<Analytics.calendarStart){Analytics.calendarEnd=Analytics.calendarStart;if($('end_date'))
$('end_date').value=Analytics.calendarStart.print(Analytics.dateFormat);}},submitCustomGraphModeSelector:function(url_template){var checkboxes=document.getElementsByClassName('custom-chart-mode-checkbox');var modes=[];for(i=0,l=checkboxes.length;i<l;i++){var checkbox=checkboxes[i];if(checkbox.checked)
modes.push(checkbox.name);}
window.location.href=url_template.replace('chart_mode=MODE','chart_mode='+modes.join('+'));}}
var AnalyticsPopups={showPopup:function(element,event){var popup=$('analytics_popup');if(Element.visible(popup))
this.hidePopup();popup.addClassName('analytics_popup_shown');popup.style.left=Event.pointerX(event)+"px";popup.style.top=Event.pointerY(event)+"px";popup.getElementsByClassName('dataset')[0].innerHTML=element.getAttribute('dataset');popup.getElementsByClassName('label')[0].innerHTML=element.getAttribute('label').replace('\n','<br/>');popup.getElementsByClassName('value')[0].innerHTML=element.getAttribute('value');},hidePopup:function(){var popup=$('analytics_popup');popup.removeClassName('analytics_popup_shown');}}
var DialogManager={dialogs:$A(),addDialog:function(dialog){if(this.isShown(dialog)){this.flashHeader(dialog);}else{this.registerDialog(dialog);Element.show(dialog.id);this.focus(dialog);}},registerDialog:function(dialog){if(!this.isShown(dialog))
this.dialogs.push(dialog);},removeDialog:function(dialog){Element.hide(dialog.id);this.unregisterDialog(dialog);},unregisterDialog:function(dialog){this.dialogs=this.dialogs.without(dialog);},escObserver:function(event){var d=this.dialogs.last();if(d&&d.ignoreEsc)return;if(Event.isEscPressed(event)){Event.stop(event);var target=Event.element(event);if(target)target.blur();setTimeout(this.cancel.bindAsEventListener(this),0);}},focus:function(dialog){if(dialog.focusField)Field.focus(dialog.focusField);},isShown:function(dialog){return this.dialogs.indexOf(dialog)!=-1;},flashHeader:function(dialog){new Effect.Highlight(dialog.id+'_header',{startcolor:'#ffff00',duration:0.5,restorecolor:'#4998d0'});},save:function(event){var dialog=this.dialogs.last();if(dialog)dialog.save();},cancel:function(event){var dialog=this.dialogs.last();if(dialog){dialog.cancel();var prevDialog=this.dialogs.last();if(prevDialog)this.focus(prevDialog);}},more:function(event){var dialog=this.dialogs.last();if(dialog&&dialog.more)dialog.more();}};Event.observe(document,'keydown',DialogManager.escObserver.bindAsEventListener(DialogManager));var FeedbackDialog={id:'feedback_dialog',form:'feedback_form',focusField:'message',show:function(){DialogManager.addDialog(this);return false;},hide:function(){DialogManager.removeDialog(this);return false;},save:function(){this.hide();$(this.form).onsubmit();},cancel:function(){this.hide();},reset:function(){$(this.form).reset();}};var NewTaskDialog={id:'new_task_dialog',form:'new_task_dialog_form',focusField:'new_task_dialog_task_description',inBookmarklet:false,show:function(){if(this.inBookmarklet)
DialogManager.registerDialog(this);else
DialogManager.addDialog(this);return false;},hide:function(){if(this.inBookmarklet){DialogManager.unregisterDialog(this);}else{$(this.focusField).blur();DialogManager.removeDialog(this);}
return false;},save:function(){this.hide();$(this.form).onsubmit();},cancel:function(){this.collapseMoreSection();if(this.inBookmarklet)
window.close();else
this.hide();},reset:function(){$(this.form).reset();this.collapseMoreSection();},collapseMoreSection:function(){var form=$('new_task_dialog_more');if(!form)return;if(form.hasClassName('hidden'))return;var arrow=$('new_task_dialog_more_arrow');var state=$('new_task_dialog_expanded');arrow.removeClassName('sprite-down_arrow').addClassName('sprite-right_arrow');form.addClassName('hidden');state.value='false';},expandMoreSection:function(){var form=$('new_task_dialog_more');if(!form)return;if(!form.hasClassName('hidden'))return;var arrow=$('new_task_dialog_more_arrow');var state=$('new_task_dialog_expanded');arrow.removeClassName('sprite-right_arrow').addClassName('sprite-down_arrow');;form.removeClassName('hidden');state.value='true';},moreSectionExpanded:function(){return!$('new_task_dialog_more').hasClassName('hidden');},more:function(){this.moreSectionExpanded()?this.collapseMoreSection():this.expandMoreSection();return false;}};var ShortcutsHelpDialog={id:'shortcuts_help_dialog',focusField:'popup_dialog_close',show:function(){if(DialogManager.isShown(this))
this.close();else
DialogManager.addDialog(this);return false;},hide:function(){DialogManager.removeDialog(this);return false;},save:function(){this.close();},cancel:function(){this.close();},close:function(){this.hide();}};var CommentDialog={RequestFeedback:0,AddComment:1,GiveFeedback:2,StatusComment:3,EditComment:4,header:function(mode){var headers={};headers[this.RequestFeedback]='Request Feedback';headers[this.AddComment]='Add Comment';headers[this.EditComment]='Edit Comment';headers[this.GiveFeedback]='Give Feedback';headers[this.StatusComment]='Add Status Change Comment';return headers[mode];},cellNumber:function(mode){if(mode==CommentDialog.StatusComment){return 5;}
return 2;},repositionDialog:function(mode,options){var dialog=$(this.id);var cell=this.cellNumber(mode);var pos;if(options){if(options.complementTaskId){pos=windowHelper.findPos(taskList.row(options.complementTaskId).cells[cell]);}else if(options.taskId){pos=windowHelper.findPos(taskList.row(options.taskId).cells[cell]);}else if(options.issueId){pos=windowHelper.findPos(issueList.row(options.issueId).cells[cell]);}else{var iSize=windowHelper.innerSize();pos=[(iSize[0]-Element.getWidth(dialog))/2,(iSize[1]-Element.getHeight(dialog))/2];}
dialog.style.left=Math.min(pos[0],-50+windowHelper.innerSize()[0]-Element.getWidth(dialog))+'px';dialog.style.top=pos[1]+'px';if(window.opera){dialog.focus();}
dialog.style.margin='30px 0 0 0';}else{dialog.style.left=dialog.style.top='';dialog.style.margin='';}},ensureVisible:function(dialog){var pos=windowHelper.findPos(dialog);var bottomY=pos[1]+Element.getHeight(this.id)+Element.getHeight(this.id+'_header');windowHelper.scroll(bottomY,{ensureVisible:true});},id:'comment_form_dialog',form:'comment_form',focusField:'description',formHeader:'comment_form_dialog_header',init:function(mode,options){var dialog=$(this.id);var textField=$(this.focusField);if(options){if(options.taskId){$('issue').value=taskList.getIssueNumber(options.taskId);$('task').value=options.taskId;}else if(options.issueId){$('issue').value=options.issueId;$('task').value=options.complementTaskId;}
textField.value=options.initialText||"";}
if(mode==CommentDialog.RequestFeedback){Element.hide('send_notification_comment_form');Element.show('feedback_comment_form');$('feedback_from_user_id').removeAttribute('disabled');}else if(mode==CommentDialog.AddComment||mode==CommentDialog.EditComment||mode==CommentDialog.StatusComment){Element.show('send_notification_comment_form');Element.hide('feedback_comment_form');$('feedback_from_user_id').disabled='disabled';}
$(this.formHeader).innerHTML=this.header(mode);this.repositionDialog(mode,options);DialogManager.addDialog(this);this.ensureVisible(dialog);if(textField.createTextRange){var range=textField.createTextRange();range.collapse(false);range.select();}else if(textField.selectionStart!=null){var move_cursor_to=textField.value.length;textField.focus();textField.setSelectionRange(move_cursor_to,move_cursor_to);}},show:function(mode,options){if(DialogManager.isShown(this)){if(this.id=='comment_form_dialog'){}
else{DialogManager.flashHeader(this);DialogManager.focus(this);return false}}
this.resetIds();this.init(mode,options);return false;},edit:function(commentId){if(DialogManager.isShown(this)){DialogManager.flashHeader(this);DialogManager.focus(this);return false;}
this.resetIds();this.id+='_'+commentId;this.form+='_'+commentId;this.focusField+='_'+commentId;this.formHeader='comment_form_dialog_'+commentId+'_header';return this.init(CommentDialog.EditComment);},giveFeedback:function(commentId){if(DialogManager.isShown(this)){DialogManager.flashHeader(this);DialogManager.focus(this);return false;}
this.resetIds();this.id='feedback_form_dialog_'+commentId;this.form+='_'+commentId;this.focusField+='_'+commentId;this.formHeader='feedback_form_dialog_'+commentId+'_header';this.setupZIndexHack();return this.init(CommentDialog.GiveFeedback);},hide:function(){$(this.focusField).blur();DialogManager.removeDialog(this);return false;},save:function(){this.hide();$(this.form).onsubmit()},cancel:function(){this.reset();this.hide();},reset:function(){$(this.form).reset()},resetIds:function(){this.id='comment_form_dialog';this.form='comment_form';this.focusField='description';this.formHeader='comment_form_dialog_header';},setupZIndexHack:function(){if(!window.ie)return;if(!$('feedback_for_you_dashboard'))return;var dialog=$(this.id);var element=dialog;revertZ=[];while(!element.hasClassName('dashboard_widget')){if(/\\b(relative|absolute)\\b/.test(element.getStyle('position'))){revertZ.push(element);element.style.zIndex=10;}
element=$(element.parentNode);}
var buttons=dialog.getElementsByTagName('input');for(var i=0;i<buttons.length;i++){Event.observe(buttons[i],'click',function(e){if(revertZ){for(var j=0;j<revertZ.length;j++){revertZ[j].style.zIndex='';}
revertZ=[];}});}}};var DuplicateDialog={id:'duplicate_dialog',form:'duplicate_dialog_form',focusField:'duplicate_related_issue',show:function(options){var dialog=$(this.id);var pos;if(options.issueNumber)
pos=windowHelper.findPos($('issue_status_'+options.issueNumber));else
pos=windowHelper.findPos($('task_status_'+options.taskId));dialog.style.left=pos[0]+'px';dialog.style.top=(pos[1]+30)+'px';$('duplicate_source_id').value=options.issueId;$('duplicate_related_issue').value='';var bottomY=pos[1]+Element.getHeight('duplicate_dialog');windowHelper.scroll(bottomY,{ensureVisible:true});DialogManager.addDialog(this);return false;},hide:function(){DialogManager.removeDialog(this);return false;},save:function(){this.hide();$(this.form).onsubmit();},cancel:function(){this.hide();}};var AttachmentDialog={id:'attachment_form_dialog',form:'attachment_form',focusField:'description',show:function(attachmentId){if(DialogManager.isShown(this)){DialogManager.flashHeader(this);DialogManager.focus(this);return false}
this.resetIds();this.init(attachmentId);return false;},init:function(attachmentId){this.id+="_"+attachmentId;this.form+="_"+attachmentId;this.focusField+="_"+attachmentId;DialogManager.addDialog(this);},hide:function(){DialogManager.removeDialog(this);return false;},save:function(){this.hide();$(this.form).onsubmit();},cancel:function(){this.hide();},reset:function(){$(this.form).reset()},resetIds:function(){this.id='attachment_form_dialog';this.form='attachment_form';this.focusField='description';}};var NewTaskFromWikiDialog={id:'new_task_from_wiki',form:'new_task_from_wiki_form',focusField:'new_task_from_wiki_desc',show:function(){var editor=Wiki.getEditor(),selection=Element.getSelection(editor);$('new_task_from_wiki').getElementsByTagName('textarea')[1].value=selection.text;$('new_task_wiki_container_id').setAttribute('value',Wiki.containerId);$('new_task_wiki_container_start').setAttribute('value',selection.start);$('new_task_wiki_container_end').setAttribute('value',selection.end);var pos=Wiki.getEditor().cumulativeOffset();$('new_task_from_wiki').style.left=(pos[0]+20)+'px';DialogManager.addDialog(this);return false;},hide:function(){DialogManager.removeDialog(this);return false;},save:function(){$(this.form).onsubmit();},cancel:function(){this.hide();$('task[wiki]').value='';$('new_task_wiki_container_id').setAttribute('value','');$('new_task_wiki_container_start').setAttribute('value','');$('new_task_wiki_container_end').setAttribute('value','');Wiki.getEditor().focus();},reset:function(){$(this.form).reset();}};var DueDateDialog={id:'due_date_dialog',form:'due_date_dialog_form',focusField:'issue_due_date',show:function(task_id,view){if(DialogManager.isShown(this)){return false;}
this.dialog=this.dialog||$(this.id);var pos=windowHelper.findPos($('issue_number_for_'+task_id));this.dialog.style.left=pos[0]+'px';this.dialog.style.top=pos[1]+'px';this.issueNumber=this.issueNumber||$('issue_due_date_number')
if(view=='task_list'){this.issueNumber.setValue(taskList.getIssueNumber(task_id));}else{this.issueNumber.setValue(task_id);}
this.issueNumberValue=this.issueNumber.getValue();var issueDueDateOldValueInList=$('issue_due_date_value_'+this.issueNumberValue);var oldValue=issueDueDateOldValueInList?issueDueDateOldValueInList.getValue():'yyyy-mm-dd';this.issueDueDateValue=this.issueDueDateValue||$('issue_due_date');this.issueDueDateValue.setValue(oldValue);var oldValue=issueDueDateOldValueInList?issueDueDateOldValueInList.getValue():'';this.issueDueDateOldValue=this.issueDueDateOldValue||$('issue_due_date_old_value');this.issueDueDateOldValue.setValue(oldValue);this.issueDueDateView=this.issueDueDateView||$('issue_due_date_view');this.issueDueDateView.setValue(view);this.issueDueDateTask=this.issueDueDateTask||$('issue_due_date_task');this.issueDueDateTask.setValue(task_id);DialogManager.addDialog(this);var bottomY=pos[1]+this.dialog.getHeight();windowHelper.scroll(bottomY,{ensureVisible:true});return false;},hide:function(){DialogManager.removeDialog(this);if(typeof calendar!='undefined')
calendar.hide();return false;},save:function(){this.hide();if(this.issueDueDateValue.getValue()!='yyyy-mm-dd')
$(this.form).onsubmit();},cancel:function(){this.hide();}};var TaskPadDialog={id:'task_pad_dialog',form:'task_pad_dialog_form',focusField:'taskpad_data',save:function(){$('task_pad_continue').setValue(0);$('task_pad_dialog_form').submit();},saveAndContinue:function(){$('task_pad_continue').setValue(1);$('task_pad_dialog_form').submit();},cancel:function(){var projectId=Form.Element.getValue('task_pad_project_id');if(Form.Element.getValue('task_pad_type')=='issues'){window.location.href=issueActions.constructUrl('',projectId,Form.Element.getValue('task_pad_query'),Form.Element.getValue('task_pad_selected'),Form.Element.getValue('task_pad_page'));}else{var sprintId=Form.Element.getValue('task_pad_sprint_id');var url='/projects/'+projectId+'/sprints/'+sprintId+'/show';var selected=Form.Element.getValue('task_pad_selected');if(selected!='')url=url+'?selected='+selected;window.location.href=url;}}};var sprintForm={toggleSprintType:function(type,allowEndDateForBacklogs){this.sprintStartHolder=this.sprintStartHolder||$('sprint_start_holder');this.sprintEndDateHolder=this.sprintEndDateHolder||$('sprint_end_date_holder');if(type=='Backlog'){this.sprintStartHolder.addClassName('hidden');this.sprintStartHolder.down('input').disabled=true;if(!allowEndDateForBacklogs){this.sprintEndDateHolder.addClassName('hidden');this.sprintEndDateHolder.down('input').disabled=true;}}else{this.sprintStartHolder.removeClassName('hidden');this.sprintStartHolder.down('input').disabled=false;this.sprintEndDateHolder.removeClassName('hidden');this.sprintEndDateHolder.down('input').disabled=false;}}}
var SprintList={};Object.extend(SprintList,genericList);Object.extend(SprintList,{row:function(sprintId){return $('sprint_'+sprintId)},getId:function(element){if(element==null)return null
while(element.nodeName!='TR')
element=element.parentNode
if(element&&element.nodeName=='TR'){var id=parseInt(element.id.substr(7,100))
return isNaN(id)?null:id}
return null},selectAll:function(state){var rows=$('sprintlist_table').tBodies[0].rows;for(var i=0;i<rows.length;i++){this.select(rows[i],null,state);}},toggleSprintCheckbox:function(id,e){var row=Event.findElement(e,'tr');if(row){var checkbox=Event.element(e);SprintList.toggle(row,(checkbox.name=='selected')?checkbox:false);}
if(e&&e.shiftKey){SprintList.multipleSelect(id,e);}
SprintList.lastRowClicked=id;},setArchiveStatus:function(status,sprintIds){if(!sprintIds){sprintIds=SprintList.selectedItems().toString();}
if(!sprintIds)
return;var sprintword='sprint';if(sprintIds.indexOf(',')!=-1){sprintword+='s';}
if(confirm('Do you want to '+status+' the '+sprintword+'?')){new Ajax.Request(SprintList.archiveUrl,{asynchronous:true,evalScripts:true,parameters:{selected:sprintIds},onComplete:function(request){Spinner.hide();},onLoading:function(request){Spinner.show();}});}},showTasks:function(sprintId){location.href=SprintList.sprintUrl.replace("SPRINT",sprintId);},removeSprint:function(removeSprintUrl){new Ajax.Request(removeSprintUrl,{asynchronous:true,evalScripts:true,onComplete:function(){Spinner.hide();},onLoading:function(){Spinner.show();}});}});var SprintCursor={};Object.extend(SprintCursor,GenericCursor);Object.extend(SprintCursor,{elements:function(){if(this.cachedElements)return this.cachedElements;if(window.ie){this.cachedElements=$$('div.cursor_image');}else{this.cachedElements=$('sprintlist_table').getElementsByClassName('cursor_image');}
for(var i=0;i<this.cachedElements.length;i++){this.elementsHash[this.cachedElements[i].id]=this.cachedElements[i];}
return this.cachedElements;},init:function(){var current=this.sprintAtCursor();if(current){this.hideCursor($(current.toString()));}
var elements=this.elements();var cookie=readCookie(this.cursorName())||'';if(cookie.length>0){var parsed=cookie.match(new RegExp('(^|\\s)'+this.cursorKey()+'=(-?[0-9]*)'));if(parsed&&parsed[2]){if(parsed[2]=='-1'){this.showCursor(elements[elements.length-1]);return;}
if(SprintList.row(parsed[2])){this.setSprintAtCursor(parsed[2]);return;}}}
this.showCursor(elements[0]);},cursorName:function(){return'sprints_cursor';},cursorKey:function(){if(pageProperties.projectId){return pageProperties.projectId;}},findPos:function(element){return windowHelper.findPos(element)[1];},sprintAtCursor:function(){return this.idAtCursor();},selectCurrentRow:function(){var sprint=this.sprintAtCursor();if(sprint){SprintList.toggle(SprintList.row(sprint));}},setSprintAtCursor:function(sprintId){var current=this.sprintAtCursor();if(current){this.hideCursor($(current.toString()));}
this.showCursor($(sprintId.toString()),CursorActivation.None);}});var InclusionBuilder={id:'inclusion_builder',activeTab:'page',show:function(){Element.show(this.id);DialogManager.addDialog(this);},hide:function(){Element.hide(this.id);DialogManager.removeDialog(this);},save:function(){this.cancel();},cancel:function(){this.hide();},build:function(){var result='';switch(this.activeTab){case'page':result=this.buildPage();break
case'task':result=this.buildTask();break;case'burndown':result=this.buildBurndown();break;case'work_amount':result=this.buildWorkAmount();}
Form.Element.setValue('inclusion_builder_result',result);},switchToTab:function(name){if(this.activeTab==name)return;this.activateTab(name);this.deactivateTab(this.activeTab);this.activeTab=name;this.build();},activateTab:function(name){var tab=$('inclusion_builder_'+name+'_tab');tab.addClassName('active_editor_tab');tab.removeClassName('inactive_editor_tab');Element.show('inclusion_builder_'+name+'_tab_contents');},deactivateTab:function(name){var tab=$('inclusion_builder_'+name+'_tab');tab.addClassName('inactive_editor_tab');tab.removeClassName('active_editor_tab');Element.hide('inclusion_builder_'+name+'_tab_contents');},buildPage:function(){var result='';var name=Form.Element.getValue('ib_page_name');if(name=='')return'';result=name;var section=Form.Element.getValue('ib_page_section');if(section)result=result+'#'+section;result=result+this.getCollapse();return'{{'+result+'}}';},buildTask:function(){var result='';var number=Form.Element.getValue('ib_task_number');if(number=='')return'';result=number;var wikiCheckbox=$('ib_task_wiki');if(wikiCheckbox.checked){var section=Form.Element.getValue('ib_task_section');if(section){result=result+'|wiki#'+section;}
result=result+this.getCollapse();}else{var checkboxes=$$('#inclusion_builder_task_tab_contents .field_column input');for(var i=0;i<checkboxes.length;i++){if(checkboxes[i].checked){var id=checkboxes[i].id;result=result+"|"+id.substring(14,id.length);}}}
return'{{Task:'+result+'}}';},buildBurndown:function(){var result='Burndown:';if($('ib_burndown_sprint').checked){var name=Form.Element.getValue('ib_burndown_sprint_name');if(!name)return'';name=name.replace(/,/g,"|");result=result+'Sprint|'+name;}else if($('ib_burndown_current_sprint').checked){result=result+'Current Sprint';}else if($('ib_burndown_present_sprints').checked){result=result+'Present Sprints';}else if($('ib_burndown_task').checked){var number=Form.Element.getValue('ib_burndown_task_number');if(!number)return'';result=result+'Task:'+number;}
var types=["team","multiuser","line","area"];for(var i=0;i<types.length;i++){if($('ib_burndown_'+types[i]).checked){result=result+'|'+types[i];}}
var startDate=Form.Element.getValue('ib_burndown_start');if(startDate.match(/^\d{4}-\d{2}-\d{2}$/)){result=result+'|start='+startDate;}
var endDate=Form.Element.getValue('ib_burndown_end');if(endDate.match(/^\d{4}-\d{2}-\d{2}$/)){result=result+'|end='+endDate;}
return'{{'+result+'}}';},buildWorkAmount:function(){var result='Work Amount:';if($('ib_work_amount_sprint').checked){var name=Form.Element.getValue('ib_work_amount_sprint_name');if(!name)return'';result=result+'Sprint|'+name;}else if($('ib_work_amount_current_sprint').checked){result=result+'Current Sprint';}
var types=["team","multiuser"];for(var i=0;i<types.length;i++){if($('ib_work_amount_'+types[i]).checked){result=result+'|'+types[i];}}
return'{{'+result+'}}';},checkCollapseCheckbox:function(checkbox,e,tab){var id=checkbox.getAttribute('id');var otherId=null;if(id=='ib_'+tab+'_collapsible'){otherId='ib_'+tab+'_collapsed';}else{otherId='ib_'+tab+'_collapsible';}
if(checkbox.checked){$(otherId).checked=false;}
this.buildPage();},getCollapse:function(){var result='';var collapsible=$('ib_'+this.activeTab+'_collapsible').checked;if(collapsible){result=result+'|colapsible';}else{var collapsed=$('ib_'+this.activeTab+'_collapsed').checked;if(collapsed)result=result+'|collapsed';}
return result;},updateTaskForm:function(wikiState){var columns=$$('#inclusion_builder_task_tab_contents .field_column');for(var i=0;i<columns.length;i++){if(wikiState){columns[i].addClassName('disabled');}else{columns[i].removeClassName('disabled');}}
var checkboxes=$$('#inclusion_builder_task_tab_contents .field_column input');for(var i=0;i<checkboxes.length;i++){checkboxes[i].disabled=wikiState;}
$('ib_task_section').disabled=!wikiState;if(wikiState){$('ib_task_wiki_column').removeClassName('disabled');$('ib_task_section_label').removeClassName('disabled');}else{$('ib_task_wiki_column').addClassName('disabled');$('ib_task_section_label').addClassName('disabled');}
var checkboxes=$$('#ib_task_wiki_column input');for(var i=0;i<checkboxes.length;i++){if(checkboxes[i].id!='ib_task_wiki'){checkboxes[i].disabled=!wikiState;}}
this.build();},checkWikiState:function(checkbox){if(checkbox.checked){this.updateTaskForm(true);}else{this.updateTaskForm(false);}},checkBurndownCheckbox:function(currentCheckbox,e){var checkboxes=['sprint','current_sprint','present_sprints','task'];for(var i=0;i<checkboxes.length;i++){var checkbox=$('ib_burndown_'+checkboxes[i]);var form=$('ib_burndown_'+checkboxes[i]+'_form');if(checkbox!=currentCheckbox){checkbox.checked=false;}
if(form){if(checkbox.checked){this.enableForm(form);}else{this.disableForm(form);}}}},checkBurndownTypeCheckbox:function(checkbox){var id=checkbox.getAttribute('id');var otherId=null;var form=null;var otherForm=null;switch(id){case'ib_burndown_team':otherId='ib_burndown_multiuser'
break
case'ib_burndown_multiuser':otherId='ib_burndown_team';break;case'ib_burndown_line':otherId='ib_burndown_area';break
case'ib_burndown_area':otherId='ib_burndown_line';break;case'ib_work_amount_team':otherId='ib_work_amount_multiuser';break
case'ib_work_amount_multiuser':otherId='ib_work_amount_team';break
case'ib_work_amount_sprint':otherId='ib_work_amount_current_sprint';form=$(id+'_form');break
case'ib_work_amount_current_sprint':otherId='ib_work_amount_sprint';otherForm=$(otherId+'_form');break}
if(checkbox.checked){$(otherId).checked=false;if(form)this.enableForm(form);if(otherForm)this.disableForm(otherForm);}else{if(form)this.disableForm(form);}
this.build();},disableForm:function(id){var form=$(id);Element.hide(form.getElementsByTagName('div')[0]);form.getElementsByTagName('input')[0].disabled=true;},enableForm:function(id){var form=$(id);Element.show(form.getElementsByTagName('div')[0]);form.getElementsByTagName('input')[0].disabled=false;}};